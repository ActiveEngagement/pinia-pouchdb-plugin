(function(ie,Oe){typeof exports=="object"&&typeof module!="undefined"?Oe(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],Oe):(ie=typeof globalThis!="undefined"?globalThis:ie||self,Oe(ie.PiniaPouchdbPlugin={},ie.Vue))})(this,function(ie,Oe){"use strict";var M=(ie,Oe,Fe)=>new Promise((bn,ut)=>{var Wt=ke=>{try{At(Fe.next(ke))}catch(ct){ut(ct)}},kt=ke=>{try{At(Fe.throw(ke))}catch(ct){ut(ct)}},At=ke=>ke.done?bn(ke.value):Promise.resolve(ke.value).then(Wt,kt);At((Fe=Fe.apply(ie,Oe)).next())});const Fe=e=>e instanceof Date,bn=e=>Object.keys(e).length===0,ut=e=>e!=null&&typeof e=="object",Wt=(e,...t)=>Object.prototype.hasOwnProperty.call(e,...t),kt=e=>ut(e)&&bn(e),At=()=>Object.create(null),ke=(e,t)=>{if(e===t)return{};if(!ut(e)||!ut(t))return t;const n=Object.keys(e).reduce((r,i)=>(Wt(t,i)||(r[i]=void 0),r),At());return Fe(e)||Fe(t)?e.valueOf()==t.valueOf()?{}:t:Object.keys(t).reduce((r,i)=>{if(!Wt(e,i))return r[i]=t[i],r;const a=ke(e[i],t[i]);return kt(a)&&!Fe(a)&&(kt(e[i])||!kt(t[i]))||(r[i]=a),r},n)};function ct(e,t){return M(this,null,function*(){const n=(yield e.allDocs({include_docs:!0,attachments:!0})).rows.reduce((r,i)=>Object.assign(r,{[i.id]:i.doc}),{});for(const[r,i]of Object.entries(t.state.value))for(const a of Object.keys(i)){const o=`${r}.${a}`;n[o]!==void 0&&(i[a]=n[o].$value===void 0?void 0:JSON.parse(JSON.stringify(n[o].$value)))}})}const yo=e=>t=>{let n=JSON.parse(JSON.stringify(t.store.$state))||{};t.store.$subscribe((r,i)=>M(this,null,function*(){const a=JSON.parse(JSON.stringify(i)),o=ke(n||{},a);for(let s of Object.keys(o))yield e.database.config(`${t.store.$id}.${s}`,t.store[s]);n=a}))};function Xr(e,t,n){const{pinia:r,database:i,stores:a,loaded:o}=t||{},s=Oe.defineComponent({render(){return Oe.h(Oe.Suspense,Oe.h(Object.assign({setup:()=>M(this,null,function*(){if(a)for(const c of a)c();yield ct(i,r),o&&o()}),render(){return Oe.h(e)}},n)))}});return Oe.h(s,{},{default:()=>e})}function go(e,t){const n=Oe.createApp(Xr(e,{database:t.database,pinia:t.pinia,stores:t.stores,loaded:t.loaded&&function(){t.loaded(n)}},{beforeMount:function(){t.mounted&&t.beforeMount(n)},mounted:function(){t.mounted&&t.mounted(n)}}));return n}function Yr(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){if(this instanceof r){var i=[null];i.push.apply(i,arguments);var a=Function.bind.apply(t,i);return new a}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}const po=Yr(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var $n={};$n.test=function(){return typeof window.queueMicrotask=="function"},$n.install=function(e){return function(){window.queueMicrotask(e)}};var On={},Zr=window.MutationObserver||window.WebKitMutationObserver;On.test=function(){return Zr},On.install=function(e){var t=0,n=new Zr(e),r=window.document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=t=++t%2}};var Sn={};Sn.test=function(){return window.setImmediate?!1:typeof window.MessageChannel!="undefined"},Sn.install=function(e){var t=new window.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}};var kn={};kn.test=function(){return"document"in window&&"onreadystatechange"in window.document.createElement("script")},kn.install=function(e){return function(){var t=window.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},window.document.documentElement.appendChild(t),e}};var An={};An.test=function(){return!0},An.install=function(e){return function(){setTimeout(e,0)}};var Et=[po,$n,On,Sn,kn,An],ft,Qe,xt=-1,Ue=[],En=!1;function _o(){!ft||!Qe||(ft=!1,Qe.length?Ue=Qe.concat(Ue):xt=-1,Ue.length&&Vr())}function Vr(){if(!ft){En=!1,ft=!0;for(var e=Ue.length,t=setTimeout(_o);e;){for(Qe=Ue,Ue=[];Qe&&++xt<e;)Qe[xt].run();xt=-1,e=Ue.length}Qe=null,xt=-1,ft=!1,clearTimeout(t)}}for(var ei,Ct=-1,mo=Et.length;++Ct<mo;)if(Et[Ct]&&Et[Ct].test&&Et[Ct].test()){ei=Et[Ct].install(Vr);break}function ti(e,t){this.fun=e,this.array=t}ti.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}};var me=wo;function wo(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Ue.push(new ti(e,t)),!En&&!ft&&(En=!0,ei())}var xn={},bo={get exports(){return xn},set exports(e){xn=e}};(function(e,t){(function(n){e.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(g,v){var u=g[0],l=g[1],y=g[2],_=g[3];u+=(l&y|~l&_)+v[0]-680876936|0,u=(u<<7|u>>>25)+l|0,_+=(u&l|~u&y)+v[1]-389564586|0,_=(_<<12|_>>>20)+u|0,y+=(_&u|~_&l)+v[2]+606105819|0,y=(y<<17|y>>>15)+_|0,l+=(y&_|~y&u)+v[3]-1044525330|0,l=(l<<22|l>>>10)+y|0,u+=(l&y|~l&_)+v[4]-176418897|0,u=(u<<7|u>>>25)+l|0,_+=(u&l|~u&y)+v[5]+1200080426|0,_=(_<<12|_>>>20)+u|0,y+=(_&u|~_&l)+v[6]-1473231341|0,y=(y<<17|y>>>15)+_|0,l+=(y&_|~y&u)+v[7]-45705983|0,l=(l<<22|l>>>10)+y|0,u+=(l&y|~l&_)+v[8]+1770035416|0,u=(u<<7|u>>>25)+l|0,_+=(u&l|~u&y)+v[9]-1958414417|0,_=(_<<12|_>>>20)+u|0,y+=(_&u|~_&l)+v[10]-42063|0,y=(y<<17|y>>>15)+_|0,l+=(y&_|~y&u)+v[11]-1990404162|0,l=(l<<22|l>>>10)+y|0,u+=(l&y|~l&_)+v[12]+1804603682|0,u=(u<<7|u>>>25)+l|0,_+=(u&l|~u&y)+v[13]-40341101|0,_=(_<<12|_>>>20)+u|0,y+=(_&u|~_&l)+v[14]-1502002290|0,y=(y<<17|y>>>15)+_|0,l+=(y&_|~y&u)+v[15]+1236535329|0,l=(l<<22|l>>>10)+y|0,u+=(l&_|y&~_)+v[1]-165796510|0,u=(u<<5|u>>>27)+l|0,_+=(u&y|l&~y)+v[6]-1069501632|0,_=(_<<9|_>>>23)+u|0,y+=(_&l|u&~l)+v[11]+643717713|0,y=(y<<14|y>>>18)+_|0,l+=(y&u|_&~u)+v[0]-373897302|0,l=(l<<20|l>>>12)+y|0,u+=(l&_|y&~_)+v[5]-701558691|0,u=(u<<5|u>>>27)+l|0,_+=(u&y|l&~y)+v[10]+38016083|0,_=(_<<9|_>>>23)+u|0,y+=(_&l|u&~l)+v[15]-660478335|0,y=(y<<14|y>>>18)+_|0,l+=(y&u|_&~u)+v[4]-405537848|0,l=(l<<20|l>>>12)+y|0,u+=(l&_|y&~_)+v[9]+568446438|0,u=(u<<5|u>>>27)+l|0,_+=(u&y|l&~y)+v[14]-1019803690|0,_=(_<<9|_>>>23)+u|0,y+=(_&l|u&~l)+v[3]-187363961|0,y=(y<<14|y>>>18)+_|0,l+=(y&u|_&~u)+v[8]+1163531501|0,l=(l<<20|l>>>12)+y|0,u+=(l&_|y&~_)+v[13]-1444681467|0,u=(u<<5|u>>>27)+l|0,_+=(u&y|l&~y)+v[2]-51403784|0,_=(_<<9|_>>>23)+u|0,y+=(_&l|u&~l)+v[7]+1735328473|0,y=(y<<14|y>>>18)+_|0,l+=(y&u|_&~u)+v[12]-1926607734|0,l=(l<<20|l>>>12)+y|0,u+=(l^y^_)+v[5]-378558|0,u=(u<<4|u>>>28)+l|0,_+=(u^l^y)+v[8]-2022574463|0,_=(_<<11|_>>>21)+u|0,y+=(_^u^l)+v[11]+1839030562|0,y=(y<<16|y>>>16)+_|0,l+=(y^_^u)+v[14]-35309556|0,l=(l<<23|l>>>9)+y|0,u+=(l^y^_)+v[1]-1530992060|0,u=(u<<4|u>>>28)+l|0,_+=(u^l^y)+v[4]+1272893353|0,_=(_<<11|_>>>21)+u|0,y+=(_^u^l)+v[7]-155497632|0,y=(y<<16|y>>>16)+_|0,l+=(y^_^u)+v[10]-1094730640|0,l=(l<<23|l>>>9)+y|0,u+=(l^y^_)+v[13]+681279174|0,u=(u<<4|u>>>28)+l|0,_+=(u^l^y)+v[0]-358537222|0,_=(_<<11|_>>>21)+u|0,y+=(_^u^l)+v[3]-722521979|0,y=(y<<16|y>>>16)+_|0,l+=(y^_^u)+v[6]+76029189|0,l=(l<<23|l>>>9)+y|0,u+=(l^y^_)+v[9]-640364487|0,u=(u<<4|u>>>28)+l|0,_+=(u^l^y)+v[12]-421815835|0,_=(_<<11|_>>>21)+u|0,y+=(_^u^l)+v[15]+530742520|0,y=(y<<16|y>>>16)+_|0,l+=(y^_^u)+v[2]-995338651|0,l=(l<<23|l>>>9)+y|0,u+=(y^(l|~_))+v[0]-198630844|0,u=(u<<6|u>>>26)+l|0,_+=(l^(u|~y))+v[7]+1126891415|0,_=(_<<10|_>>>22)+u|0,y+=(u^(_|~l))+v[14]-1416354905|0,y=(y<<15|y>>>17)+_|0,l+=(_^(y|~u))+v[5]-57434055|0,l=(l<<21|l>>>11)+y|0,u+=(y^(l|~_))+v[12]+1700485571|0,u=(u<<6|u>>>26)+l|0,_+=(l^(u|~y))+v[3]-1894986606|0,_=(_<<10|_>>>22)+u|0,y+=(u^(_|~l))+v[10]-1051523|0,y=(y<<15|y>>>17)+_|0,l+=(_^(y|~u))+v[1]-2054922799|0,l=(l<<21|l>>>11)+y|0,u+=(y^(l|~_))+v[8]+1873313359|0,u=(u<<6|u>>>26)+l|0,_+=(l^(u|~y))+v[15]-30611744|0,_=(_<<10|_>>>22)+u|0,y+=(u^(_|~l))+v[6]-1560198380|0,y=(y<<15|y>>>17)+_|0,l+=(_^(y|~u))+v[13]+1309151649|0,l=(l<<21|l>>>11)+y|0,u+=(y^(l|~_))+v[4]-145523070|0,u=(u<<6|u>>>26)+l|0,_+=(l^(u|~y))+v[11]-1120210379|0,_=(_<<10|_>>>22)+u|0,y+=(u^(_|~l))+v[2]+718787259|0,y=(y<<15|y>>>17)+_|0,l+=(_^(y|~u))+v[9]-343485551|0,l=(l<<21|l>>>11)+y|0,g[0]=u+g[0]|0,g[1]=l+g[1]|0,g[2]=y+g[2]|0,g[3]=_+g[3]|0}function a(g){var v=[],u;for(u=0;u<64;u+=4)v[u>>2]=g.charCodeAt(u)+(g.charCodeAt(u+1)<<8)+(g.charCodeAt(u+2)<<16)+(g.charCodeAt(u+3)<<24);return v}function o(g){var v=[],u;for(u=0;u<64;u+=4)v[u>>2]=g[u]+(g[u+1]<<8)+(g[u+2]<<16)+(g[u+3]<<24);return v}function s(g){var v=g.length,u=[1732584193,-271733879,-1732584194,271733878],l,y,_,P,I,j;for(l=64;l<=v;l+=64)i(u,a(g.substring(l-64,l)));for(g=g.substring(l-64),y=g.length,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<y;l+=1)_[l>>2]|=g.charCodeAt(l)<<(l%4<<3);if(_[l>>2]|=128<<(l%4<<3),l>55)for(i(u,_),l=0;l<16;l+=1)_[l]=0;return P=v*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),I=parseInt(P[2],16),j=parseInt(P[1],16)||0,_[14]=I,_[15]=j,i(u,_),u}function c(g){var v=g.length,u=[1732584193,-271733879,-1732584194,271733878],l,y,_,P,I,j;for(l=64;l<=v;l+=64)i(u,o(g.subarray(l-64,l)));for(g=l-64<v?g.subarray(l-64):new Uint8Array(0),y=g.length,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<y;l+=1)_[l>>2]|=g[l]<<(l%4<<3);if(_[l>>2]|=128<<(l%4<<3),l>55)for(i(u,_),l=0;l<16;l+=1)_[l]=0;return P=v*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),I=parseInt(P[2],16),j=parseInt(P[1],16)||0,_[14]=I,_[15]=j,i(u,_),u}function p(g){var v="",u;for(u=0;u<4;u+=1)v+=r[g>>u*8+4&15]+r[g>>u*8&15];return v}function w(g){var v;for(v=0;v<g.length;v+=1)g[v]=p(g[v]);return g.join("")}w(s("hello")),typeof ArrayBuffer!="undefined"&&!ArrayBuffer.prototype.slice&&function(){function g(v,u){return v=v|0||0,v<0?Math.max(v+u,0):Math.min(v,u)}ArrayBuffer.prototype.slice=function(v,u){var l=this.byteLength,y=g(v,l),_=l,P,I,j,F;return u!==n&&(_=g(u,l)),y>_?new ArrayBuffer(0):(P=_-y,I=new ArrayBuffer(P),j=new Uint8Array(I),F=new Uint8Array(this,y,P),j.set(F),I)}}();function f(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function m(g,v){var u=g.length,l=new ArrayBuffer(u),y=new Uint8Array(l),_;for(_=0;_<u;_+=1)y[_]=g.charCodeAt(_);return v?y:l}function S(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function A(g,v,u){var l=new Uint8Array(g.byteLength+v.byteLength);return l.set(new Uint8Array(g)),l.set(new Uint8Array(v),g.byteLength),u?l:l.buffer}function x(g){var v=[],u=g.length,l;for(l=0;l<u-1;l+=2)v.push(parseInt(g.substr(l,2),16));return String.fromCharCode.apply(String,v)}function $(){this.reset()}return $.prototype.append=function(g){return this.appendBinary(f(g)),this},$.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var v=this._buff.length,u;for(u=64;u<=v;u+=64)i(this._hash,a(this._buff.substring(u-64,u)));return this._buff=this._buff.substring(u-64),this},$.prototype.end=function(g){var v=this._buff,u=v.length,l,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_;for(l=0;l<u;l+=1)y[l>>2]|=v.charCodeAt(l)<<(l%4<<3);return this._finish(y,u),_=w(this._hash),g&&(_=x(_)),this.reset(),_},$.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},$.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},$.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},$.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},$.prototype._finish=function(g,v){var u=v,l,y,_;if(g[u>>2]|=128<<(u%4<<3),u>55)for(i(this._hash,g),u=0;u<16;u+=1)g[u]=0;l=this._length*8,l=l.toString(16).match(/(.*?)(.{0,8})$/),y=parseInt(l[2],16),_=parseInt(l[1],16)||0,g[14]=y,g[15]=_,i(this._hash,g)},$.hash=function(g,v){return $.hashBinary(f(g),v)},$.hashBinary=function(g,v){var u=s(g),l=w(u);return v?x(l):l},$.ArrayBuffer=function(){this.reset()},$.ArrayBuffer.prototype.append=function(g){var v=A(this._buff.buffer,g,!0),u=v.length,l;for(this._length+=g.byteLength,l=64;l<=u;l+=64)i(this._hash,o(v.subarray(l-64,l)));return this._buff=l-64<u?new Uint8Array(v.buffer.slice(l-64)):new Uint8Array(0),this},$.ArrayBuffer.prototype.end=function(g){var v=this._buff,u=v.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y,_;for(y=0;y<u;y+=1)l[y>>2]|=v[y]<<(y%4<<3);return this._finish(l,u),_=w(this._hash),g&&(_=x(_)),this.reset(),_},$.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},$.ArrayBuffer.prototype.getState=function(){var g=$.prototype.getState.call(this);return g.buff=S(g.buff),g},$.ArrayBuffer.prototype.setState=function(g){return g.buff=m(g.buff,!0),$.prototype.setState.call(this,g)},$.ArrayBuffer.prototype.destroy=$.prototype.destroy,$.ArrayBuffer.prototype._finish=$.prototype._finish,$.ArrayBuffer.hash=function(g,v){var u=c(new Uint8Array(g)),l=w(u);return v?x(l):l},$})})(bo);const Ht=xn;var Xt,$o=new Uint8Array(16);function Oo(){if(!Xt&&(Xt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Xt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xt($o)}const So=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ko(e){return typeof e=="string"&&So.test(e)}for(var ge=[],Cn=0;Cn<256;++Cn)ge.push((Cn+256).toString(16).substr(1));function Ao(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(ge[e[t+0]]+ge[e[t+1]]+ge[e[t+2]]+ge[e[t+3]]+"-"+ge[e[t+4]]+ge[e[t+5]]+"-"+ge[e[t+6]]+ge[e[t+7]]+"-"+ge[e[t+8]]+ge[e[t+9]]+"-"+ge[e[t+10]]+ge[e[t+11]]+ge[e[t+12]]+ge[e[t+13]]+ge[e[t+14]]+ge[e[t+15]]).toLowerCase();if(!ko(n))throw TypeError("Stringified UUID is invalid");return n}function Tn(e,t,n){e=e||{};var r=e.random||(e.rng||Oo)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return Ao(r)}var Yt={};Yt.stringify=function(t){var n=[];n.push({obj:t});for(var r="",i,a,o,s,c,p,w,f,m,S,A;i=n.pop();)if(a=i.obj,o=i.prefix||"",s=i.val||"",r+=o,s)r+=s;else if(typeof a!="object")r+=typeof a=="undefined"?null:JSON.stringify(a);else if(a===null)r+="null";else if(Array.isArray(a)){for(n.push({val:"]"}),c=a.length-1;c>=0;c--)p=c===0?"":",",n.push({obj:a[c],prefix:p});n.push({val:"["})}else{w=[];for(f in a)a.hasOwnProperty(f)&&w.push(f);for(n.push({val:"}"}),c=w.length-1;c>=0;c--)m=w[c],S=a[m],A=c>0?",":"",A+=JSON.stringify(m)+":",n.push({obj:S,prefix:A});n.push({val:"{"})}return r};function lt(e,t,n){var r=n[n.length-1];e===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,a=r.index;if(Array.isArray(i))i.push(e);else if(a===t.length-2){var o=t.pop();i[o]=e}else t.push(e)}Yt.parse=function(e){for(var t=[],n=[],r=0,i,a,o,s,c,p,w,f,m;;){if(i=e[r++],i==="}"||i==="]"||typeof i=="undefined"){if(t.length===1)return t.pop();lt(t.pop(),t,n);continue}switch(i){case" ":case"	":case`
`:case":":case",":break;case"n":r+=3,lt(null,t,n);break;case"t":r+=3,lt(!0,t,n);break;case"f":r+=4,lt(!1,t,n);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(a="",r--;;)if(o=e[r++],/[\d\.\-e\+]/.test(o))a+=o;else{r--;break}lt(parseFloat(a),t,n);break;case'"':for(s="",c=void 0,p=0;w=e[r++],w!=='"'||c==="\\"&&p%2===1;)s+=w,c=w,c==="\\"?p++:p=0;lt(JSON.parse('"'+s+'"'),t,n);break;case"[":f={element:[],index:t.length},t.push(f.element),n.push(f);break;case"{":m={element:{},index:t.length},t.push(m.element),n.push(m);break;default:throw new Error("unexpectedly reached end of input: "+i)}}};var Ae={},Eo={get exports(){return Ae},set exports(e){Ae=e}},dt=typeof Reflect=="object"?Reflect:null,ni=dt&&typeof dt.apply=="function"?dt.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},Zt;dt&&typeof dt.ownKeys=="function"?Zt=dt.ownKeys:Object.getOwnPropertySymbols?Zt=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Zt=function(t){return Object.getOwnPropertyNames(t)};function xo(e){console&&console.warn&&console.warn(e)}var ri=Number.isNaN||function(t){return t!==t};function ae(){ae.init.call(this)}Eo.exports=ae,Ae.once=Po,ae.EventEmitter=ae,ae.prototype._events=void 0,ae.prototype._eventsCount=0,ae.prototype._maxListeners=void 0;var ii=10;function Vt(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ae,"defaultMaxListeners",{enumerable:!0,get:function(){return ii},set:function(e){if(typeof e!="number"||e<0||ri(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");ii=e}}),ae.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ae.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||ri(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function ai(e){return e._maxListeners===void 0?ae.defaultMaxListeners:e._maxListeners}ae.prototype.getMaxListeners=function(){return ai(this)},ae.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",a=this._events;if(a!==void 0)i=i&&a.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=a[t];if(c===void 0)return!1;if(typeof c=="function")ni(c,this,n);else for(var p=c.length,w=fi(c,p),r=0;r<p;++r)ni(w[r],this,n);return!0};function oi(e,t,n,r){var i,a,o;if(Vt(n),a=e._events,a===void 0?(a=e._events=Object.create(null),e._eventsCount=0):(a.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),o===void 0)o=a[t]=n,++e._eventsCount;else if(typeof o=="function"?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=ai(e),i>0&&o.length>i&&!o.warned){o.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=o.length,xo(s)}return e}ae.prototype.addListener=function(t,n){return oi(this,t,n,!1)},ae.prototype.on=ae.prototype.addListener,ae.prototype.prependListener=function(t,n){return oi(this,t,n,!0)};function Co(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function si(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=Co.bind(r);return i.listener=n,r.wrapFn=i,i}ae.prototype.once=function(t,n){return Vt(n),this.on(t,si(this,t,n)),this},ae.prototype.prependOnceListener=function(t,n){return Vt(n),this.prependListener(t,si(this,t,n)),this},ae.prototype.removeListener=function(t,n){var r,i,a,o,s;if(Vt(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(a=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){s=r[o].listener,a=o;break}if(a<0)return this;a===0?r.shift():To(r,a),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,s||n)}return this},ae.prototype.off=ae.prototype.removeListener,ae.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var a=Object.keys(r),o;for(i=0;i<a.length;++i)o=a[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function ui(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?qo(i):fi(i,i.length)}ae.prototype.listeners=function(t){return ui(this,t,!0)},ae.prototype.rawListeners=function(t){return ui(this,t,!1)},ae.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):ci.call(e,t)},ae.prototype.listenerCount=ci;function ci(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}ae.prototype.eventNames=function(){return this._eventsCount>0?Zt(this._events):[]};function fi(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function To(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function qo(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function Po(e,t){return new Promise(function(n,r){function i(o){e.removeListener(t,a),r(o)}function a(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}li(e,t,a,{once:!0}),t!=="error"&&jo(e,i,{once:!0})})}function jo(e,t,n){typeof e.on=="function"&&li(e,"error",t,n)}function li(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(a){r.once&&e.removeEventListener(t,i),n(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}function en(e){return"$"+e}function di(e){return e.substring(1)}function De(){this._store={}}De.prototype.get=function(e){var t=en(e);return this._store[t]},De.prototype.set=function(e,t){var n=en(e);return this._store[n]=t,!0},De.prototype.has=function(e){var t=en(e);return t in this._store},De.prototype.keys=function(){return Object.keys(this._store).map(e=>di(e))},De.prototype.delete=function(e){var t=en(e),n=t in this._store;return delete this._store[t],n},De.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n],a=this._store[i];i=di(i),e(a,i)}},Object.defineProperty(De.prototype,"size",{get:function(){return Object.keys(this._store).length}});function Tt(e){if(this._store=new De,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}Tt.prototype.add=function(e){return this._store.set(e,!0)},Tt.prototype.has=function(e){return this._store.has(e)},Tt.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(Tt.prototype,"size",{get:function(){return this._store.size}});function Io(){if(typeof Symbol=="undefined"||typeof Map=="undefined"||typeof Set=="undefined")return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}var ht,$e;Io()?(ht=Set,$e=Map):(ht=Tt,$e=De);function Bo(e){return typeof ArrayBuffer!="undefined"&&e instanceof ArrayBuffer||typeof Blob!="undefined"&&e instanceof Blob}function Ro(e){if(typeof e.slice=="function")return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}function Lo(e){if(e instanceof ArrayBuffer)return Ro(e);var t=e.size,n=e.type;return typeof e.slice=="function"?e.slice(0,t,n):e.webkitSlice(0,t,n)}var hi=Function.prototype.toString,Do=hi.call(Object);function No(e){var t=Object.getPrototypeOf(e);if(t===null)return!0;var n=t.constructor;return typeof n=="function"&&n instanceof n&&hi.call(n)==Do}function he(e){var t,n,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=he(e[n]);return t}if(e instanceof Date&&isFinite(e))return e.toISOString();if(Bo(e))return Lo(e);if(!No(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=he(e[n]);typeof i!="undefined"&&(t[n]=i)}return t}function vi(e){var t=!1;return function(...n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}}function yi(e){return function(...t){t=he(t);var n=this,r=typeof t[t.length-1]=="function"?t.pop():!1,i=new Promise(function(a,o){var s;try{var c=vi(function(p,w){p?o(p):a(w)});t.push(c),s=e.apply(n,t),s&&typeof s.then=="function"&&a(s)}catch(p){o(p)}});return r&&i.then(function(a){r(null,a)},r),i}}function Mo(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var a=n[n.length-1];n[n.length-1]=function(o,s){var c=["api",e.name,t];c=c.concat(o?["error",o]:["success",s]),e.constructor.emit("debug",c),a(o,s)}}}function ce(e,t){return yi(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return Mo(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(i,a){r.taskqueue.addTask(function(o){o?a(o):i(r[e].apply(r,n))})})})}function qt(e,t){for(var n={},r=0,i=t.length;r<i;r++){var a=t[r];a in e&&(n[a]=e[a])}return n}var Fo=6;function gi(e){return e}function Uo(e){return[{ok:e}]}function pi(e,t,n){var r=t.docs,i=new $e;r.forEach(function(x){i.has(x.id)?i.get(x.id).push(x):i.set(x.id,[x])});var a=i.size,o=0,s=new Array(a);function c(){var x=[];s.forEach(function($){$.docs.forEach(function(g){x.push({id:$.id,docs:[g]})})}),n(null,{results:x})}function p(){++o===a&&c()}function w(x,$,g){s[x]={id:$,docs:g},p()}var f=[];i.forEach(function(x,$){f.push($)});var m=0;function S(){if(!(m>=f.length)){var x=Math.min(m+Fo,f.length),$=f.slice(m,x);A($,m),m+=$.length}}function A(x,$){x.forEach(function(g,v){var u=$+v,l=i.get(g),y=qt(l[0],["atts_since","attachments"]);y.open_revs=l.map(function(P){return P.rev}),y.open_revs=y.open_revs.filter(gi);var _=gi;y.open_revs.length===0&&(delete y.open_revs,_=Uo),["revs","attachments","binary","ajax","latest"].forEach(function(P){P in t&&(y[P]=t[P])}),e.get(g,y,function(P,I){var j;P?j=[{error:P}]:j=_(I),w(u,g,j),S()})})}S()}var qn;try{localStorage.setItem("_pouch_check_localstorage",1),qn=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){qn=!1}function tn(){return qn}class Ko extends Ae{constructor(){super(),this._listeners={},tn()&&addEventListener("storage",function(t){this.emit(t.key)})}addListener(t,n,r,i){if(this._listeners[n])return;var a=!1,o=this;function s(){if(!o._listeners[n])return;if(a){a="waiting";return}a=!0;var c=qt(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function p(){a=!1}r.changes(c).on("change",function(w){w.seq>i.since&&!i.cancelled&&(i.since=w.seq,i.onChange(w))}).on("complete",function(){a==="waiting"&&me(s),a=!1}).on("error",p)}this._listeners[n]=s,this.on(t,s)}removeListener(t,n){n in this._listeners&&(super.removeListener(t,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(t){tn()&&(localStorage[t]=localStorage[t]==="a"?"b":"a")}notify(t){this.emit(t),this.notifyLocalWindows(t)}}function Ee(e){if(typeof console!="undefined"&&typeof console[e]=="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function zo(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:t=t+1,t>n&&(e=n>>1,t=n);var r=Math.random(),i=t-e;return~~(i*r+e)}function Qo(e){var t=0;return e||(t=2e3),zo(e,t)}function Pn(e,t){Ee("info","The above "+e+" is totally normal. "+t)}var jn;typeof Object.assign=="function"?jn=Object.assign:jn=function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};var Je=jn;let se=class extends Error{constructor(t,n,r){super(),this.status=t,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}};new se(401,"unauthorized","Name or password is incorrect.");var Jo=new se(400,"bad_request","Missing JSON list of 'docs'"),xe=new se(404,"not_found","missing"),vt=new se(409,"conflict","Document update conflict"),_i=new se(400,"bad_request","_id field must contain a string"),Go=new se(412,"missing_id","_id is required for puts"),Wo=new se(400,"bad_request","Only reserved document ids may start with underscore.");new se(412,"precondition_failed","Database not open");var In=new se(500,"unknown_error","Database encountered an unknown error"),mi=new se(500,"badarg","Some query argument is invalid");new se(400,"invalid_request","Request was invalid");var Ho=new se(400,"query_parse_error","Some query parameter is invalid"),wi=new se(500,"doc_validation","Bad special document member"),nn=new se(400,"bad_request","Something wrong with the request"),Bn=new se(400,"bad_request","Document must be a JSON object");new se(404,"not_found","Database not found");var Rn=new se(500,"indexed_db_went_bad","unknown");new se(500,"web_sql_went_bad","unknown"),new se(500,"levelDB_went_went_bad","unknown"),new se(403,"forbidden","Forbidden by design doc validate_doc_update function");var bi=new se(400,"bad_request","Invalid rev format");new se(412,"file_exists","The database could not be created, the file already exists.");var Xo=new se(412,"missing_stub","A pre-existing attachment stub wasn't found");new se(413,"invalid_url","Provided URL is invalid");function ee(e,t){function n(r){for(var i=Object.getOwnPropertyNames(e),a=0,o=i.length;a<o;a++)typeof e[i[a]]!="function"&&(this[i[a]]=e[i[a]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=se.prototype,new n(t)}function yt(e){if(typeof e!="object"){var t=e;e=In,e.data=t}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=new Error().stack),e}function Yo(e,t,n){try{return!e(t,n)}catch(i){var r="Filter function threw: "+i.toString();return ee(nn,r)}}function Ln(e){var t={},n=e.filter&&typeof e.filter=="function";return t.query=e.query_params,function(i){i.doc||(i.doc={});var a=n&&Yo(e.filter,i.doc,t);if(typeof a=="object")return a;if(a)return!1;if(!e.include_docs)delete i.doc;else if(!e.attachments)for(var o in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,o)&&(i.doc._attachments[o].stub=!0);return!0}}function rn(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function $i(e){var t;if(e?typeof e!="string"?t=ee(_i):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=ee(Wo)):t=ee(Go),t)throw t}function Ie(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(Ee("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function Zo(e,t){return"listenerCount"in e?e.listenerCount(t):Ae.listenerCount(e,t)}function Dn(e){if(!e)return null;var t=e.split("/");return t.length===2?t:t.length===1?[e,e]:null}function Oi(e){var t=Dn(e);return t?t.join("/"):null}var Si=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ki="queryKey",Vo=/(?:^|&)([^&=]*)=?([^&]*)/g,es=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function Ai(e){for(var t=es.exec(e),n={},r=14;r--;){var i=Si[r],a=t[r]||"",o=["user","password"].indexOf(i)!==-1;n[i]=o?decodeURIComponent(a):a}return n[ki]={},n[Si[12]].replace(Vo,function(s,c,p){c&&(n[ki][c]=p)}),n}function Nn(e,t){var n=[],r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function an(e,t,n){return e.get(t).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,a=n(r);return a?(a._id=t,a._rev=i,ts(e,a,n)):{updated:!1,rev:i}})}function ts(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return an(e,t._id,n)})}var Mn=function(e){return atob(e)},Pt=function(e){return btoa(e)};function Fn(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if(a.name!=="TypeError")throw a;for(var n=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function ns(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function Un(e,t){return Fn([ns(e)],{type:t})}function Kn(e,t){return Un(Mn(e),t)}function rs(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function Ei(e,t){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var a=i.target.result||"";if(r)return t(a);t(rs(a))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function xi(e,t){Ei(e,function(n){t(n)})}function zn(e,t){xi(e,function(n){t(Pt(n))})}function is(e,t){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);t(i)},n.readAsArrayBuffer(e)}var as=self.setImmediate||self.setTimeout,os=32768;function ss(e){return Pt(e)}function us(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}function cs(e,t,n,r,i){(n>0||r<t.size)&&(t=us(t,n,r)),is(t,function(a){e.append(a),i()})}function fs(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function Qn(e,t){var n=typeof e=="string",r=n?e.length:e.size,i=Math.min(os,r),a=Math.ceil(r/i),o=0,s=n?new Ht:new Ht.ArrayBuffer,c=n?fs:cs;function p(){as(f)}function w(){var m=s.end(!0),S=ss(m);t(S),s.destroy()}function f(){var m=o*i,S=m+i;o++,o<a?c(s,e,m,S,p):c(s,e,m,S,w)}f()}function Ci(e){return Ht.hash(e)}function Ti(e,t){if(!t)return Tn().replace(/-/g,"").toLowerCase();var n=Je({},e);return delete n._rev_tree,Ci(JSON.stringify(n))}var on=Tn;function Ge(e){for(var t,n,r,i=e.rev_tree.slice(),a;a=i.pop();){var o=a.ids,s=o[2],c=a.pos;if(s.length){for(var p=0,w=s.length;p<w;p++)i.push({pos:c+1,ids:s[p]});continue}var f=!!o[1].deleted,m=o[0];(!t||(r!==f?r:n!==c?n<c:t<m))&&(t=m,n=c,r=f)}return n+"-"+t}function We(e,t){for(var n=e.slice(),r;r=n.pop();)for(var i=r.pos,a=r.ids,o=a[2],s=t(o.length===0,i,a[0],r.ctx,a[1]),c=0,p=o.length;c<p;c++)n.push({pos:i+1,ids:o[c],ctx:s})}function ls(e,t){return e.pos-t.pos}function Jn(e){var t=[];We(e,function(i,a,o,s,c){i&&t.push({rev:a+"-"+o,pos:a,opts:c})}),t.sort(ls).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function Gn(e){for(var t=Ge(e),n=Jn(e.rev_tree),r=[],i=0,a=n.length;i<a;i++){var o=n[i];o.rev!==t&&!o.opts.deleted&&r.push(o.rev)}return r}function ds(e){var t=[];return We(e.rev_tree,function(n,r,i,a,o){o.status==="available"&&!n&&(t.push(r+"-"+i),o.status="missing")}),t}function hs(e,t){let n=[];const r=e.slice();let i;for(;i=r.pop();){const{pos:a,ids:o}=i,s=`${a}-${o[0]}`,c=o[2];if(n.push(s),s===t){if(c.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(c.length===0||c.length>1)&&(n=[]);for(let p=0,w=c.length;p<w;p++)r.push({pos:a+1,ids:c[p]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function qi(e){for(var t=[],n=e.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,o=a[0],s=a[1],c=a[2],p=c.length===0,w=r.history?r.history.slice():[];w.push({id:o,opts:s}),p&&t.push({pos:i+1-w.length,ids:w});for(var f=0,m=c.length;f<m;f++)n.push({pos:i+1,ids:c[f],history:w})}return t.reverse()}function vs(e,t){return e.pos-t.pos}function ys(e,t,n){for(var r=0,i=e.length,a;r<i;)a=r+i>>>1,n(e[a],t)<0?r=a+1:i=a;return r}function gs(e,t,n){var r=ys(e,t,n);e.splice(r,0,t)}function Pi(e,t){for(var n,r,i=t,a=e.length;i<a;i++){var o=e[i],s=[o.id,o.opts,[]];r?(r[2].push(s),r=s):n=r=s}return n}function ps(e,t){return e[0]<t[0]?-1:1}function ji(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),a=i.tree1,o=i.tree2;(a[1].status||o[1].status)&&(a[1].status=a[1].status==="available"||o[1].status==="available"?"available":"missing");for(var s=0;s<o[2].length;s++){if(!a[2][0]){r="new_leaf",a[2][0]=o[2][s];continue}for(var c=!1,p=0;p<a[2].length;p++)a[2][p][0]===o[2][s][0]&&(n.push({tree1:a[2][p],tree2:o[2][s]}),c=!0);c||(r="new_branch",gs(a[2],o[2][s],ps))}}return{conflicts:r,tree:e}}function Ii(e,t,n){var r=[],i=!1,a=!1,o;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,c=e.length;s<c;s++){var p=e[s];if(p.pos===t.pos&&p.ids[0]===t.ids[0])o=ji(p.ids,t.ids),r.push({pos:p.pos,ids:o.tree}),i=i||o.conflicts,a=!0;else if(n!==!0){var w=p.pos<t.pos?p:t,f=p.pos<t.pos?t:p,m=f.pos-w.pos,S=[],A=[];for(A.push({ids:w.ids,diff:m,parent:null,parentIdx:null});A.length>0;){var x=A.pop();if(x.diff===0){x.ids[0]===f.ids[0]&&S.push(x);continue}for(var $=x.ids[2],g=0,v=$.length;g<v;g++)A.push({ids:$[g],diff:x.diff-1,parent:x.ids,parentIdx:g})}var u=S[0];u?(o=ji(u.ids,f.ids),u.parent[2][u.parentIdx]=o.tree,r.push({pos:w.pos,ids:w.ids}),i=i||o.conflicts,a=!0):r.push(p)}else r.push(p)}return a||r.push(t),r.sort(vs),{tree:r,conflicts:i||"internal_node"}}function _s(e,t){for(var n=qi(e),r,i,a=0,o=n.length;a<o;a++){var s=n[a],c=s.ids,p;if(c.length>t){r||(r={});var w=c.length-t;p={pos:s.pos+w,ids:Pi(c,w)};for(var f=0;f<w;f++){var m=s.pos+f+"-"+c[f].id;r[m]=!0}}else p={pos:s.pos,ids:Pi(c,0)};i?i=Ii(i,p,!0).tree:i=[p]}return r&&We(i,function(S,A,x){delete r[A+"-"+x]}),{tree:i,revs:r?Object.keys(r):[]}}function Bi(e,t,n){var r=Ii(e,t),i=_s(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function ms(e,t){for(var n=e.slice(),r=t.split("-"),i=parseInt(r[0],10),a=r[1],o;o=n.pop();){if(o.pos===i&&o.ids[0]===a)return!0;for(var s=o.ids[2],c=0,p=s.length;c<p;c++)n.push({pos:o.pos+1,ids:s[c]})}return!1}function ws(e){return e.ids}function Ne(e,t){t||(t=Ge(e));for(var n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(ws),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function He(e){return/^_local/.test(e)}function bs(e,t){for(var n=t.rev_tree.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,o=a[0],s=a[1],c=a[2],p=c.length===0,w=r.history?r.history.slice():[];if(w.push({id:o,pos:i,opts:s}),p)for(var f=0,m=w.length;f<m;f++){var S=w[f],A=S.pos+"-"+S.id;if(A===e)return i+"-"+o}for(var x=0,$=c.length;x<$;x++)n.push({pos:i+1,ids:c[x],history:w})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function $s(e,t,n,r){try{e.emit("change",t,n,r)}catch(i){Ee("error",'Error in .on("change", function):',i)}}function Os(e,t,n){var r=[{rev:e._rev}];n.style==="all_docs"&&(r=Jn(t.rev_tree).map(function(a){return{rev:a.rev}}));var i={id:t.id,changes:r,doc:e};return Ne(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=Gn(t),i.doc._conflicts.length||delete i.doc._conflicts),i}class Ss extends Ae{constructor(t,n,r){super(),this.db=t,n=n?he(n):{};var i=n.complete=vi((s,c)=>{s?Zo(this,"error")>0&&this.emit("error",s):this.emit("complete",c),this.removeAllListeners(),t.removeListener("destroyed",a)});r&&(this.on("complete",function(s){r(null,s)}),this.on("error",r));const a=()=>{this.cancel()};t.once("destroyed",a),n.onChange=(s,c,p)=>{this.isCancelled||$s(this,s,c,p)};var o=new Promise(function(s,c){n.complete=function(p,w){p?c(p):s(w)}});this.once("cancel",function(){t.removeListener("destroyed",a),n.complete(null,{status:"cancelled"})}),this.then=o.then.bind(o),this.catch=o.catch.bind(o),this.then(function(s){i(null,s)},i),t.taskqueue.isReady?this.validateChanges(n):t.taskqueue.addTask(s=>{s?n.complete(s):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(t){var n=t.complete;X._changesFilterPlugin?X._changesFilterPlugin.validate(t,r=>{if(r)return n(r);this.doChanges(t)}):this.doChanges(t)}doChanges(t){var n=t.complete;if(t=he(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Os,t.since==="latest"&&(t.since="now"),t.since||(t.since=0),t.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}t.since=i.update_seq,this.doChanges(t)},n);return}if(X._changesFilterPlugin){if(X._changesFilterPlugin.normalize(t),X._changesFilterPlugin.shouldFilter(this,t))return X._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(i){i in t&&Ee("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=t.limit===0?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&typeof r.cancel=="function"){const i=this.cancel;this.cancel=(...a)=>{r.cancel(),i.apply(this,a)}}}}function Ri(e,t){return e<t?-1:e>t?1:0}function Wn(e,t){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=t,e(n)):e(null,r.length?r[0]:r)}}function ks(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var a=r[i];n._attachments[a]=qt(n._attachments[a],["data","digest","content_type","length","revpos","stub"])}}}function As(e,t){var n=Ri(e._id,t._id);if(n!==0)return n;var r=e._revisions?e._revisions.start:0,i=t._revisions?t._revisions.start:0;return Ri(r,i)}function Es(e){var t={},n=[];return We(e,function(r,i,a,o){var s=i+"-"+a;return r&&(t[s]=0),o!==void 0&&n.push({from:o,to:s}),s}),n.reverse(),n.forEach(function(r){t[r.from]===void 0?t[r.from]=1+t[r.to]:t[r.from]=Math.min(t[r.from],1+t[r.to])}),t}function xs(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function Li(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),e._compact(n,function(a,o){a?r(a):r(null,o),me(function(){e._compactionQueue.shift(),e._compactionQueue.length&&Li(e)})})})}function Cs(e,t,n){return e.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:t,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:t,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return e.put(r)})}function Ts(e){return e.charAt(0)==="_"?e+" is not a valid attachment name, attachment names cannot start with '_'":!1}class Di extends Ae{_setup(){this.post=ce("post",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof t!="object"||Array.isArray(t))return r(ee(Bn));this.bulkDocs({docs:[t]},n,Wn(r,t._id))}).bind(this),this.put=ce("put",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof t!="object"||Array.isArray(t))return r(ee(Bn));if($i(t._id),He(t._id)&&typeof this._putLocal=="function")return t._deleted?this._removeLocal(t,r):this._putLocal(t,r);const i=o=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(t,n,o):this.bulkDocs({docs:[t]},n,Wn(o,t._id))};n.force&&t._rev?(a(),i(function(o){var s=o?null:{ok:!0,id:t._id,rev:t._rev};r(o,s)})):i(r);function a(){var o=t._rev.split("-"),s=o[1],c=parseInt(o[0],10),p=c+1,w=Ti();t._revisions={start:p,ids:[w,s]},t._rev=p+"-"+w,n.new_edits=!1}}).bind(this),this.putAttachment=ce("putAttachment",function(t,n,r,i,a){var o=this;typeof a=="function"&&(a=i,i=r,r=null),typeof a=="undefined"&&(a=i,i=r,r=null),a||Ee("warn","Attachment",n,"on document",t,"is missing content_type");function s(c){var p="_rev"in c?parseInt(c._rev,10):0;return c._attachments=c._attachments||{},c._attachments[n]={content_type:a,data:i,revpos:++p},o.put(c)}return o.get(t).then(function(c){if(c._rev!==r)throw ee(vt);return s(c)},function(c){if(c.reason===xe.message)return s({_id:t});throw c})}).bind(this),this.removeAttachment=ce("removeAttachment",function(t,n,r,i){this.get(t,(a,o)=>{if(a){i(a);return}if(o._rev!==r){i(ee(vt));return}if(!o._attachments)return i();delete o._attachments[n],Object.keys(o._attachments).length===0&&delete o._attachments,this.put(o,i)})}).bind(this),this.remove=ce("remove",function(t,n,r,i){var a;typeof n=="string"?(a={_id:t,_rev:n},typeof r=="function"&&(i=r,r={})):(a=t,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var o={_id:a._id,_rev:a._rev||r.rev};if(o._deleted=!0,He(o._id)&&typeof this._removeLocal=="function")return this._removeLocal(a,i);this.bulkDocs({docs:[o]},r,Wn(i,o._id))}).bind(this),this.revsDiff=ce("revsDiff",function(t,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(t);if(!i.length)return r(null,{});var a=0,o=new $e;function s(p,w){o.has(p)||o.set(p,{missing:[]}),o.get(p).missing.push(w)}function c(p,w){var f=t[p].slice(0);We(w,function(m,S,A,x,$){var g=S+"-"+A,v=f.indexOf(g);v!==-1&&(f.splice(v,1),$.status!=="available"&&s(p,g))}),f.forEach(function(m){s(p,m)})}i.map(function(p){this._getRevisionTree(p,function(w,f){if(w&&w.status===404&&w.message==="missing")o.set(p,{missing:t[p]});else{if(w)return r(w);c(p,f)}if(++a===i.length){var m={};return o.forEach(function(S,A){m[A]=S}),r(null,m)}})},this)}).bind(this),this.bulkGet=ce("bulkGet",function(t,n){pi(this,t,n)}).bind(this),this.compactDocument=ce("compactDocument",function(t,n,r){this._getRevisionTree(t,(i,a)=>{if(i)return r(i);var o=Es(a),s=[],c=[];Object.keys(o).forEach(function(p){o[p]>n&&s.push(p)}),We(a,function(p,w,f,m,S){var A=w+"-"+f;S.status==="available"&&s.indexOf(A)!==-1&&c.push(A)}),this._doCompaction(t,c,r)})}).bind(this),this.compact=ce("compact",function(t,n){typeof t=="function"&&(n=t,t={}),t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:n}),this._compactionQueue.length===1&&Li(this)}).bind(this),this.get=ce("get",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof t!="string")return r(ee(_i));if(He(t)&&typeof this._getLocal=="function")return this._getLocal(t,r);var i=[];const a=()=>{var c=[],p=i.length;if(!p)return r(null,c);i.forEach(w=>{this.get(t,{rev:w,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(f,m){if(f)c.push({missing:w});else{for(var S,A=0,x=c.length;A<x;A++)if(c[A].ok&&c[A].ok._rev===m._rev){S=!0;break}S||c.push({ok:m})}p--,p||r(null,c)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(t,function(c,p){if(c)return r(c);i=Jn(p).map(function(w){return w.rev}),a()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var o=0;o<i.length;o++){var s=i[o];if(!(typeof s=="string"&&/^\d+-/.test(s)))return r(ee(bi))}a()}else return r(ee(In,"function_clause"));return}return this._get(t,n,(c,p)=>{if(c)return c.docId=t,r(c);var w=p.doc,f=p.metadata,m=p.ctx;if(n.conflicts){var S=Gn(f);S.length&&(w._conflicts=S)}if(Ne(f,w._rev)&&(w._deleted=!0),n.revs||n.revs_info){for(var A=w._rev.split("-"),x=parseInt(A[0],10),$=A[1],g=qi(f.rev_tree),v=null,u=0;u<g.length;u++){var l=g[u],y=l.ids.map(function(G){return G.id}).indexOf($),_=y===x-1;(_||!v&&y!==-1)&&(v=l)}if(!v)return c=new Error("invalid rev tree"),c.docId=t,r(c);var P=v.ids.map(function(G){return G.id}).indexOf(w._rev.split("-")[1])+1,I=v.ids.length-P;if(v.ids.splice(P,I),v.ids.reverse(),n.revs&&(w._revisions={start:v.pos+v.ids.length-1,ids:v.ids.map(function(G){return G.id})}),n.revs_info){var j=v.pos+v.ids.length;w._revs_info=v.ids.map(function(G){return j--,{rev:j+"-"+G.id,status:G.opts.status}})}}if(n.attachments&&w._attachments){var F=w._attachments,U=Object.keys(F).length;if(U===0)return r(null,w);Object.keys(F).forEach(G=>{this._getAttachment(w._id,G,F[G],{rev:w._rev,binary:n.binary,ctx:m},function(z,J){var W=w._attachments[G];W.data=J,delete W.stub,delete W.length,--U||r(null,w)})})}else{if(w._attachments)for(var Y in w._attachments)Object.prototype.hasOwnProperty.call(w._attachments,Y)&&(w._attachments[Y].stub=!0);r(null,w)}})}).bind(this),this.getAttachment=ce("getAttachment",function(t,n,r,i){r instanceof Function&&(i=r,r={}),this._get(t,r,(a,o)=>{if(a)return i(a);if(o.doc._attachments&&o.doc._attachments[n])r.ctx=o.ctx,r.binary=!0,this._getAttachment(t,n,o.doc._attachments[n],r,i);else return i(ee(xe))})}).bind(this),this.allDocs=ce("allDocs",function(t,n){if(typeof t=="function"&&(n=t,t={}),t.skip=typeof t.skip!="undefined"?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in t})[0];if(r){n(ee(Ho,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!Ie(this)&&(xs(t),t.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(t,n)}).bind(this),this.close=ce("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}).bind(this),this.info=ce("info",function(t){this._info((n,r)=>{if(n)return t(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!Ie(this)),r.adapter=this.adapter,t(null,r)})}).bind(this),this.id=ce("id",function(t){return this._id(t)}).bind(this),this.bulkDocs=ce("bulkDocs",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return r(ee(Jo));for(var i=0;i<t.docs.length;++i)if(typeof t.docs[i]!="object"||Array.isArray(t.docs[i]))return r(ee(Bn));var a;if(t.docs.forEach(function(c){c._attachments&&Object.keys(c._attachments).forEach(function(p){a=a||Ts(p),c._attachments[p].content_type||Ee("warn","Attachment",p,"on document",c._id,"is missing content_type")})}),a)return r(ee(nn,a));"new_edits"in n||("new_edits"in t?n.new_edits=t.new_edits:n.new_edits=!0);var o=this;!n.new_edits&&!Ie(o)&&t.docs.sort(As),ks(t.docs);var s=t.docs.map(function(c){return c._id});this._bulkDocs(t,n,function(c,p){if(c)return r(c);if(n.new_edits||(p=p.filter(function(m){return m.error})),!Ie(o))for(var w=0,f=p.length;w<f;w++)p[w].id=p[w].id||s[w];r(null,p)})}).bind(this),this.registerDependentDatabase=ce("registerDependentDatabase",function(t,n){var r=he(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(t,r);function a(o){return o.dependentDbs=o.dependentDbs||{},o.dependentDbs[t]?!1:(o.dependentDbs[t]=!0,o)}an(this,"_local/_pouch_dependentDbs",a).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=ce("destroy",function(t,n){typeof t=="function"&&(n=t,t={});var r="use_prefix"in this?this.use_prefix:!0;const i=()=>{this._destroy(t,(a,o)=>{if(a)return n(a);this._destroyed=!0,this.emit("destroyed"),n(null,o||{ok:!0})})};if(Ie(this))return i();this.get("_local/_pouch_dependentDbs",(a,o)=>{if(a)return a.status!==404?n(a):i();var s=o.dependentDbs,c=this.constructor,p=Object.keys(s).map(w=>{var f=r?w.replace(new RegExp("^"+c.prefix),""):w;return new c(f,this.__opts).destroy()});Promise.all(p).then(i,n)})}).bind(this)}_compact(t,n){var r={return_docs:!1,last_seq:t.last_seq||0},i=[],a,o=0;const s=w=>{this.activeTasks.update(a,{completed_items:++o}),i.push(this.compactDocument(w.id,0))},c=w=>{this.activeTasks.remove(a,w),n(w)},p=w=>{var f=w.last_seq;Promise.all(i).then(()=>an(this,"_local/compaction",m=>!m.last_seq||m.last_seq<f?(m.last_seq=f,m):!1)).then(()=>{this.activeTasks.remove(a),n(null,{ok:!0})}).catch(c)};this.info().then(w=>{a=this.activeTasks.add({name:"database_compaction",total_items:w.update_seq-r.last_seq}),this.changes(r).on("change",s).on("complete",p).on("error",c)})}changes(t,n){return typeof t=="function"&&(n=t,t={}),t=t||{},t.return_docs="return_docs"in t?t.return_docs:!t.live,new Ss(this,t,n)}type(){return typeof this._type=="function"?this._type():this.adapter}}Di.prototype.purge=ce("_purge",function(e,t,n){if(typeof this._purge=="undefined")return n(ee(In,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(e,(i,a)=>{if(i)return n(i);if(!a)return n(ee(xe));let o;try{o=hs(a,t)}catch(s){return n(s.message||s)}r._purge(e,o,(s,c)=>{if(s)return n(s);Cs(r,e,t).then(function(){return n(null,c)})})})});let qs=class{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()}fail(t){this.failed=t,this.execute()}ready(t){this.isReady=!0,this.db=t,this.execute()}addTask(t){this.queue.push(t),this.failed&&this.execute()}};function Ps(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=X.adapters,i=X.preferredAdapters,a=X.prefix,o=t.adapter;if(!o)for(var s=0;s<i.length;++s){if(o=i[s],o==="idb"&&"websql"in r&&tn()&&localStorage["_pouch__websqldb_"+a+e]){Ee("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var c=r[o],p=c&&"use_prefix"in c?c.use_prefix:!0;return{name:p?a+e:e,adapter:o}}function js(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e}})}function Ni(e,t){let n=function(...r){if(!(this instanceof n))return new n(...r);t.apply(this,r)};return js(n,e),n}function Is(e){function t(r){e.removeListener("closed",n),r||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}class Mi extends Di{constructor(t,n){super(),this._setup(t,n)}_setup(t,n){if(super._setup(),n=n||{},t&&typeof t=="object"&&(n=t,t=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=he(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=X.prefix,typeof t!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+t,i=Ps(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=t,this._adapter=n.adapter,X.emit("debug",["adapter","Picked adapter: ",n.adapter]),!X.adapters[n.adapter]||!X.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!X.adapters[n.view_adapter]||!X.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new qs,this.adapter=n.adapter,X.adapters[n.adapter].call(this,n,a=>{if(a)return this.taskqueue.fail(a);Is(this),this.emit("created",this),X.emit("created",this.name),this.taskqueue.ready(this)})}}const X=Ni(Mi,function(e,t){Mi.prototype._setup.call(this,e,t)});var Bs=typeof AbortController!="undefined"?AbortController:function(){return{abort:function(){}}},Fi=fetch,gt=Headers;class Rs{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(t){const n=Tn();return this.tasks[n]={id:n,name:t.name,total_items:t.total_items,created_at:new Date().toJSON()},n}get(t){return this.tasks[t]}remove(t,n){return delete this.tasks[t],this.tasks}update(t,n){const r=this.tasks[t];if(typeof r!="undefined"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[t]=i}return this.tasks}}X.adapters={},X.preferredAdapters=[],X.prefix="_pouch_";var Ui=new Ae;function Ls(e){Object.keys(Ae.prototype).forEach(function(n){typeof Ae.prototype[n]=="function"&&(e[n]=Ui[n].bind(Ui))});var t=e._destructionListeners=new $e;e.on("ref",function(r){t.has(r.name)||t.set(r.name,[]),t.get(r.name).push(r)}),e.on("unref",function(r){if(t.has(r.name)){var i=t.get(r.name),a=i.indexOf(r);a<0||(i.splice(a,1),i.length>1?t.set(r.name,i):t.delete(r.name))}}),e.on("destroyed",function(r){if(t.has(r)){var i=t.get(r);t.delete(r),i.forEach(function(a){a.emit("destroyed",!0)})}})}Ls(X),X.adapter=function(e,t,n){t.valid()&&(X.adapters[e]=t,n&&X.preferredAdapters.push(e))},X.plugin=function(e){if(typeof e=="function")e(X);else{if(typeof e!="object"||Object.keys(e).length===0)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){X.prototype[t]=e[t]})}return this.__defaults&&(X.__defaults=Je({},this.__defaults)),X},X.defaults=function(e){let t=Ni(X,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Je({},t.__defaults,r),X.call(this,n,r)});return t.preferredAdapters=X.preferredAdapters.slice(),Object.keys(X).forEach(function(n){n in t||(t[n]=X[n])}),t.__defaults=Je({},this.__defaults,e),t},X.fetch=function(e,t){return Fi(e,t)},X.prototype.activeTasks=X.activeTasks=new Rs;var Ds="8.0.0";function Hn(e,t){for(var n=e,r=0,i=t.length;r<i;r++){var a=t[r];if(n=n[a],!n)break}return n}function Ns(e,t){return e<t?-1:e>t?1:0}function Xn(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var a=e[r];r>0&&e[r-1]==="\\"&&(a==="$"||a===".")?n=n.substring(0,n.length-1)+a:a==="."?(t.push(n),n=""):n+=a}return t.push(n),t}var Ms=["$or","$nor","$not"];function Ki(e){return Ms.indexOf(e)>-1}function zi(e){return Object.keys(e)[0]}function Fs(e){return e[zi(e)]}function jt(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var a=r[i];if(typeof a!="object"&&(a={$eq:a}),Ki(i))if(a instanceof Array){if(n[i]){n[i]=!1,t[i]=a;return}var o=[];t[i].forEach(function(c){Object.keys(a).forEach(function(p){var w=a[p],f=Math.max(Object.keys(c).length,Object.keys(w).length),m=jt([c,w]);Object.keys(m).length<=f||o.push(m)})}),t[i]=o}else t[i]=jt([a]);else{var s=t[i]=t[i]||{};Object.keys(a).forEach(function(c){var p=a[c];if(c==="$gt"||c==="$gte")return Us(c,p,s);if(c==="$lt"||c==="$lte")return Ks(c,p,s);if(c==="$ne")return zs(p,s);if(c==="$eq")return Qs(p,s);if(c==="$regex")return Js(p,s);s[c]=p})}})}),t}function Us(e,t,n){typeof n.$eq=="undefined"&&(typeof n.$gte!="undefined"?e==="$gte"?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt!="undefined"?e==="$gte"?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}function Ks(e,t,n){typeof n.$eq=="undefined"&&(typeof n.$lte!="undefined"?e==="$lte"?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt!="undefined"?e==="$lte"?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}function zs(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function Qs(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function Js(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}function Qi(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=jt(e[n].$and));var r=e[t];typeof r=="object"&&Qi(r)}return e}function Ji(e,t){for(var n in e){n==="$and"&&(t=!0);var r=e[n];typeof r=="object"&&(t=Ji(r,t))}return t}function Gs(e){var t=he(e);Ji(t,!1)&&(t=Qi(t),"$and"in t&&(t=jt(t.$and))),["$or","$nor"].forEach(function(o){o in t&&t[o].forEach(function(s){for(var c=Object.keys(s),p=0;p<c.length;p++){var w=c[p],f=s[w];(typeof f!="object"||f===null)&&(s[w]={$eq:f})}})}),"$not"in t&&(t.$not=jt([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],a=t[i];(typeof a!="object"||a===null)&&(a={$eq:a}),t[i]=a}return Yn(t),t}function Yn(e){Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&Yn(r)}):t==="$ne"?e.$ne=[n]:t==="$regex"?e.$regex=[n]:n&&typeof n=="object"&&Yn(n)})}function Ws(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function Hs(e,t,n){var r=Ws(e,t,n);return r+e}var Gi=-324,Zn=3,Vn="";function fe(e,t){if(e===t)return 0;e=Xe(e),t=Xe(t);var n=er(e),r=er(t);if(n-r!==0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return tu(e,t)}return Array.isArray(e)?eu(e,t):nu(e,t)}function Xe(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=Xe(t[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i];typeof a!="undefined"&&(e[i]=Xe(a))}}}}return e}function Xs(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return ru(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,a="";if(t)for(;++r<i;)a+=Te(n[r]);else for(;++r<i;){var o=n[r];a+=Te(o)+Te(e[o])}return a}return""}function Te(e){var t="\0";return e=Xe(e),er(e)+Vn+Xs(e)+t}function Ys(e,t){var n=t,r,i=e[t]==="1";if(i)r=0,t++;else{var a=e[t]==="0";t++;var o="",s=e.substring(t,t+Zn),c=parseInt(s,10)+Gi;for(a&&(c=-c),t+=Zn;;){var p=e[t];if(p==="\0")break;o+=p,t++}o=o.split("."),o.length===1?r=parseInt(o,10):r=parseFloat(o[0]+"."+o[1]),a&&(r=r-10),c!==0&&(r=parseFloat(r+"e"+c))}return{num:r,length:t-n}}function Zs(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,a=r.index;if(Array.isArray(i))i.push(n);else if(a===e.length-2){var o=e.pop();i[o]=n}else e.push(n)}}function Vs(e){for(var t=[],n=[],r=0;;){var i=e[r++];if(i==="\0"){if(t.length===1)return t.pop();Zs(t,n);continue}switch(i){case"1":t.push(null);break;case"2":t.push(e[r]==="1"),r++;break;case"3":var a=Ys(e,r);t.push(a.num),r+=a.length;break;case"4":for(var o="";;){var s=e[r];if(s==="\0")break;o+=s,r++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(o);break;case"5":var c={element:[],index:t.length};t.push(c.element),n.push(c);break;case"6":var p={element:{},index:t.length};t.push(p.element),n.push(p);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function eu(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=fe(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1}function tu(e,t){return e===t?0:e>t?1:-1}function nu(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),a=0;a<i;a++){var o=fe(n[a],r[a]);if(o!==0||(o=fe(e[n[a]],t[r[a]]),o!==0))return o}return n.length===r.length?0:n.length>r.length?1:-1}function er(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);if(~n)return e===null?1:Array.isArray(e)?5:n<3?n+2:n+3;if(Array.isArray(e))return 5}function ru(e){if(e===0)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",a=(r?-n:n)-Gi,o=Hs(a.toString(),"0",Zn);i+=Vn+o;var s=Math.abs(parseFloat(t[0]));r&&(s=10-s);var c=s.toFixed(20);return c=c.replace(/\.?0+$/,""),i+=Vn+c,i}function iu(e){function t(n){return e.map(function(r){var i=zi(r),a=Xn(i),o=Hn(n,a);return o})}return function(n,r){var i=t(n.doc),a=t(r.doc),o=fe(i,a);return o!==0?o:Ns(n.doc._id,r.doc._id)}}function au(e,t,n){if(e=e.filter(function(o){return pt(o.doc,t.selector,n)}),t.sort){var r=iu(t.sort);e=e.sort(r),typeof t.sort[0]!="string"&&Fs(t.sort[0])==="desc"&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,a=("limit"in t?t.limit:e.length)+i;e=e.slice(i,a)}return e}function pt(e,t,n){return n.every(function(r){var i=t[r],a=Xn(r),o=Hn(e,a);return Ki(r)?ou(r,i,e):sn(i,e,a,o)})}function sn(e,t,n,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var a=e[i];if(i.indexOf("$")===0)return Wi(i,t,a,n,r);var o=Xn(i);if(r===void 0&&typeof a!="object"&&o.length>0)return!1;var s=Hn(r,o);return typeof a=="object"?sn(a,t,n,s):Wi("$eq",t,a,o,s)}):e===r:!0}function ou(e,t,n){return e==="$or"?t.some(function(r){return pt(n,r,Object.keys(r))}):e==="$not"?!pt(n,t,Object.keys(t)):!t.find(function(r){return pt(n,r,Object.keys(r))})}function Wi(e,t,n,r,i){if(!Xi[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Xi[e](t,n,r,i)}function It(e){return typeof e!="undefined"&&e!==null}function Ye(e){return typeof e!="undefined"}function su(e,t){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var n=t[0],r=t[1];return e%n===r}function Hi(e,t){return t.some(function(n){return e instanceof Array?e.some(function(r){return fe(n,r)===0}):fe(n,e)===0})}function uu(e,t){return t.every(function(n){return e.some(function(r){return fe(n,r)===0})})}function cu(e,t){return e.length===t}function fu(e,t){var n=new RegExp(t);return n.test(e)}function lu(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var Xi={$elemMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return pt(i,t,Object.keys(t))}):r.some(function(i){return sn(t,e,n,i)})},$allMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return pt(i,t,Object.keys(t))}):r.every(function(i){return sn(t,e,n,i)})},$eq:function(e,t,n,r){return Ye(r)&&fe(r,t)===0},$gte:function(e,t,n,r){return Ye(r)&&fe(r,t)>=0},$gt:function(e,t,n,r){return Ye(r)&&fe(r,t)>0},$lte:function(e,t,n,r){return Ye(r)&&fe(r,t)<=0},$lt:function(e,t,n,r){return Ye(r)&&fe(r,t)<0},$exists:function(e,t,n,r){return t?Ye(r):!Ye(r)},$mod:function(e,t,n,r){return It(r)&&su(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return fe(r,i)!==0})},$in:function(e,t,n,r){return It(r)&&Hi(r,t)},$nin:function(e,t,n,r){return It(r)&&!Hi(r,t)},$size:function(e,t,n,r){return It(r)&&Array.isArray(r)&&cu(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&uu(r,t)},$regex:function(e,t,n,r){return It(r)&&typeof r=="string"&&t.every(function(i){return fu(r,i)})},$type:function(e,t,n,r){return lu(r,t)}};function du(e,t){if(typeof t!="object")throw new Error("Selector error: expected a JSON object");t=Gs(t);var n={doc:e},r=au([n],{selector:t},Object.keys(t));return r&&r.length===1}function hu(e){return Nn(`"use strict";
return `+e+";",{})}function vu(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Nn(t,{})}function yu(e,t){if(e.selector&&e.filter&&e.filter!=="_selector"){var n=typeof e.filter=="string"?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function gu(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&typeof e.filter=="string"&&(e.filter==="_view"?e.view=Oi(e.view):e.filter=Oi(e.filter))}function pu(e,t){return t.filter&&typeof t.filter=="string"&&!t.doc_ids&&!Ie(e.db)}function _u(e,t){var n=t.complete;if(t.filter==="_view"){if(!t.view||typeof t.view!="string"){var r=ee(nn,"`view` filter parameter not found or invalid.");return n(r)}var i=Dn(t.view);e.db.get("_design/"+i[0],function(o,s){if(e.isCancelled)return n(null,{status:"cancelled"});if(o)return n(yt(o));var c=s&&s.views&&s.views[i[1]]&&s.views[i[1]].map;if(!c)return n(ee(xe,s.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=vu(c),e.doChanges(t)})}else if(t.selector)t.filter=function(o){return du(o,t.selector)},e.doChanges(t);else{var a=Dn(t.filter);e.db.get("_design/"+a[0],function(o,s){if(e.isCancelled)return n(null,{status:"cancelled"});if(o)return n(yt(o));var c=s&&s.filters&&s.filters[a[1]];if(!c)return n(ee(xe,s&&s.filters?"missing json key: "+a[1]:"missing json key: filters"));t.filter=hu(c),e.doChanges(t)})}}function mu(e){e._changesFilterPlugin={validate:yu,normalize:gu,shouldFilter:pu,filter:_u}}X.plugin(mu),X.version=Ds;function Yi(e){return e.reduce(function(t,n){return t[n]=!0,t},{})}var wu=Yi(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),bu=Yi(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Zi(e){if(!/^\d+-/.test(e))return ee(bi);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function $u(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],a=1,o=r.length;a<o;a++)i=[r[a],{status:"missing"},[i]];return[{pos:n,ids:i}]}function Vi(e,t,n){n||(n={deterministic_revs:!0});var r,i,a,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=on()),i=Ti(e,n.deterministic_revs),e._rev){if(a=Zi(e._rev),a.error)return a;e._rev_tree=[{pos:a.prefix,ids:[a.id,{status:"missing"},[[i,o,[]]]]}],r=a.prefix+1}else e._rev_tree=[{pos:1,ids:[i,o,[]]}],r=1;else if(e._revisions&&(e._rev_tree=$u(e._revisions,o),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if(a=Zi(e._rev),a.error)return a;r=a.prefix,i=a.id,e._rev_tree=[{pos:r,ids:[i,o,[]]}]}$i(e._id),e._rev=r+"-"+i;var s={metadata:{},data:{}};for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){var p=c[0]==="_";if(p&&!wu[c]){var w=ee(wi,c);throw w.message=wi.message+": "+c,w}else p&&!bu[c]?s.metadata[c.slice(1)]=e[c]:s.data[c]=e[c]}return s}function Ou(e){try{return Mn(e)}catch(n){var t=ee(mi,"Attachment is not a valid base64 string");return{error:t}}}function Su(e,t,n){var r=Ou(e.data);if(r.error)return n(r.error);e.length=r.length,t==="blob"?e.data=Un(r,e.content_type):t==="base64"?e.data=Pt(r):e.data=r,Qn(r,function(i){e.digest="md5-"+i,n()})}function ku(e,t,n){Qn(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,t==="binary"?xi(e.data,function(i){e.data=i,n()}):t==="base64"?zn(e.data,function(i){e.data=i,n()}):n()})}function Au(e,t,n){if(e.stub)return n();typeof e.data=="string"?Su(e,t,n):ku(e,t,n)}function Eu(e,t,n){if(!e.length)return n();var r=0,i;e.forEach(function(o){var s=o.data&&o.data._attachments?Object.keys(o.data._attachments):[],c=0;if(!s.length)return a();function p(f){i=f,c++,c===s.length&&a()}for(var w in o.data._attachments)Object.prototype.hasOwnProperty.call(o.data._attachments,w)&&Au(o.data._attachments[w],t,p)});function a(){r++,e.length===r&&(i?n(i):n())}}function xu(e,t,n,r,i,a,o,s){if(ms(t.rev_tree,n.metadata.rev)&&!s)return r[i]=n,a();var c=t.winningRev||Ge(t),p="deleted"in t?t.deleted:Ne(t,c),w="deleted"in n.metadata?n.metadata.deleted:Ne(n.metadata),f=/^1-/.test(n.metadata.rev);if(p&&!w&&s&&f){var m=n.data;m._rev=c,m._id=n.metadata.id,n=Vi(m,s)}var S=Bi(t.rev_tree,n.metadata.rev_tree[0],e),A=s&&(p&&w&&S.conflicts!=="new_leaf"||!p&&S.conflicts!=="new_leaf"||p&&!w&&S.conflicts==="new_branch");if(A){var x=ee(vt);return r[i]=x,a()}var $=n.metadata.rev;n.metadata.rev_tree=S.tree,n.stemmedRevs=S.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var g=Ge(n.metadata),v=Ne(n.metadata,g),u=p===v?0:p<v?-1:1,l;$===g?l=v:l=Ne(n.metadata,$),o(n,g,v,l,!0,u,i,a)}function Cu(e){return e.metadata.rev_tree[0].ids[1].status==="missing"}function Tu(e,t,n,r,i,a,o,s,c){e=e||1e3;function p(x,$,g){var v=Ge(x.metadata),u=Ne(x.metadata,v);if("was_delete"in s&&u)return a[$]=ee(xe,"deleted"),g();var l=w&&Cu(x);if(l){var y=ee(vt);return a[$]=y,g()}var _=u?0:1;o(x,v,u,u,!1,_,$,g)}var w=s.new_edits,f=new $e,m=0,S=t.length;function A(){++m===S&&c&&c()}t.forEach(function(x,$){if(x._id&&He(x._id)){var g=x._deleted?"_removeLocal":"_putLocal";n[g](x,{ctx:i},function(u,l){a[$]=u||l,A()});return}var v=x.metadata.id;f.has(v)?(S--,f.get(v).push([x,$])):f.set(v,[[x,$]])}),f.forEach(function(x,$){var g=0;function v(){++g<x.length?u():A()}function u(){var l=x[g],y=l[0],_=l[1];if(r.has($))xu(e,r.get($),y,a,_,v,o,w);else{var P=Bi([],y.metadata.rev_tree[0],e);y.metadata.rev_tree=P.tree,y.stemmedRevs=P.stemmedRevs||[],p(y,_,v)}}u()})}var qu=5,le="document-store",pe="by-sequence",Ce="attach-store",Ze="attach-seq-store",we="meta-store",Be="local-store",tr="detect-blob-support";function Pu(e){try{return JSON.parse(e)}catch(t){return Yt.parse(e)}}function ju(e){try{return JSON.stringify(e)}catch(t){return Yt.stringify(e)}}function Re(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(ee(Rn,n,t.type))}}function nr(e,t,n){return{data:ju(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Ve(e){if(!e)return null;var t=Pu(e.data);return t.winningRev=e.winningRev,t.deleted=e.deletedOrLocal==="1",t.seq=e.seq,t}function un(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function ea(e,t,n,r){n?r(e?typeof e!="string"?e:Kn(e,t):Fn([""],{type:t})):e?typeof e!="string"?Ei(e,function(i){r(Pt(i))}):r(e):r("")}function ta(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var a=0;function o(){++a===i.length&&r&&r()}function s(c,p){var w=c._attachments[p],f=w.digest,m=n.objectStore(Ce).get(f);m.onsuccess=function(S){w.body=S.target.result.body,o()}}i.forEach(function(c){t.attachments&&t.include_docs?s(e,c):(e._attachments[c].stub=!0,o())})}function rr(e,t){return Promise.all(e.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var a=n.doc._attachments[i];if("body"in a){var o=a.body,s=a.content_type;return new Promise(function(c){ea(o,s,t,function(p){n.doc._attachments[i]=Je(qt(a,["digest","content_type"]),{data:p}),c()})})}}))}}))}function na(e,t,n){var r=[],i=n.objectStore(pe),a=n.objectStore(Ce),o=n.objectStore(Ze),s=e.length;function c(){s--,s||p()}function p(){r.length&&r.forEach(function(w){var f=o.index("digestSeq").count(IDBKeyRange.bound(w+"::",w+"::￿",!1,!1));f.onsuccess=function(m){var S=m.target.result;S||a.delete(w)}})}e.forEach(function(w){var f=i.index("_doc_id_rev"),m=t+"::"+w;f.getKey(m).onsuccess=function(S){var A=S.target.result;if(typeof A!="number")return c();i.delete(A);var x=o.index("seq").openCursor(IDBKeyRange.only(A));x.onsuccess=function($){var g=$.target.result;if(g){var v=g.value.digestSeq.split("::")[0];r.push(v),o.delete(g.primaryKey),g.continue()}else c()}}})}function qe(e,t,n){try{return{txn:e.transaction(t,n)}}catch(r){return{error:r}}}var Bt=new Ko;function Iu(e,t,n,r,i,a){for(var o=t.docs,s,c,p,w,f,m,S,A,x=0,$=o.length;x<$;x++){var g=o[x];g._id&&He(g._id)||(g=o[x]=Vi(g,n.new_edits,e),g.error&&!S&&(S=g))}if(S)return a(S);var v=!1,u=0,l=new Array(o.length),y=new $e,_=!1,P=r._meta.blobSupport?"blob":"base64";Eu(o,P,function(O){if(O)return a(O);I()});function I(){var O=[le,pe,Ce,Be,Ze,we],C=qe(i,O,"readwrite");if(C.error)return a(C.error);s=C.txn,s.onabort=Re(a),s.ontimeout=Re(a),s.oncomplete=G,c=s.objectStore(le),p=s.objectStore(pe),w=s.objectStore(Ce),f=s.objectStore(Ze),m=s.objectStore(we),m.get(we).onsuccess=function(B){A=B.target.result,U()},J(function(B){if(B)return _=!0,a(B);Y()})}function j(){v=!0,U()}function F(){Tu(e.revs_limit,o,r,y,s,l,W,n,j)}function U(){!A||!v||(A.docCount+=u,m.put(A))}function Y(){if(!o.length)return;var O=0;function C(){++O===o.length&&F()}function B(q){var R=Ve(q.target.result);R&&y.set(R.id,R),C()}for(var D=0,T=o.length;D<T;D++){var k=o[D];if(k._id&&He(k._id)){C();continue}var E=c.get(k.metadata.id);E.onsuccess=B}}function G(){_||(Bt.notify(r._meta.name),a(null,l))}function z(O,C){var B=w.get(O);B.onsuccess=function(D){if(D.target.result)C();else{var T=ee(Xo,"unknown stub attachment with digest "+O);T.status=412,C(T)}}}function J(O){var C=[];if(o.forEach(function(k){k.data&&k.data._attachments&&Object.keys(k.data._attachments).forEach(function(E){var q=k.data._attachments[E];q.stub&&C.push(q.digest)})}),!C.length)return O();var B=0,D;function T(){++B===C.length&&O(D)}C.forEach(function(k){z(k,function(E){E&&!D&&(D=E),T()})})}function W(O,C,B,D,T,k,E,q){O.metadata.winningRev=C,O.metadata.deleted=B;var R=O.data;R._id=O.metadata.id,R._rev=O.metadata.rev,D&&(R._deleted=!0);var L=R._attachments&&Object.keys(R._attachments).length;if(L)return d(O,C,B,T,E,q);u+=k,U(),te(O,C,B,T,E,q)}function te(O,C,B,D,T,k){var E=O.data,q=O.metadata;E._doc_id_rev=q.id+"::"+q.rev,delete E._id,delete E._rev;function R(oe){var ye=O.stemmedRevs||[];D&&r.auto_compaction&&(ye=ye.concat(ds(O.metadata))),ye&&ye.length&&na(ye,O.metadata.id,s),q.seq=oe.target.result;var be=nr(q,C,B),N=c.put(be);N.onsuccess=Z}function L(oe){oe.preventDefault(),oe.stopPropagation();var ye=p.index("_doc_id_rev"),be=ye.getKey(E._doc_id_rev);be.onsuccess=function(N){var K=p.put(E,N.target.result);K.onsuccess=R}}function Z(){l[T]={ok:!0,id:q.id,rev:q.rev},y.set(O.metadata.id,O.metadata),h(O,q.seq,k)}var re=p.put(E);re.onsuccess=R,re.onerror=L}function d(O,C,B,D,T,k){var E=O.data,q=0,R=Object.keys(E._attachments);function L(){q===R.length&&te(O,C,B,D,T,k)}function Z(){q++,L()}R.forEach(function(re){var oe=O.data._attachments[re];if(oe.stub)q++,L();else{var ye=oe.data;delete oe.data,oe.revpos=parseInt(C,10);var be=oe.digest;b(be,ye,Z)}})}function h(O,C,B){var D=0,T=Object.keys(O.data._attachments||{});if(!T.length)return B();function k(){++D===T.length&&B()}function E(R){var L=O.data._attachments[R].digest,Z=f.put({seq:C,digestSeq:L+"::"+C});Z.onsuccess=k,Z.onerror=function(re){re.preventDefault(),re.stopPropagation(),k()}}for(var q=0;q<T.length;q++)E(T[q])}function b(O,C,B){var D=w.count(O);D.onsuccess=function(T){var k=T.target.result;if(k)return B();var E={digest:O,body:C},q=w.put(E);q.onsuccess=B}}}function ra(e,t,n,r,i){r===-1&&(r=1e3);var a=typeof e.getAll=="function"&&typeof e.getAllKeys=="function"&&r>1&&!n,o,s,c;function p(S){s=S.target.result,o&&i(o,s,c)}function w(S){o=S.target.result,s&&i(o,s,c)}function f(){if(!o.length)return i();var S=o[o.length-1],A;if(t&&t.upper)try{A=IDBKeyRange.bound(S,t.upper,!0,t.upperOpen)}catch(x){if(x.name==="DataError"&&x.code===0)return i()}else A=IDBKeyRange.lowerBound(S,!0);t=A,o=null,s=null,e.getAll(t,r).onsuccess=p,e.getAllKeys(t,r).onsuccess=w}function m(S){var A=S.target.result;if(!A)return i();i([A.key],[A.value],A)}a?(c={continue:f},e.getAll(t,r).onsuccess=p,e.getAllKeys(t,r).onsuccess=w):n?e.openCursor(t,"prev").onsuccess=m:e.openCursor(t).onsuccess=m}function Bu(e,t,n){if(typeof e.getAll=="function"){e.getAll(t).onsuccess=n;return}var r=[];function i(a){var o=a.target.result;o?(r.push(o.value),o.continue()):n({target:{result:r}})}e.openCursor(t).onsuccess=i}function Ru(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(a,o){t.get(a).onsuccess=function(s){s.target.result?r[o]=s.target.result:r[o]={key:a,error:"not_found"},i++,i===e.length&&n(e,r,{})}})}function Lu(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(a){return{error:a}}return null}function Du(e,t,n){var r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,a="key"in e?e.key:!1,o="keys"in e?e.keys:!1,s=e.skip||0,c=typeof e.limit=="number"?e.limit:-1,p=e.inclusive_end!==!1,w,f;if(!o&&(w=Lu(r,i,p,a,e.descending),f=w&&w.error,f&&!(f.name==="DataError"&&f.code===0)))return n(ee(Rn,f.name,f.message));var m=[le,pe,we];e.attachments&&m.push(Ce);var S=qe(t,m,"readonly");if(S.error)return n(S.error);var A=S.txn;A.oncomplete=G,A.onabort=Re(n);var x=A.objectStore(le),$=A.objectStore(pe),g=A.objectStore(we),v=$.index("_doc_id_rev"),u=[],l,y;g.get(we).onsuccess=function(z){l=z.target.result.docCount},e.update_seq&&_($,function(z){z.target.result&&z.target.result.length>0&&(y=z.target.result[0])});function _(z,J){function W(te){var d=te.target.result,h=void 0;return d&&d.key&&(h=d.key),J({target:{result:[h]}})}z.openCursor(null,"prev").onsuccess=W}function P(z,J,W){var te=z.id+"::"+W;v.get(te).onsuccess=function(h){if(J.doc=un(h.target.result)||{},e.conflicts){var b=Gn(z);b.length&&(J.doc._conflicts=b)}ta(J.doc,e,A)}}function I(z,J){var W={id:J.id,key:J.id,value:{rev:z}},te=J.deleted;te?o&&(u.push(W),W.value.deleted=!0,W.doc=null):s--<=0&&(u.push(W),e.include_docs&&P(J,W,z))}function j(z){for(var J=0,W=z.length;J<W&&u.length!==c;J++){var te=z[J];if(te.error&&o){u.push(te);continue}var d=Ve(te),h=d.winningRev;I(h,d)}}function F(z,J,W){W&&(j(J),u.length<c&&W.continue())}function U(z){var J=z.target.result;e.descending&&(J=J.reverse()),j(J)}function Y(){var z={total_rows:l,offset:e.skip,rows:u};e.update_seq&&y!==void 0&&(z.update_seq=y),n(null,z)}function G(){e.attachments?rr(u,e.binary).then(Y):Y()}if(!(f||c===0)){if(o)return Ru(e.keys,x,F);if(c===-1)return Bu(x,w,U);ra(x,w,e.descending,c+s,F)}}function Nu(e){return new Promise(function(t){var n=Fn([""]),r=e.objectStore(tr).put(n,"key");r.onsuccess=function(){var i=navigator.userAgent.match(/Chrome\/(\d+)/),a=navigator.userAgent.match(/Edge\//);t(a||!i||parseInt(i[1],10)>=43)},r.onerror=e.onabort=function(i){i.preventDefault(),i.stopPropagation(),t(!1)}}).catch(function(){return!1})}function Mu(e,t){var n=e.objectStore(le).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){t(r.target.result)}}var ir=!1,ar=[];function Fu(e,t,n,r){try{e(t,n)}catch(i){r.emit("error",i)}}function ia(){ir||!ar.length||(ir=!0,ar.shift()())}function Uu(e,t,n){ar.push(function(){e(function(a,o){Fu(t,a,o,n),ir=!1,me(function(){ia()})})}),ia()}function Ku(e,t,n,r){if(e=he(e),e.continuous){var i=n+":"+on();return Bt.addListener(n,i,t,e),Bt.notify(n),{cancel:function(){Bt.removeListener(n,i)}}}var a=e.doc_ids&&new ht(e.doc_ids);e.since=e.since||0;var o=e.since,s="limit"in e?e.limit:-1;s===0&&(s=1);var c=[],p=0,w=Ln(e),f=new $e,m,S,A,x;function $(I,j,F){if(!F||!I.length)return;var U=new Array(I.length),Y=new Array(I.length);function G(W,te){var d=e.processChange(te,W,e);o=d.seq=W.seq;var h=w(d);return typeof h=="object"?Promise.reject(h):h?(p++,e.return_docs&&c.push(d),e.attachments&&e.include_docs?new Promise(function(b){ta(te,e,m,function(){rr([d],e.binary).then(function(){b(d)})})}):Promise.resolve(d)):Promise.resolve()}function z(){for(var W=[],te=0,d=U.length;te<d&&p!==s;te++){var h=U[te];if(h){var b=Y[te];W.push(G(b,h))}}Promise.all(W).then(function(O){for(var C=0,B=O.length;C<B;C++)O[C]&&e.onChange(O[C])}).catch(e.complete),p!==s&&F.continue()}var J=0;j.forEach(function(W,te){var d=un(W),h=I[te];v(d,h,function(b,O){Y[te]=b,U[te]=O,++J===I.length&&z()})})}function g(I,j,F,U){if(F.seq!==j)return U();if(F.winningRev===I._rev)return U(F,I);var Y=I._id+"::"+F.winningRev,G=x.get(Y);G.onsuccess=function(z){U(F,un(z.target.result))}}function v(I,j,F){if(a&&!a.has(I._id))return F();var U=f.get(I._id);if(U)return g(I,j,U,F);A.get(I._id).onsuccess=function(Y){U=Ve(Y.target.result),f.set(I._id,U),g(I,j,U,F)}}function u(){e.complete(null,{results:c,last_seq:o})}function l(){!e.continuous&&e.attachments?rr(c).then(u):u()}var y=[le,pe];e.attachments&&y.push(Ce);var _=qe(r,y,"readonly");if(_.error)return e.complete(_.error);m=_.txn,m.onabort=Re(e.complete),m.oncomplete=l,S=m.objectStore(pe),A=m.objectStore(le),x=S.index("_doc_id_rev");var P=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;ra(S,P,e.descending,s,$)}var _t=new $e,or,sr=new $e;function aa(e,t){var n=this;Uu(function(r){zu(n,e,r)},t,n.constructor)}function zu(e,t,n){var r=t.name,i=null,a=null;e._meta=null;function o($){return function(g,v){g&&g instanceof Error&&!g.reason&&a&&(g.reason=a),$(g,v)}}function s($){var g=$.createObjectStore(le,{keyPath:"id"});$.createObjectStore(pe,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),$.createObjectStore(Ce,{keyPath:"digest"}),$.createObjectStore(we,{keyPath:"id",autoIncrement:!1}),$.createObjectStore(tr),g.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),$.createObjectStore(Be,{keyPath:"_id"});var v=$.createObjectStore(Ze,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function c($,g){var v=$.objectStore(le);v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),v.openCursor().onsuccess=function(u){var l=u.target.result;if(l){var y=l.value,_=Ne(y);y.deletedOrLocal=_?"1":"0",v.put(y),l.continue()}else g()}}function p($){$.createObjectStore(Be,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function w($,g){var v=$.objectStore(Be),u=$.objectStore(le),l=$.objectStore(pe),y=u.openCursor();y.onsuccess=function(_){var P=_.target.result;if(P){var I=P.value,j=I.id,F=He(j),U=Ge(I);if(F){var Y=j+"::"+U,G=j+"::",z=j+"::~",J=l.index("_doc_id_rev"),W=IDBKeyRange.bound(G,z,!1,!1),te=J.openCursor(W);te.onsuccess=function(d){if(te=d.target.result,!te)u.delete(P.primaryKey),P.continue();else{var h=te.value;h._doc_id_rev===Y&&v.put(h),l.delete(te.primaryKey),te.continue()}}}else P.continue()}else g&&g()}}function f($){var g=$.createObjectStore(Ze,{autoIncrement:!0});g.createIndex("seq","seq"),g.createIndex("digestSeq","digestSeq",{unique:!0})}function m($,g){var v=$.objectStore(pe),u=$.objectStore(Ce),l=$.objectStore(Ze),y=u.count();y.onsuccess=function(_){var P=_.target.result;if(!P)return g();v.openCursor().onsuccess=function(I){var j=I.target.result;if(!j)return g();for(var F=j.value,U=j.primaryKey,Y=Object.keys(F._attachments||{}),G={},z=0;z<Y.length;z++){var J=F._attachments[Y[z]];G[J.digest]=!0}var W=Object.keys(G);for(z=0;z<W.length;z++){var te=W[z];l.put({seq:U,digestSeq:te+"::"+U})}j.continue()}}}function S($){function g(y){return y.data?Ve(y):(y.deleted=y.deletedOrLocal==="1",y)}var v=$.objectStore(pe),u=$.objectStore(le),l=u.openCursor();l.onsuccess=function(y){var _=y.target.result;if(!_)return;var P=g(_.value);P.winningRev=P.winningRev||Ge(P);function I(){var F=P.id+"::",U=P.id+"::￿",Y=v.index("_doc_id_rev").openCursor(IDBKeyRange.bound(F,U)),G=0;Y.onsuccess=function(z){var J=z.target.result;if(!J)return P.seq=G,j();var W=J.primaryKey;W>G&&(G=W),J.continue()}}function j(){var F=nr(P,P.winningRev,P.deleted),U=u.put(F);U.onsuccess=function(){_.continue()}}if(P.seq)return j();I()}}e._remote=!1,e.type=function(){return"idb"},e._id=yi(function($){$(null,e._meta.instanceId)}),e._bulkDocs=function(g,v,u){Iu(t,g,v,e,i,o(u))},e._get=function(g,v,u){var l,y,_,P=v.ctx;if(!P){var I=qe(i,[le,pe,Ce],"readonly");if(I.error)return u(I.error);P=I.txn}function j(){u(_,{doc:l,metadata:y,ctx:P})}P.objectStore(le).get(g).onsuccess=function(F){if(y=Ve(F.target.result),!y)return _=ee(xe,"missing"),j();var U;if(v.rev)U=v.latest?bs(v.rev,y):v.rev;else{U=y.winningRev;var Y=Ne(y);if(Y)return _=ee(xe,"deleted"),j()}var G=P.objectStore(pe),z=y.id+"::"+U;G.index("_doc_id_rev").get(z).onsuccess=function(J){if(l=J.target.result,l&&(l=un(l)),!l)return _=ee(xe,"missing"),j();j()}}},e._getAttachment=function($,g,v,u,l){var y;if(u.ctx)y=u.ctx;else{var _=qe(i,[le,pe,Ce],"readonly");if(_.error)return l(_.error);y=_.txn}var P=v.digest,I=v.content_type;y.objectStore(Ce).get(P).onsuccess=function(j){var F=j.target.result.body;ea(F,I,u.binary,function(U){l(null,U)})}},e._info=function(g){var v,u,l=qe(i,[we,pe],"readonly");if(l.error)return g(l.error);var y=l.txn;y.objectStore(we).get(we).onsuccess=function(_){u=_.target.result.docCount},y.objectStore(pe).openCursor(null,"prev").onsuccess=function(_){var P=_.target.result;v=P?P.key:0},y.oncomplete=function(){g(null,{doc_count:u,update_seq:v,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(g,v){Du(g,i,o(v))},e._changes=function(g){return Ku(g,e,r,i)},e._close=function($){i.close(),_t.delete(r),$()},e._getRevisionTree=function($,g){var v=qe(i,[le],"readonly");if(v.error)return g(v.error);var u=v.txn,l=u.objectStore(le).get($);l.onsuccess=function(y){var _=Ve(y.target.result);_?g(null,_.rev_tree):g(ee(xe))}},e._doCompaction=function($,g,v){var u=[le,pe,Ce,Ze],l=qe(i,u,"readwrite");if(l.error)return v(l.error);var y=l.txn,_=y.objectStore(le);_.get($).onsuccess=function(P){var I=Ve(P.target.result);We(I.rev_tree,function(U,Y,G,z,J){var W=Y+"-"+G;g.indexOf(W)!==-1&&(J.status="missing")}),na(g,$,y);var j=I.winningRev,F=I.deleted;y.objectStore(le).put(nr(I,j,F))},y.onabort=Re(v),y.oncomplete=function(){v()}},e._getLocal=function($,g){var v=qe(i,[Be],"readonly");if(v.error)return g(v.error);var u=v.txn,l=u.objectStore(Be).get($);l.onerror=Re(g),l.onsuccess=function(y){var _=y.target.result;_?(delete _._doc_id_rev,g(null,_)):g(ee(xe))}},e._putLocal=function($,g,v){typeof g=="function"&&(v=g,g={}),delete $._revisions;var u=$._rev,l=$._id;u?$._rev="0-"+(parseInt(u.split("-")[1],10)+1):$._rev="0-1";var y=g.ctx,_;if(!y){var P=qe(i,[Be],"readwrite");if(P.error)return v(P.error);y=P.txn,y.onerror=Re(v),y.oncomplete=function(){_&&v(null,_)}}var I=y.objectStore(Be),j;u?(j=I.get(l),j.onsuccess=function(F){var U=F.target.result;if(!U||U._rev!==u)v(ee(vt));else{var Y=I.put($);Y.onsuccess=function(){_={ok:!0,id:$._id,rev:$._rev},g.ctx&&v(null,_)}}}):(j=I.add($),j.onerror=function(F){v(ee(vt)),F.preventDefault(),F.stopPropagation()},j.onsuccess=function(){_={ok:!0,id:$._id,rev:$._rev},g.ctx&&v(null,_)})},e._removeLocal=function($,g,v){typeof g=="function"&&(v=g,g={});var u=g.ctx;if(!u){var l=qe(i,[Be],"readwrite");if(l.error)return v(l.error);u=l.txn,u.oncomplete=function(){y&&v(null,y)}}var y,_=$._id,P=u.objectStore(Be),I=P.get(_);I.onerror=Re(v),I.onsuccess=function(j){var F=j.target.result;!F||F._rev!==$._rev?v(ee(xe)):(P.delete(_),y={ok:!0,id:_,rev:"0-0"},g.ctx&&v(null,y))}},e._destroy=function($,g){Bt.removeAllListeners(r);var v=sr.get(r);v&&v.result&&(v.result.close(),_t.delete(r));var u=indexedDB.deleteDatabase(r);u.onsuccess=function(){sr.delete(r),tn()&&r in localStorage&&delete localStorage[r],g(null,{ok:!0})},u.onerror=Re(g)};var A=_t.get(r);if(A)return i=A.idb,e._meta=A.global,me(function(){n(null,e)});var x=indexedDB.open(r,qu);sr.set(r,x),x.onupgradeneeded=function($){var g=$.target.result;if($.oldVersion<1)return s(g);var v=$.currentTarget.transaction;$.oldVersion<3&&p(g),$.oldVersion<4&&f(g);var u=[c,w,m,S],l=$.oldVersion;function y(){var _=u[l-1];l++,_&&_(v,y)}y()},x.onsuccess=function($){i=$.target.result,i.onversionchange=function(){i.close(),_t.delete(r)},i.onabort=function(j){Ee("error","Database has a window failure",j.target.error),a=j.target.error,i.close(),_t.delete(r)};var g=i.transaction([we,tr,le],"readwrite"),v=!1,u,l,y,_;function P(){typeof y=="undefined"||!v||(e._meta={name:r,instanceId:_,blobSupport:y},_t.set(r,{idb:i,window:e._meta}),n(null,e))}function I(){if(!(typeof l=="undefined"||typeof u=="undefined")){var j=r+"_id";j in u?_=u[j]:u[j]=_=on(),u.docCount=l,g.objectStore(we).put(u)}}g.objectStore(we).get(we).onsuccess=function(j){u=j.target.result||{id:we},I()},Mu(g,function(j){l=j,I()}),or||(or=Nu(g)),or.then(function(j){y=j,P()}),g.oncomplete=function(){v=!0,P()},g.onabort=Re(n)},x.onerror=function($){var g=$.target.error&&$.target.error.message;g?g.indexOf("stored database is a higher version")!==-1&&(g=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):g="Failed to open indexedDB, are you in private browsing mode?",Ee("error",g),n(ee(Rn,g))}}aa.valid=function(){try{return typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch(e){return!1}};function Qu(e){e.adapter("idb",aa,!0)}function Ju(e,t){return new Promise(function(n,r){var i=0,a=0,o=0,s=e.length,c;function p(){i++,e[a++]().then(f,m)}function w(){++o===s?c?r(c):n():S()}function f(){i--,w()}function m(A){i--,c=c||A,w()}function S(){for(;i<t&&a<s;)p()}S()})}const Gu=25,Wu=50,cn=5e3,Hu=1e4;let ur={};function cr(e){let t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach(function(r){let i=n[r];i.data=Kn(i.data,i.content_type)})}function et(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function oa(e){return!e._attachments||!Object.keys(e._attachments)?Promise.resolve():Promise.all(Object.keys(e._attachments).map(function(t){let n=e._attachments[t];if(n.data&&typeof n.data!="string")return new Promise(function(r){zn(n.data,r)}).then(function(r){n.data=r})}))}function Xu(e){if(!e.prefix)return!1;let t=Ai(e.prefix).protocol;return t==="http"||t==="https"}function Yu(e,t){if(Xu(t)){let i=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}let n=Ai(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});let r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function ve(e,t){return fn(e,e.db+"/"+t)}function fn(e,t){let n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function ln(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function Zu(e){let t=typeof navigator!="undefined"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=t.indexOf("msie")!==-1,r=t.indexOf("trident")!==-1,i=t.indexOf("edge")!==-1,a=!("method"in e)||e.method==="GET";return(n||r||i)&&a}function fr(e,t){let n=this,r=Yu(e.name,e),i=ve(r,"");e=he(e);const a=function(f,m){return M(this,null,function*(){if(m=m||{},m.headers=m.headers||new gt,m.credentials="include",e.auth||r.auth){let x=e.auth||r.auth,$=x.username+":"+x.password,g=Pt(unescape(encodeURIComponent($)));m.headers.set("Authorization","Basic "+g)}let S=e.headers||{};return Object.keys(S).forEach(function(x){m.headers.append(x,S[x])}),Zu(m)&&(f+=(f.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),yield(e.fetch||Fi)(f,m)})};function o(f,m){return ce(f,function(...S){p().then(function(){return m.apply(this,S)}).catch(function(A){S.pop()(A)})}).bind(n)}function s(f,m){return M(this,null,function*(){let S={};m=m||{},m.headers=m.headers||new gt,m.headers.get("Content-Type")||m.headers.set("Content-Type","application/json"),m.headers.get("Accept")||m.headers.set("Accept","application/json");const A=yield a(f,m);S.ok=A.ok,S.status=A.status;const x=yield A.json();if(S.data=x,!S.ok)throw S.data.status=S.status,yt(S.data);return Array.isArray(S.data)&&(S.data=S.data.map(function($){return $.error||$.missing?yt($):$})),S})}let c;function p(){return M(this,null,function*(){return e.skip_setup?Promise.resolve():c||(c=s(i).catch(function(f){return f&&f.status&&f.status===404?(Pn(404,"PouchDB is just detecting if the remote exists."),s(i,{method:"PUT"})):Promise.reject(f)}).catch(function(f){return f&&f.status&&f.status===412?!0:Promise.reject(f)}),c.catch(function(){c=null}),c)})}me(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=o("id",function(f){return M(this,null,function*(){let m;try{m=yield(yield a(fn(r,""))).json()}catch(A){m={}}let S=m&&m.uuid?m.uuid+r.db:ve(r,"");f(null,S)})}),n.compact=o("compact",function(f,m){return M(this,null,function*(){typeof f=="function"&&(m=f,f={}),f=he(f),yield s(ve(r,"_compact"),{method:"POST"});function S(){n.info(function(A,x){x&&!x.compact_running?m(null,{ok:!0}):setTimeout(S,f.interval||200)})}S()})}),n.bulkGet=ce("bulkGet",function(f,m){let S=this;function A(v){return M(this,null,function*(){let u={};f.revs&&(u.revs=!0),f.attachments&&(u.attachments=!0),f.latest&&(u.latest=!0);try{const l=yield s(ve(r,"_bulk_get"+ln(u)),{method:"POST",body:JSON.stringify({docs:f.docs})});f.attachments&&f.binary&&l.data.results.forEach(function(y){y.docs.forEach(cr)}),v(null,l.data)}catch(l){v(l)}})}function x(){let v=Wu,u=Math.ceil(f.docs.length/v),l=0,y=new Array(u);function _(P){return function(I,j){y[P]=j.results,++l===u&&m(null,{results:rn(y)})}}for(let P=0;P<u;P++){let I=qt(f,["revs","attachments","binary","latest"]);I.docs=f.docs.slice(P*v,Math.min(f.docs.length,(P+1)*v)),pi(S,I,_(P))}}let $=fn(r,""),g=ur[$];typeof g!="boolean"?A(function(v,u){v?(ur[$]=!1,Pn(v.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),x()):(ur[$]=!0,m(null,u))}):g?A(m):x()}),n._info=function(f){return M(this,null,function*(){try{yield p();const S=yield(yield a(ve(r,""))).json();S.host=ve(r,""),f(null,S)}catch(m){f(m)}})},n.fetch=function(f,m){return M(this,null,function*(){yield p();const S=f.substring(0,1)==="/"?fn(r,f.substring(1)):ve(r,f);return a(S,m)})},n.get=o("get",function(f,m,S){return M(this,null,function*(){typeof m=="function"&&(S=m,m={}),m=he(m);let A={};m.revs&&(A.revs=!0),m.revs_info&&(A.revs_info=!0),m.latest&&(A.latest=!0),m.open_revs&&(m.open_revs!=="all"&&(m.open_revs=JSON.stringify(m.open_revs)),A.open_revs=m.open_revs),m.rev&&(A.rev=m.rev),m.conflicts&&(A.conflicts=m.conflicts),m.update_seq&&(A.update_seq=m.update_seq),f=et(f);function x(v){let u=v._attachments,l=u&&Object.keys(u);if(!u||!l.length)return;function y(P){return M(this,null,function*(){const I=u[P],j=et(v._id)+"/"+w(P)+"?rev="+v._rev,F=yield a(ve(r,j));let U;"buffer"in F?U=yield F.buffer():U=yield F.blob();let Y;if(m.binary){let G=Object.getOwnPropertyDescriptor(U.__proto__,"type");(!G||G.set)&&(U.type=I.content_type),Y=U}else Y=yield new Promise(function(G){zn(U,G)});delete I.stub,delete I.length,I.data=Y})}let _=l.map(function(P){return function(){return y(P)}});return Ju(_,5)}function $(v){return Array.isArray(v)?Promise.all(v.map(function(u){if(u.ok)return x(u.ok)})):x(v)}const g=ve(r,f+ln(A));try{const v=yield s(g);m.attachments&&(yield $(v.data)),S(null,v.data)}catch(v){v.docId=f,S(v)}})}),n.remove=o("remove",function(f,m,S,A){return M(this,null,function*(){let x;typeof m=="string"?(x={_id:f,_rev:m},typeof S=="function"&&(A=S,S={})):(x=f,typeof m=="function"?(A=m,S={}):(A=S,S=m));const $=x._rev||S.rev,g=ve(r,et(x._id))+"?rev="+$;try{const v=yield s(g,{method:"DELETE"});A(null,v.data)}catch(v){A(v)}})});function w(f){return f.split("/").map(encodeURIComponent).join("/")}n.getAttachment=o("getAttachment",function(f,m,S,A){return M(this,null,function*(){typeof S=="function"&&(A=S,S={});const x=S.rev?"?rev="+S.rev:"",$=ve(r,et(f))+"/"+w(m)+x;let g;try{const u=yield a($,{method:"GET"});if(!u.ok)throw u;g=u.headers.get("content-type");let l;if(typeof process!="undefined"&&!process.browser&&typeof u.buffer=="function"?l=yield u.buffer():l=yield u.blob(),typeof process!="undefined"&&!process.browser){var v=Object.getOwnPropertyDescriptor(l.__proto__,"type");(!v||v.set)&&(l.type=g)}A(null,l)}catch(u){A(u)}})}),n.removeAttachment=o("removeAttachment",function(f,m,S,A){return M(this,null,function*(){const x=ve(r,et(f)+"/"+w(m))+"?rev="+S;try{const $=yield s(x,{method:"DELETE"});A(null,$.data)}catch($){A($)}})}),n.putAttachment=o("putAttachment",function(f,m,S,A,x,$){return M(this,null,function*(){typeof x=="function"&&($=x,x=A,A=S,S=null);const g=et(f)+"/"+w(m);let v=ve(r,g);if(S&&(v+="?rev="+S),typeof A=="string"){let u;try{u=Mn(A)}catch(l){return $(ee(mi,"Attachment is not a valid base64 string"))}A=u?Un(u,x):""}try{const u=yield s(v,{headers:new gt({"Content-Type":x}),method:"PUT",body:A});$(null,u.data)}catch(u){$(u)}})}),n._bulkDocs=function(f,m,S){return M(this,null,function*(){f.new_edits=m.new_edits;try{yield p(),yield Promise.all(f.docs.map(oa));const A=yield s(ve(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(f)});S(null,A.data)}catch(A){S(A)}})},n._put=function(f,m,S){return M(this,null,function*(){try{yield p(),yield oa(f);const A=yield s(ve(r,et(f._id)),{method:"PUT",body:JSON.stringify(f)});S(null,A.data)}catch(A){A.docId=f&&f._id,S(A)}})},n.allDocs=o("allDocs",function(f,m){return M(this,null,function*(){typeof f=="function"&&(m=f,f={}),f=he(f);let S={},A,x="GET";f.conflicts&&(S.conflicts=!0),f.update_seq&&(S.update_seq=!0),f.descending&&(S.descending=!0),f.include_docs&&(S.include_docs=!0),f.attachments&&(S.attachments=!0),f.key&&(S.key=JSON.stringify(f.key)),f.start_key&&(f.startkey=f.start_key),f.startkey&&(S.startkey=JSON.stringify(f.startkey)),f.end_key&&(f.endkey=f.end_key),f.endkey&&(S.endkey=JSON.stringify(f.endkey)),typeof f.inclusive_end!="undefined"&&(S.inclusive_end=!!f.inclusive_end),typeof f.limit!="undefined"&&(S.limit=f.limit),typeof f.skip!="undefined"&&(S.skip=f.skip);let $=ln(S);typeof f.keys!="undefined"&&(x="POST",A={keys:f.keys});try{const g=yield s(ve(r,"_all_docs"+$),{method:x,body:JSON.stringify(A)});f.include_docs&&f.attachments&&f.binary&&g.data.rows.forEach(cr),m(null,g.data)}catch(g){m(g)}})}),n._changes=function(f){let m="batch_size"in f?f.batch_size:Gu;f=he(f),f.continuous&&!("heartbeat"in f)&&(f.heartbeat=Hu);let S="timeout"in f?f.timeout:30*1e3;"timeout"in f&&f.timeout&&S-f.timeout<cn&&(S=f.timeout+cn),"heartbeat"in f&&f.heartbeat&&S-f.heartbeat<cn&&(S=f.heartbeat+cn);let A={};"timeout"in f&&f.timeout&&(A.timeout=f.timeout);let x=typeof f.limit!="undefined"?f.limit:!1,$=x;if(f.style&&(A.style=f.style),(f.include_docs||f.filter&&typeof f.filter=="function")&&(A.include_docs=!0),f.attachments&&(A.attachments=!0),f.continuous&&(A.feed="longpoll"),f.seq_interval&&(A.seq_interval=f.seq_interval),f.conflicts&&(A.conflicts=!0),f.descending&&(A.descending=!0),f.update_seq&&(A.update_seq=!0),"heartbeat"in f&&f.heartbeat&&(A.heartbeat=f.heartbeat),f.filter&&typeof f.filter=="string"&&(A.filter=f.filter),f.view&&typeof f.view=="string"&&(A.filter="_view",A.view=f.view),f.query_params&&typeof f.query_params=="object")for(let I in f.query_params)Object.prototype.hasOwnProperty.call(f.query_params,I)&&(A[I]=f.query_params[I]);let g="GET",v;f.doc_ids?(A.filter="_doc_ids",g="POST",v={doc_ids:f.doc_ids}):f.selector&&(A.filter="_selector",g="POST",v={selector:f.selector});let u=new Bs,l;const y=function(I,j){return M(this,null,function*(){if(f.aborted)return;A.since=I,typeof A.since=="object"&&(A.since=JSON.stringify(A.since)),f.descending?x&&(A.limit=$):A.limit=!x||$>m?m:$;let F=ve(r,"_changes"+ln(A)),U={signal:u.signal,method:g,body:JSON.stringify(v)};if(l=I,!f.aborted)try{yield p();const Y=yield s(F,U);j(null,Y.data)}catch(Y){j(Y)}})};let _={results:[]};const P=function(I,j){if(f.aborted)return;let F=0;if(j&&j.results){F=j.results.length,_.last_seq=j.last_seq;let Y=null,G=null;typeof j.pending=="number"&&(Y=j.pending),(typeof _.last_seq=="string"||typeof _.last_seq=="number")&&(G=_.last_seq),f.query_params,j.results=j.results.filter(function(z){$--;let J=Ln(f)(z);return J&&(f.include_docs&&f.attachments&&f.binary&&cr(z),f.return_docs&&_.results.push(z),f.onChange(z,Y,G)),J})}else if(I){f.aborted=!0,f.complete(I);return}j&&j.last_seq&&(l=j.last_seq);let U=x&&$<=0||j&&F<m||f.descending;f.continuous&&!(x&&$<=0)||!U?me(function(){y(l,P)}):f.complete(null,_)};return y(f.since||0,P),{cancel:function(){f.aborted=!0,u.abort()}}},n.revsDiff=o("revsDiff",function(f,m,S){return M(this,null,function*(){typeof m=="function"&&(S=m,m={});try{const A=yield s(ve(r,"_revs_diff"),{method:"POST",body:JSON.stringify(f)});S(null,A.data)}catch(A){S(A)}})}),n._close=function(f){f()},n._destroy=function(f,m){return M(this,null,function*(){try{const S=yield s(ve(r,""),{method:"DELETE"});m(null,S)}catch(S){S.status===404?m(null,{ok:!0}):m(S)}})}}fr.valid=function(){return!0};function Vu(e){e.adapter("http",fr,!1),e.adapter("https",fr,!1)}let mt=class extends Error{constructor(t){super(),this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,mt)}catch(n){}}},lr=class extends Error{constructor(t){super(),this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,lr)}catch(n){}}},dr=class extends Error{constructor(t){super(),this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,dr)}catch(n){}}};function sa(e,t){return t&&e.then(function(n){me(function(){t(null,n)})},function(n){me(function(){t(n)})}),e}function ec(e){return function(...t){var n=t.pop(),r=e.apply(this,t);return typeof n=="function"&&sa(r,n),r}}function tc(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function hr(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function ua(e){var t=new ht(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function vr(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}function ca(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new dr(t)}function yr(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if(typeof i!="number")if(Array.isArray(i)){t=typeof t=="number"?[t]:t;for(var a=0,o=i.length;a<o;a++){var s=i[a];if(typeof s!="number")throw ca("_sum");typeof t[a]=="undefined"?t.push(s):t[a]+=s}}else throw ca("_sum");else typeof t=="number"?t+=i:t[0]+=i}return t}var nc=Ee.bind(null,"log"),rc=Array.isArray,ic=JSON.parse;function fa(e,t){return Nn("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:yr,log:nc,isArray:rc,toJSON:ic})}let gr=class{constructor(){this.promise=new Promise(function(t){t()})}add(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise}finish(){return this.promise}};function la(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function ac(e,t){return la(e)+la(t)+"undefined"}function da(e,t,n,r,i,a){return M(this,null,function*(){const o=ac(n,r);let s;if(!i&&(s=e._cachedViews=e._cachedViews||{},s[o]))return s[o];const c=e.info().then(function(p){return M(this,null,function*(){const w=p.db_name+"-mrview-"+(i?"temp":Ci(o));function f($){$.views=$.views||{};let g=t;g.indexOf("/")===-1&&(g=t+"/"+t);const v=$.views[g]=$.views[g]||{};if(!v[w])return v[w]=!0,$}yield an(e,"_local/"+a,f);const S=(yield e.registerDependentDatabase(w)).db;S.auto_compaction=!0;const A={name:w,db:S,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};let x;try{x=yield A.db.get("_local/lastSeq")}catch($){if($.status!==404)throw $}return A.seq=x?x.seq:0,s&&A.db.once("destroyed",function(){delete s[o]}),A})});return s&&(s[o]=c),c})}var ha={},va=new gr,oc=50;function pr(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function sc(e){return e.length===1&&/^1-/.test(e[0].rev)}function ya(e,t,n){try{e.emit("error",t)}catch(r){Ee("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),Ee("error",t,n)}}function uc(e,t,n,r){function i(d,h,b){try{h(b)}catch(O){ya(d,O,{fun:h,doc:b})}}function a(d,h,b,O,C){try{return{output:h(b,O,C)}}catch(B){return ya(d,B,{fun:h,keys:b,values:O,rereduce:C}),{error:B}}}function o(d,h){const b=fe(d.key,h.key);return b!==0?b:fe(d.value,h.value)}function s(d,h,b){return b=b||0,typeof h=="number"?d.slice(b,h+b):b>0?d.slice(b):d}function c(d){const h=d.value;return h&&typeof h=="object"&&h._id||d.id}function p(d){d.rows.forEach(function(h){const b=h.doc&&h.doc._attachments;b&&Object.keys(b).forEach(function(O){const C=b[O];b[O].data=Kn(C.data,C.content_type)})})}function w(d){return function(h){return d.include_docs&&d.attachments&&d.binary&&p(h),h}}function f(d,h,b,O){let C=h[d];typeof C!="undefined"&&(O&&(C=encodeURIComponent(JSON.stringify(C))),b.push(d+"="+C))}function m(d){if(typeof d!="undefined"){const h=Number(d);return!isNaN(h)&&h===parseInt(d,10)?h:d}}function S(d){return d.group_level=m(d.group_level),d.limit=m(d.limit),d.skip=m(d.skip),d}function A(d){if(d){if(typeof d!="number")return new mt(`Invalid value for integer: "${d}"`);if(d<0)return new mt(`Invalid value for positive integer: "${d}"`)}}function x(d,h){const b=d.descending?"endkey":"startkey",O=d.descending?"startkey":"endkey";if(typeof d[b]!="undefined"&&typeof d[O]!="undefined"&&fe(d[b],d[O])>0)throw new mt("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(h.reduce&&d.reduce!==!1){if(d.include_docs)throw new mt("{include_docs:true} is invalid for reduce");if(d.keys&&d.keys.length>1&&!d.group&&!d.group_level)throw new mt("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(C){const B=A(d[C]);if(B)throw B})}function $(d,h,b){return M(this,null,function*(){let O=[],C,B="GET",D;if(f("reduce",b,O),f("include_docs",b,O),f("attachments",b,O),f("limit",b,O),f("descending",b,O),f("group",b,O),f("group_level",b,O),f("skip",b,O),f("stale",b,O),f("conflicts",b,O),f("startkey",b,O,!0),f("start_key",b,O,!0),f("endkey",b,O,!0),f("end_key",b,O,!0),f("inclusive_end",b,O),f("key",b,O,!0),f("update_seq",b,O),O=O.join("&"),O=O===""?"":"?"+O,typeof b.keys!="undefined"){const q=`keys=${encodeURIComponent(JSON.stringify(b.keys))}`;q.length+O.length+1<=2e3?O+=(O[0]==="?"?"&":"?")+q:(B="POST",typeof h=="string"?C={keys:b.keys}:h.keys=b.keys)}if(typeof h=="string"){const E=pr(h),q=yield d.fetch("_design/"+E[0]+"/_view/"+E[1]+O,{headers:new gt({"Content-Type":"application/json"}),method:B,body:JSON.stringify(C)});D=q.ok;const R=yield q.json();if(!D)throw R.status=q.status,yt(R);return R.rows.forEach(function(L){if(L.value&&L.value.error&&L.value.error==="builtin_reduce_error")throw new Error(L.reason)}),new Promise(function(L){L(R)}).then(w(b))}C=C||{},Object.keys(h).forEach(function(E){Array.isArray(h[E])?C[E]=h[E]:C[E]=h[E].toString()});const T=yield d.fetch("_temp_view"+O,{headers:new gt({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(C)});D=T.ok;const k=yield T.json();if(!D)throw k.status=T.status,yt(k);return new Promise(function(E){E(k)}).then(w(b))})}function g(d,h,b){return new Promise(function(O,C){d._query(h,b,function(B,D){if(B)return C(B);O(D)})})}function v(d){return new Promise(function(h,b){d._viewCleanup(function(O,C){if(O)return b(O);h(C)})})}function u(d){return function(h){if(h.status===404)return d;throw h}}function l(d,h,b){return M(this,null,function*(){const O="_local/doc_"+d,C={_id:O,keys:[]},B=b.get(d),D=B[0],T=B[1];function k(){return sc(T)?Promise.resolve(C):h.db.get(O).catch(u(C))}function E(Z){return Z.keys.length?h.db.allDocs({keys:Z.keys,include_docs:!0}):Promise.resolve({rows:[]})}function q(Z,re){const oe=[],ye=new ht;for(let N=0,K=re.rows.length;N<K;N++){const ne=re.rows[N].doc;if(ne&&(oe.push(ne),ye.add(ne._id),ne._deleted=!D.has(ne._id),!ne._deleted)){const V=D.get(ne._id);"value"in V&&(ne.value=V.value)}}const be=vr(D);return be.forEach(function(N){if(!ye.has(N)){const K={_id:N},Q=D.get(N);"value"in Q&&(K.value=Q.value),oe.push(K)}}),Z.keys=ua(be.concat(Z.keys)),oe.push(Z),oe}const R=yield k(),L=yield E(R);return q(R,L)})}function y(d){return d.sourceDB.get("_local/purges").then(function(h){const b=h.purgeSeq;return d.db.get("_local/purgeSeq").then(function(O){return O._rev}).catch(function(O){if(O.status!==404)throw O}).then(function(O){return d.db.put({_id:"_local/purgeSeq",_rev:O,purgeSeq:b})})}).catch(function(h){if(h.status!==404)throw h})}function _(d,h,b){var O="_local/lastSeq";return d.db.get(O).catch(u({_id:O,seq:0})).then(function(C){var B=vr(h);return Promise.all(B.map(function(D){return l(D,d,h)})).then(function(D){var T=rn(D);return C.seq=b,T.push(C),d.db.bulkDocs({docs:T})}).then(()=>y(d))})}function P(d){const h=typeof d=="string"?d:d.name;let b=ha[h];return b||(b=ha[h]=new gr),b}function I(d,h){return M(this,null,function*(){return hr(P(d),function(){return j(d,h)})()})}function j(d,h){return M(this,null,function*(){let b,O,C;function B(N,K){const Q={id:O._id,key:Xe(N)};typeof K!="undefined"&&K!==null&&(Q.value=Xe(K)),b.push(Q)}const D=t(d.mapFun,B);let T=d.seq||0;function k(){return d.sourceDB.info().then(function(N){C=d.sourceDB.activeTasks.add({name:"view_indexing",total_items:N.update_seq-T})})}function E(N,K){return function(){return _(d,N,K)}}let q=0;const R={view:d.name,indexed_docs:q};d.sourceDB.emit("indexing",R);const L=new gr;function Z(){return M(this,null,function*(){const N=yield d.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:T,limit:h.changes_batch_size}),K=yield re();return oe(N,K)})}function re(){return d.db.get("_local/purgeSeq").then(function(N){return N.purgeSeq}).catch(function(N){if(N&&N.status!==404)throw N;return-1}).then(function(N){return d.sourceDB.get("_local/purges").then(function(K){const Q=K.purges.filter(function(V,H){return H>N}).map(V=>V.docId),ne=Q.filter(function(V,H){return Q.indexOf(V)===H});return Promise.all(ne.map(function(V){return d.sourceDB.get(V).then(function(H){return{docId:V,doc:H}}).catch(function(H){if(H.status!==404)throw H;return{docId:V}})}))}).catch(function(K){if(K&&K.status!==404)throw K;return[]})})}function oe(N,K){var Q=N.results;if(!Q.length&&!K.length)return;for(let H of K)if(Q.findIndex(function(je){return je.id===H.docId})<0){const je={_id:H.docId,doc:{_id:H.docId,_deleted:1},changes:[]};H.doc&&(je.doc=H.doc,je.changes.push({rev:H.doc._rev})),Q.push(je)}var ne=ye(Q);L.add(E(ne,T)),q=q+Q.length;const V={view:d.name,last_seq:N.last_seq,results_count:Q.length,indexed_docs:q};if(d.sourceDB.emit("indexing",V),d.sourceDB.activeTasks.update(C,{completed_items:q}),!(Q.length<h.changes_batch_size))return Z()}function ye(N){const K=new $e;for(let Q=0,ne=N.length;Q<ne;Q++){const V=N[Q];if(V.doc._id[0]!=="_"){b=[],O=V.doc,O._deleted||i(d.sourceDB,D,O),b.sort(o);const H=be(b);K.set(V.doc._id,[H,V.changes])}T=V.seq}return K}function be(N){const K=new $e;let Q;for(let ne=0,V=N.length;ne<V;ne++){const H=N[ne],st=[H.key,H.id];ne>0&&fe(H.key,Q)===0&&st.push(ne),K.set(Te(st),H),Q=H.key}return K}try{yield k(),yield Z(),yield L.finish(),d.seq=T,d.sourceDB.activeTasks.remove(C)}catch(N){d.sourceDB.activeTasks.remove(C,N)}})}function F(d,h,b){b.group_level===0&&delete b.group_level;const O=b.group||b.group_level,C=n(d.reduceFun),B=[],D=isNaN(b.group_level)?Number.POSITIVE_INFINITY:b.group_level;h.forEach(function(T){const k=B[B.length-1];let E=O?T.key:null;if(O&&Array.isArray(E)&&(E=E.slice(0,D)),k&&fe(k.groupKey,E)===0){k.keys.push([T.key,T.id]),k.values.push(T.value);return}B.push({keys:[[T.key,T.id]],values:[T.value],groupKey:E})}),h=[];for(let T=0,k=B.length;T<k;T++){const E=B[T],q=a(d.sourceDB,C,E.keys,E.values,!1);if(q.error&&q.error instanceof dr)throw q.error;h.push({value:q.error?null:q.output,key:E.groupKey})}return{rows:s(h,b.limit,b.skip)}}function U(d,h){return hr(P(d),function(){return Y(d,h)})()}function Y(d,h){return M(this,null,function*(){let b;const O=d.reduceFun&&h.reduce!==!1,C=h.skip||0;typeof h.keys!="undefined"&&!h.keys.length&&(h.limit=0,delete h.keys);function B(T){return M(this,null,function*(){T.include_docs=!0;const k=yield d.db.allDocs(T);return b=k.total_rows,k.rows.map(function(E){if("value"in E.doc&&typeof E.doc.value=="object"&&E.doc.value!==null){const R=Object.keys(E.doc.value).sort(),L=["id","key","value"];if(!(R<L||R>L))return E.doc.value}const q=Vs(E.doc._id);return{key:q[0],id:q[1],value:"value"in E.doc?E.doc.value:null}})})}function D(T){return M(this,null,function*(){let k;if(O?k=F(d,T,h):typeof h.keys=="undefined"?k={total_rows:b,offset:C,rows:T}:k={total_rows:b,offset:C,rows:s(T,h.limit,h.skip)},h.update_seq&&(k.update_seq=d.seq),h.include_docs){const q=ua(T.map(c)),R=yield d.sourceDB.allDocs({keys:q,include_docs:!0,conflicts:h.conflicts,attachments:h.attachments,binary:h.binary});var E=new $e;return R.rows.forEach(function(L){E.set(L.id,L.doc)}),T.forEach(function(L){var Z=c(L),re=E.get(Z);re&&(L.doc=re)}),k}else return k})}if(typeof h.keys!="undefined"){const k=h.keys.map(function(R){const L={startkey:Te([R]),endkey:Te([R,{}])};return h.update_seq&&(L.update_seq=!0),B(L)}),E=yield Promise.all(k),q=rn(E);return D(q)}else{const T={descending:h.descending};h.update_seq&&(T.update_seq=!0);let k,E;if("start_key"in h&&(k=h.start_key),"startkey"in h&&(k=h.startkey),"end_key"in h&&(E=h.end_key),"endkey"in h&&(E=h.endkey),typeof k!="undefined"&&(T.startkey=h.descending?Te([k,{}]):Te([k])),typeof E!="undefined"){let R=h.inclusive_end!==!1;h.descending&&(R=!R),T.endkey=Te(R?[E,{}]:[E])}if(typeof h.key!="undefined"){const R=Te([h.key]),L=Te([h.key,{}]);T.descending?(T.endkey=R,T.startkey=L):(T.startkey=R,T.endkey=L)}O||(typeof h.limit=="number"&&(T.limit=h.limit),T.skip=C);const q=yield B(T);return D(q)}})}function G(d){return M(this,null,function*(){return(yield d.fetch("_view_cleanup",{headers:new gt({"Content-Type":"application/json"}),method:"POST"})).json()})}function z(d){return M(this,null,function*(){try{const h=yield d.get("_local/"+e),b=new $e;Object.keys(h.views).forEach(function(k){const E=pr(k),q="_design/"+E[0],R=E[1];let L=b.get(q);L||(L=new ht,b.set(q,L)),L.add(R)});const O={keys:vr(b),include_docs:!0},C=yield d.allDocs(O),B={};C.rows.forEach(function(k){const E=k.key.substring(8);b.get(k.key).forEach(function(q){let R=E+"/"+q;h.views[R]||(R=q);const L=Object.keys(h.views[R]),Z=k.doc&&k.doc.views&&k.doc.views[q];L.forEach(function(re){B[re]=B[re]||Z})})});const T=Object.keys(B).filter(function(k){return!B[k]}).map(function(k){return hr(P(k),function(){return new d.constructor(k,d.__opts).destroy()})()});return Promise.all(T).then(function(){return{ok:!0}})}catch(h){if(h.status===404)return{ok:!0};throw h}})}function J(d,h,b){return M(this,null,function*(){if(typeof d._query=="function")return g(d,h,b);if(Ie(d))return $(d,h,b);const O={changes_batch_size:d.__opts.view_update_changes_batch_size||oc};if(typeof h!="string")return x(b,h),va.add(function(){return M(this,null,function*(){const C=yield da(d,"temp_view/temp_view",h.map,h.reduce,!0,e);return tc(I(C,O).then(function(){return U(C,b)}),function(){return C.db.destroy()})})}),va.finish();{const C=h,B=pr(C),D=B[0],T=B[1],k=yield d.get("_design/"+D);if(h=k.views&&k.views[T],!h)throw new lr(`ddoc ${k._id} has no view named ${T}`);r(k,T),x(b,h);const E=yield da(d,C,h.map,h.reduce,!1,e);return b.stale==="ok"||b.stale==="update_after"?(b.stale==="update_after"&&me(function(){I(E,O)}),U(E,b)):(yield I(E,O),U(E,b))}})}function W(d,h,b){const O=this;typeof h=="function"&&(b=h,h={}),h=h?S(h):{},typeof d=="function"&&(d={map:d});const C=Promise.resolve().then(function(){return J(O,d,h)});return sa(C,b),C}const te=ec(function(){const d=this;return typeof d._viewCleanup=="function"?v(d):Ie(d)?G(d):z(d)});return{query:W,viewCleanup:te}}var _r={_sum:function(e,t){return yr(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(r){for(var i=0,a=0,o=r.length;a<o;a++){var s=r[a];i+=s*s}return i}return{sum:yr(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}};function cc(e){if(/^_sum/.test(e))return _r._sum;if(/^_count/.test(e))return _r._count;if(/^_stats/.test(e))return _r._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function fc(e,t){if(typeof e=="function"&&e.length===2){var n=e;return function(r){return n(r,t)}}else return fa(e.toString(),t)}function lc(e){var t=e.toString(),n=cc(t);return n||fa(t)}function dc(e,t){var n=e.views&&e.views[t];if(typeof n.map!="string")throw new lr("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}var hc="mrviews",ga=uc(hc,fc,lc,dc);function vc(e,t,n){return ga.query.call(this,e,t,n)}function yc(e){return ga.viewCleanup.call(this,e)}var gc={query:vc,viewCleanup:yc};function pc(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function pa(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function _c(e,t,n){var r=Ie(t)&&!Ie(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(a){return Promise.all(i.map(function(o){return pc(a,n,o)?t.getAttachment(n._id,o):e.getAttachment(a._id,o)}))}).catch(function(a){if(a.status!==404)throw a;return pa(t,n)}):pa(t,n)}function mc(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n].missing;r.forEach(function(i){t.push({id:n,rev:i})})}),{docs:t,revs:!0,latest:!0}}function wc(e,t,n,r){n=he(n);var i=[],a=!0;function o(){var c=mc(n);if(c.docs.length)return e.bulkGet(c).then(function(p){if(r.cancelled)throw new Error("cancelled");return Promise.all(p.results.map(function(w){return Promise.all(w.docs.map(function(f){var m=f.ok;return f.error&&(a=!1),!m||!m._attachments?m:_c(t,e,m).then(function(S){var A=Object.keys(m._attachments);return S.forEach(function(x,$){var g=m._attachments[A[$]];delete g.stub,delete g.length,g.data=x}),m})}))})).then(function(w){i=i.concat(rn(w).filter(Boolean))})})}function s(){return{ok:a,docs:i}}return Promise.resolve().then(o).then(s)}var _a=1,ma="pouchdb",bc=5,Le=0;function mr(e,t,n,r,i){return e.get(t).catch(function(a){if(a.status===404)return(e.adapter==="http"||e.adapter==="https")&&Pn(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:ma,version:_a};throw a}).then(function(a){if(!i.cancelled&&a.last_seq!==n)return a.history=(a.history||[]).filter(function(o){return o.session_id!==r}),a.history.unshift({last_seq:n,session_id:r}),a.history=a.history.slice(0,bc),a.version=_a,a.replicator=ma,a.session_id=r,a.last_seq=n,e.put(a).catch(function(o){if(o.status===409)return mr(e,t,n,r,i);throw o})})}class wa{constructor(t,n,r,i,a){this.src=t,this.target=n,this.id=r,this.returnValue=i,this.opts=a||{}}writeCheckpoint(t,n){var r=this;return this.updateTarget(t,n).then(function(){return r.updateSource(t,n)})}updateTarget(t,n){return this.opts.writeTargetCheckpoint?mr(this.target,this.id,t,n,this.returnValue):Promise.resolve(!0)}updateSource(t,n){if(this.opts.writeSourceCheckpoint){var r=this;return mr(this.src,this.id,t,n,this.returnValue).catch(function(i){if(Oa(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(n){return n.last_seq||Le}).catch(function(n){if(n.status!==404)throw n;return Le}):t.target.get(t.id).then(function(n){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?n.last_seq||Le:t.src.get(t.id).then(function(r){if(n.version!==r.version)return Le;var i;return n.version?i=n.version.toString():i="undefined",i in ba?ba[i](n,r):Le},function(r){if(r.status===404&&n.last_seq)return t.src.put({_id:t.id,last_seq:Le}).then(function(){return Le},function(i){return Oa(i)?(t.opts.writeSourceCheckpoint=!1,n.last_seq):Le});throw r})}).catch(function(n){if(n.status!==404)throw n;return Le})}}var ba={undefined:function(e,t){return fe(e.last_seq,t.last_seq)===0?t.last_seq:0},1:function(e,t){return $c(t,e).last_seq}};function $c(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:$a(e.history,t.history)}function $a(e,t){var n=e[0],r=e.slice(1),i=t[0],a=t.slice(1);if(!n||t.length===0)return{last_seq:Le,history:[]};var o=n.session_id;if(wr(o,t))return{last_seq:n.last_seq,history:e};var s=i.session_id;return wr(s,r)?{last_seq:i.last_seq,history:a}:$a(r,a)}function wr(e,t){var n=t[0],r=t.slice(1);return!e||t.length===0?!1:e===n.session_id?!0:wr(e,r)}function Oa(e){return typeof e.status=="number"&&Math.floor(e.status/100)===4}function Sa(e,t,n,r,i){return this instanceof wa?Sa:new wa(e,t,n,r,i)}var ka=0;function Oc(e,t,n,r){if(e.retry===!1){t.emit("error",n),t.removeAllListeners();return}if(typeof e.back_off_function!="function"&&(e.back_off_function=Qo),t.emit("requestError",n),t.state==="active"||t.state==="pending"){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=ka},a=function(){t.removeListener("active",i)};t.once("paused",a),t.once("active",i)}e.current_back_off=e.current_back_off||ka,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}function Sc(e){return Object.keys(e).sort(fe).reduce(function(t,n){return t[n]=e[n],t},{})}function kc(e,t,n){var r=n.doc_ids?n.doc_ids.sort(fe):"",i=n.filter?n.filter.toString():"",a="",o="",s="";return n.selector&&(s=JSON.stringify(n.selector)),n.filter&&n.query_params&&(a=JSON.stringify(Sc(n.query_params))),n.filter&&n.filter==="_view"&&(o=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(c){var p=c[0]+c[1]+i+o+a+r+s;return new Promise(function(w){Qn(p,w)})}).then(function(c){return c=c.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+c})}function Aa(e,t,n,r,i){var a=[],o,s={seq:0,changes:[],docs:[]},c=!1,p=!1,w=!1,f=0,m=0,S=n.continuous||n.live||!1,A=n.batch_size||100,x=n.batches_limit||10,$=n.style||"all_docs",g=!1,v=n.doc_ids,u=n.selector,l,y,_=[],P=on(),I;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var j={};r.ready(e,t);function F(){return y?Promise.resolve():kc(e,t,n).then(function(k){l=k;var E={};n.checkpoint===!1?E={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?E={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?E={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:E={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},y=new Sa(e,t,l,r,E)})}function U(){if(_=[],o.docs.length!==0){var k=o.docs,E={timeout:n.timeout};return t.bulkDocs({docs:k,new_edits:!1},E).then(function(q){if(r.cancelled)throw d(),new Error("cancelled");var R=Object.create(null);q.forEach(function(Z){Z.error&&(R[Z.id]=Z)});var L=Object.keys(R).length;i.doc_write_failures+=L,i.docs_written+=k.length-L,k.forEach(function(Z){var re=R[Z._id];if(re){i.errors.push(re);var oe=(re.name||"").toLowerCase();if(oe==="unauthorized"||oe==="forbidden")r.emit("denied",he(re));else throw re}else _.push(Z)})},function(q){throw i.doc_write_failures+=k.length,q})}}function Y(){if(o.error)throw new Error("There was a problem getting docs.");i.last_seq=m=o.seq;var k=he(i);return _.length&&(k.docs=_,typeof o.pending=="number"&&(k.pending=o.pending,delete o.pending),r.emit("change",k)),c=!0,e.info().then(function(E){var q=e.activeTasks.get(I);if(!(!o||!q)){var R=q.completed_items||0,L=parseInt(E.update_seq,10)-parseInt(f,10);e.activeTasks.update(I,{completed_items:R+o.changes.length,total_items:L})}}),y.writeCheckpoint(o.seq,P).then(function(){if(r.emit("checkpoint",{checkpoint:o.seq}),c=!1,r.cancelled)throw d(),new Error("cancelled");o=void 0,C()}).catch(function(E){throw T(E),E})}function G(){var k={};return o.changes.forEach(function(E){r.emit("checkpoint",{revs_diff:E}),E.id!=="_user/"&&(k[E.id]=E.changes.map(function(q){return q.rev}))}),t.revsDiff(k).then(function(E){if(r.cancelled)throw d(),new Error("cancelled");o.diffs=E})}function z(){return wc(e,t,o.diffs,r).then(function(k){o.error=!k.ok,k.docs.forEach(function(E){delete o.diffs[E._id],i.docs_read++,o.docs.push(E)})})}function J(){if(!(r.cancelled||o)){if(a.length===0){W(!0);return}o=a.shift(),r.emit("checkpoint",{start_next_batch:o.seq}),G().then(z).then(U).then(Y).then(J).catch(function(k){te("batch processing terminated with error",k)})}}function W(k){if(s.changes.length===0){a.length===0&&!o&&((S&&j.live||p)&&(r.state="pending",r.emit("paused")),p&&d());return}(k||p||s.changes.length>=A)&&(a.push(s),s={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),J())}function te(k,E){w||(E.message||(E.message=k),i.ok=!1,i.status="aborting",a=[],s={seq:0,changes:[],docs:[]},d(E))}function d(k){if(!w&&!(r.cancelled&&(i.status="cancelled",c)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=m,w=!0,e.activeTasks.remove(I,k),k){k=ee(k),k.result=i;var E=(k.name||"").toLowerCase();E==="unauthorized"||E==="forbidden"?(r.emit("error",k),r.removeAllListeners()):Oc(n,r,k,function(){Aa(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function h(k,E,q){if(r.cancelled)return d();typeof E=="number"&&(s.pending=E);var R=Ln(n)(k);if(!R){var L=e.activeTasks.get(I);if(L){var Z=L.completed_items||0;e.activeTasks.update(I,{completed_items:++Z})}return}s.seq=k.seq||q,s.changes.push(k),r.emit("checkpoint",{pending_batch:s.seq}),me(function(){W(a.length===0&&j.live)})}function b(k){if(g=!1,r.cancelled)return d();if(k.results.length>0)j.since=k.results[k.results.length-1].seq,C(),W(!0);else{var E=function(){S?(j.live=!0,C()):p=!0,W(!0)};!o&&k.results.length===0?(c=!0,y.writeCheckpoint(k.last_seq,P).then(function(){if(c=!1,i.last_seq=m=k.last_seq,r.cancelled)throw d(),new Error("cancelled");E()}).catch(T)):E()}}function O(k){if(g=!1,r.cancelled)return d();te("changes rejected",k)}function C(){if(!(!g&&!p&&a.length<x))return;g=!0;function k(){q.cancel()}function E(){r.removeListener("cancel",k)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",k);var q=e.changes(j).on("change",h);q.then(E,E),q.then(b).catch(O),n.retry&&(r._changes=q,r._abortChanges=k)}function B(k){return e.info().then(function(E){var q=typeof n.since=="undefined"?parseInt(E.update_seq,10)-parseInt(k,10):parseInt(E.update_seq,10);return I=e.activeTasks.add({name:`${S?"continuous ":""}replication from ${E.db_name}`,total_items:q}),k})}function D(){F().then(function(){if(r.cancelled){d();return}return y.getCheckpoint().then(B).then(function(k){m=k,f=k,j={since:m,limit:A,batch_size:A,style:$,doc_ids:v,selector:u,return_docs:!0},n.filter&&(typeof n.filter!="string"?j.include_docs=!0:j.filter=n.filter),"heartbeat"in n&&(j.heartbeat=n.heartbeat),"timeout"in n&&(j.timeout=n.timeout),n.query_params&&(j.query_params=n.query_params),n.view&&(j.view=n.view),C()})}).catch(function(k){te("getCheckpoint rejected with ",k)})}function T(k){c=!1,te("writeCheckpoint completed with error",k)}if(r.cancelled){d();return}r._addedListeners||(r.once("cancel",d),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(k){n.complete(null,k)})),r._addedListeners=!0),typeof n.since=="undefined"?D():F().then(function(){return c=!0,y.writeCheckpoint(n.since,P)}).then(function(){if(c=!1,r.cancelled){d();return}m=n.since,D()}).catch(T)}class Ac extends Ae{constructor(){super(),this.cancelled=!1,this.state="pending";const t=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return t.then(n,r)},this.catch=function(n){return t.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(t,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};t.once("destroyed",r),n.once("destroyed",r);function i(){t.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}}function dn(e,t){var n=t.PouchConstructor;return typeof e=="string"?new n(e,t):e}function br(e,t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n=="undefined"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw ee(nn,"`doc_ids` filter parameter is not a list.");n.complete=r,n=he(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new Ac(n),a=dn(e,n),o=dn(t,n);return Aa(a,o,n,i),i}function Ec(e,t,n,r){return typeof n=="function"&&(r=n,n={}),typeof n=="undefined"&&(n={}),n=he(n),n.PouchConstructor=n.PouchConstructor||this,e=dn(e,n),t=dn(t,n),new xc(e,t,n,r)}class xc extends Ae{constructor(t,n,r,i){super(),this.canceled=!1;const a=r.push?Je({},r,r.push):r,o=r.pull?Je({},r,r.pull):r;this.push=br(t,n,a),this.pull=br(n,t,o),this.pushPaused=!0,this.pullPaused=!0;const s=u=>{this.emit("change",{direction:"pull",change:u})},c=u=>{this.emit("change",{direction:"push",change:u})},p=u=>{this.emit("denied",{direction:"push",doc:u})},w=u=>{this.emit("denied",{direction:"pull",doc:u})},f=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},m=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},S=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},A=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let x={};const $=u=>(l,y)=>{(l==="change"&&(y===s||y===c)||l==="denied"&&(y===w||y===p)||l==="paused"&&(y===m||y===f)||l==="active"&&(y===A||y===S))&&(l in x||(x[l]={}),x[l][u]=!0,Object.keys(x[l]).length===2&&this.removeAllListeners(l))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function g(u,l,y){u.listeners(l).indexOf(y)==-1&&u.on(l,y)}this.on("newListener",function(u){u==="change"?(g(this.pull,"change",s),g(this.push,"change",c)):u==="denied"?(g(this.pull,"denied",w),g(this.push,"denied",p)):u==="active"?(g(this.pull,"active",A),g(this.push,"active",S)):u==="paused"&&(g(this.pull,"paused",m),g(this.push,"paused",f))}),this.on("removeListener",function(u){u==="change"?(this.pull.removeListener("change",s),this.push.removeListener("change",c)):u==="denied"?(this.pull.removeListener("denied",w),this.push.removeListener("denied",p)):u==="active"?(this.pull.removeListener("active",A),this.push.removeListener("active",S)):u==="paused"&&(this.pull.removeListener("paused",m),this.push.removeListener("paused",f))}),this.pull.on("removeListener",$("pull")),this.push.on("removeListener",$("push"));const v=Promise.all([this.push,this.pull]).then(u=>{const l={push:u[0],pull:u[1]};return this.emit("complete",l),i&&i(null,l),this.removeAllListeners(),l},u=>{if(this.cancel(),i?i(u):this.emit("error",u),this.removeAllListeners(),i)throw u});this.then=function(u,l){return v.then(u,l)},this.catch=function(u){return v.catch(u)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}function Cc(e){e.replicate=br,e.sync=Ec,Object.defineProperty(e.prototype,"replicate",{get:function(){var t=this;return typeof this.replicateMethods=="undefined"&&(this.replicateMethods={from:function(n,r,i){return t.constructor.replicate(n,t,r,i)},to:function(n,r,i){return t.constructor.replicate(t,n,r,i)}}),this.replicateMethods}}),e.prototype.sync=function(t,n,r){return this.constructor.sync(this,t,n,r)}}X.plugin(Qu).plugin(Vu).plugin(gc).plugin(Cc);class ue extends Error{constructor(t,n,r){super(),this.status=t,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new ue(401,"unauthorized","Name or password is incorrect."),new ue(400,"bad_request","Missing JSON list of 'docs'"),new ue(404,"not_found","missing"),new ue(409,"conflict","Document update conflict"),new ue(400,"bad_request","_id field must contain a string"),new ue(412,"missing_id","_id is required for puts"),new ue(400,"bad_request","Only reserved document ids may start with underscore."),new ue(412,"precondition_failed","Database not open");var Tc=new ue(500,"unknown_error","Database encountered an unknown error");new ue(500,"badarg","Some query argument is invalid"),new ue(400,"invalid_request","Request was invalid"),new ue(400,"query_parse_error","Some query parameter is invalid"),new ue(500,"doc_validation","Bad special document member"),new ue(400,"bad_request","Something wrong with the request"),new ue(400,"bad_request","Document must be a JSON object"),new ue(404,"not_found","Database not found"),new ue(500,"indexed_db_went_bad","unknown"),new ue(500,"web_sql_went_bad","unknown"),new ue(500,"levelDB_went_went_bad","unknown"),new ue(403,"forbidden","Forbidden by design doc validate_doc_update function"),new ue(400,"bad_request","Invalid rev format"),new ue(412,"file_exists","The database could not be created, the file already exists."),new ue(412,"missing_stub","A pre-existing attachment stub wasn't found"),new ue(413,"invalid_url","Provided URL is invalid");function $r(e){if(typeof e!="object"){var t=e;e=Tc,e.data=t}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=new Error().stack),e}var hn=Headers;function vn(e){return"$"+e}function Ea(e){return e.substring(1)}function Me(){this._store={}}Me.prototype.get=function(e){var t=vn(e);return this._store[t]},Me.prototype.set=function(e,t){var n=vn(e);return this._store[n]=t,!0},Me.prototype.has=function(e){var t=vn(e);return t in this._store},Me.prototype.keys=function(){return Object.keys(this._store).map(e=>Ea(e))},Me.prototype.delete=function(e){var t=vn(e),n=t in this._store;return delete this._store[t],n},Me.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n],a=this._store[i];i=Ea(i),e(a,i)}},Object.defineProperty(Me.prototype,"size",{get:function(){return Object.keys(this._store).length}});function Rt(e){if(this._store=new Me,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}Rt.prototype.add=function(e){return this._store.set(e,!0)},Rt.prototype.has=function(e){return this._store.has(e)},Rt.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(Rt.prototype,"size",{get:function(){return this._store.size}});function qc(){if(typeof Symbol=="undefined"||typeof Map=="undefined"||typeof Set=="undefined")return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}var Lt,wt;qc()?(Lt=Set,wt=Map):(Lt=Rt,wt=Me);var Pc=function(e){return atob(e)};function jc(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if(a.name!=="TypeError")throw a;for(var n=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function Ic(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function Bc(e,t){return jc([Ic(e)],{type:t})}function Rc(e,t){return Bc(Pc(e),t)}function Lc(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function Dc(e,t,n){var r=Lc(e,t,n);return r+e}var xa=-324,Or=3,Sr="";function de(e,t){if(e===t)return 0;e=tt(e),t=tt(t);var n=kr(e),r=kr(t);if(n-r!==0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return zc(e,t)}return Array.isArray(e)?Kc(e,t):Qc(e,t)}function tt(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=tt(t[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i];typeof a!="undefined"&&(e[i]=tt(a))}}}}return e}function Nc(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Jc(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,a="";if(t)for(;++r<i;)a+=Pe(n[r]);else for(;++r<i;){var o=n[r];a+=Pe(o)+Pe(e[o])}return a}return""}function Pe(e){var t="\0";return e=tt(e),kr(e)+Sr+Nc(e)+t}function Mc(e,t){var n=t,r,i=e[t]==="1";if(i)r=0,t++;else{var a=e[t]==="0";t++;var o="",s=e.substring(t,t+Or),c=parseInt(s,10)+xa;for(a&&(c=-c),t+=Or;;){var p=e[t];if(p==="\0")break;o+=p,t++}o=o.split("."),o.length===1?r=parseInt(o,10):r=parseFloat(o[0]+"."+o[1]),a&&(r=r-10),c!==0&&(r=parseFloat(r+"e"+c))}return{num:r,length:t-n}}function Fc(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,a=r.index;if(Array.isArray(i))i.push(n);else if(a===e.length-2){var o=e.pop();i[o]=n}else e.push(n)}}function Uc(e){for(var t=[],n=[],r=0;;){var i=e[r++];if(i==="\0"){if(t.length===1)return t.pop();Fc(t,n);continue}switch(i){case"1":t.push(null);break;case"2":t.push(e[r]==="1"),r++;break;case"3":var a=Mc(e,r);t.push(a.num),r+=a.length;break;case"4":for(var o="";;){var s=e[r];if(s==="\0")break;o+=s,r++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(o);break;case"5":var c={element:[],index:t.length};t.push(c.element),n.push(c);break;case"6":var p={element:{},index:t.length};t.push(p.element),n.push(p);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Kc(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=de(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1}function zc(e,t){return e===t?0:e>t?1:-1}function Qc(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),a=0;a<i;a++){var o=de(n[a],r[a]);if(o!==0||(o=de(e[n[a]],t[r[a]]),o!==0))return o}return n.length===r.length?0:n.length>r.length?1:-1}function kr(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);if(~n)return e===null?1:Array.isArray(e)?5:n<3?n+2:n+3;if(Array.isArray(e))return 5}function Jc(e){if(e===0)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",a=(r?-n:n)-xa,o=Dc(a.toString(),"0",Or);i+=Sr+o;var s=Math.abs(parseFloat(t[0]));r&&(s=10-s);var c=s.toFixed(20);return c=c.replace(/\.?0+$/,""),i+=Sr+c,i}function Ca(e){return Ht.hash(e)}function Gc(e){return typeof ArrayBuffer!="undefined"&&e instanceof ArrayBuffer||typeof Blob!="undefined"&&e instanceof Blob}function Wc(e){if(typeof e.slice=="function")return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}function Hc(e){if(e instanceof ArrayBuffer)return Wc(e);var t=e.size,n=e.type;return typeof e.slice=="function"?e.slice(0,t,n):e.webkitSlice(0,t,n)}var Ta=Function.prototype.toString,Xc=Ta.call(Object);function Yc(e){var t=Object.getPrototypeOf(e);if(t===null)return!0;var n=t.constructor;return typeof n=="function"&&n instanceof n&&Ta.call(n)==Xc}function Ke(e){var t,n,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=Ke(e[n]);return t}if(e instanceof Date&&isFinite(e))return e.toISOString();if(Gc(e))return Hc(e);if(!Yc(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=Ke(e[n]);typeof i!="undefined"&&(t[n]=i)}return t}function Zc(e){var t=!1;return function(...n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}}function Dt(e){return function(...t){t=Ke(t);var n=this,r=typeof t[t.length-1]=="function"?t.pop():!1,i=new Promise(function(a,o){var s;try{var c=Zc(function(p,w){p?o(p):a(w)});t.push(c),s=e.apply(n,t),s&&typeof s.then=="function"&&a(s)}catch(p){o(p)}});return r&&i.then(function(a){r(null,a)},r),i}}var qa;try{localStorage.setItem("_pouch_check_localstorage",1),qa=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){qa=!1}function Ar(e){if(typeof console!="undefined"&&typeof console[e]=="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}var Er;typeof Object.assign=="function"?Er=Object.assign:Er=function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};var xr=Er;function Pa(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function nt(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(Ar("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function yn(e,t,n){return e.get(t).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,a=n(r);return a?(a._id=t,a._rev=i,Vc(e,a,n)):{updated:!1,rev:i}})}function Vc(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return yn(e,t._id,n)})}class rt extends Error{constructor(t){super(),this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,rt)}catch(n){}}}class Cr extends Error{constructor(t){super(),this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Cr)}catch(n){}}}class Tr extends Error{constructor(t){super(),this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Tr)}catch(n){}}}function ja(e,t){return t&&e.then(function(n){me(function(){t(null,n)})},function(n){me(function(){t(n)})}),e}function ef(e){return function(...t){var n=t.pop(),r=e.apply(this,t);return typeof n=="function"&&ja(r,n),r}}function tf(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function qr(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function Ia(e){var t=new Lt(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function Pr(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}class jr{constructor(){this.promise=new Promise(function(t){t()})}add(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise}finish(){return this.promise}}function Ba(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function nf(e,t){return Ba(e)+Ba(t)+"undefined"}function Ra(e,t,n,r,i,a){return M(this,null,function*(){const o=nf(n,r);let s;if(!i&&(s=e._cachedViews=e._cachedViews||{},s[o]))return s[o];const c=e.info().then(function(p){return M(this,null,function*(){const w=p.db_name+"-mrview-"+(i?"temp":Ca(o));function f($){$.views=$.views||{};let g=t;g.indexOf("/")===-1&&(g=t+"/"+t);const v=$.views[g]=$.views[g]||{};if(!v[w])return v[w]=!0,$}yield yn(e,"_local/"+a,f);const S=(yield e.registerDependentDatabase(w)).db;S.auto_compaction=!0;const A={name:w,db:S,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};let x;try{x=yield A.db.get("_local/lastSeq")}catch($){if($.status!==404)throw $}return A.seq=x?x.seq:0,s&&A.db.once("destroyed",function(){delete s[o]}),A})});return s&&(s[o]=c),c})}var La={},Da=new jr,rf=50;function Ir(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function af(e){return e.length===1&&/^1-/.test(e[0].rev)}function Na(e,t,n){try{e.emit("error",t)}catch(r){Ar("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),Ar("error",t,n)}}function of(e,t,n,r){function i(d,h,b){try{h(b)}catch(O){Na(d,O,{fun:h,doc:b})}}function a(d,h,b,O,C){try{return{output:h(b,O,C)}}catch(B){return Na(d,B,{fun:h,keys:b,values:O,rereduce:C}),{error:B}}}function o(d,h){const b=de(d.key,h.key);return b!==0?b:de(d.value,h.value)}function s(d,h,b){return b=b||0,typeof h=="number"?d.slice(b,h+b):b>0?d.slice(b):d}function c(d){const h=d.value;return h&&typeof h=="object"&&h._id||d.id}function p(d){d.rows.forEach(function(h){const b=h.doc&&h.doc._attachments;b&&Object.keys(b).forEach(function(O){const C=b[O];b[O].data=Rc(C.data,C.content_type)})})}function w(d){return function(h){return d.include_docs&&d.attachments&&d.binary&&p(h),h}}function f(d,h,b,O){let C=h[d];typeof C!="undefined"&&(O&&(C=encodeURIComponent(JSON.stringify(C))),b.push(d+"="+C))}function m(d){if(typeof d!="undefined"){const h=Number(d);return!isNaN(h)&&h===parseInt(d,10)?h:d}}function S(d){return d.group_level=m(d.group_level),d.limit=m(d.limit),d.skip=m(d.skip),d}function A(d){if(d){if(typeof d!="number")return new rt(`Invalid value for integer: "${d}"`);if(d<0)return new rt(`Invalid value for positive integer: "${d}"`)}}function x(d,h){const b=d.descending?"endkey":"startkey",O=d.descending?"startkey":"endkey";if(typeof d[b]!="undefined"&&typeof d[O]!="undefined"&&de(d[b],d[O])>0)throw new rt("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(h.reduce&&d.reduce!==!1){if(d.include_docs)throw new rt("{include_docs:true} is invalid for reduce");if(d.keys&&d.keys.length>1&&!d.group&&!d.group_level)throw new rt("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(C){const B=A(d[C]);if(B)throw B})}function $(d,h,b){return M(this,null,function*(){let O=[],C,B="GET",D;if(f("reduce",b,O),f("include_docs",b,O),f("attachments",b,O),f("limit",b,O),f("descending",b,O),f("group",b,O),f("group_level",b,O),f("skip",b,O),f("stale",b,O),f("conflicts",b,O),f("startkey",b,O,!0),f("start_key",b,O,!0),f("endkey",b,O,!0),f("end_key",b,O,!0),f("inclusive_end",b,O),f("key",b,O,!0),f("update_seq",b,O),O=O.join("&"),O=O===""?"":"?"+O,typeof b.keys!="undefined"){const q=`keys=${encodeURIComponent(JSON.stringify(b.keys))}`;q.length+O.length+1<=2e3?O+=(O[0]==="?"?"&":"?")+q:(B="POST",typeof h=="string"?C={keys:b.keys}:h.keys=b.keys)}if(typeof h=="string"){const E=Ir(h),q=yield d.fetch("_design/"+E[0]+"/_view/"+E[1]+O,{headers:new hn({"Content-Type":"application/json"}),method:B,body:JSON.stringify(C)});D=q.ok;const R=yield q.json();if(!D)throw R.status=q.status,$r(R);return R.rows.forEach(function(L){if(L.value&&L.value.error&&L.value.error==="builtin_reduce_error")throw new Error(L.reason)}),new Promise(function(L){L(R)}).then(w(b))}C=C||{},Object.keys(h).forEach(function(E){Array.isArray(h[E])?C[E]=h[E]:C[E]=h[E].toString()});const T=yield d.fetch("_temp_view"+O,{headers:new hn({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(C)});D=T.ok;const k=yield T.json();if(!D)throw k.status=T.status,$r(k);return new Promise(function(E){E(k)}).then(w(b))})}function g(d,h,b){return new Promise(function(O,C){d._query(h,b,function(B,D){if(B)return C(B);O(D)})})}function v(d){return new Promise(function(h,b){d._viewCleanup(function(O,C){if(O)return b(O);h(C)})})}function u(d){return function(h){if(h.status===404)return d;throw h}}function l(d,h,b){return M(this,null,function*(){const O="_local/doc_"+d,C={_id:O,keys:[]},B=b.get(d),D=B[0],T=B[1];function k(){return af(T)?Promise.resolve(C):h.db.get(O).catch(u(C))}function E(Z){return Z.keys.length?h.db.allDocs({keys:Z.keys,include_docs:!0}):Promise.resolve({rows:[]})}function q(Z,re){const oe=[],ye=new Lt;for(let N=0,K=re.rows.length;N<K;N++){const ne=re.rows[N].doc;if(ne&&(oe.push(ne),ye.add(ne._id),ne._deleted=!D.has(ne._id),!ne._deleted)){const V=D.get(ne._id);"value"in V&&(ne.value=V.value)}}const be=Pr(D);return be.forEach(function(N){if(!ye.has(N)){const K={_id:N},Q=D.get(N);"value"in Q&&(K.value=Q.value),oe.push(K)}}),Z.keys=Ia(be.concat(Z.keys)),oe.push(Z),oe}const R=yield k(),L=yield E(R);return q(R,L)})}function y(d){return d.sourceDB.get("_local/purges").then(function(h){const b=h.purgeSeq;return d.db.get("_local/purgeSeq").then(function(O){return O._rev}).catch(function(O){if(O.status!==404)throw O}).then(function(O){return d.db.put({_id:"_local/purgeSeq",_rev:O,purgeSeq:b})})}).catch(function(h){if(h.status!==404)throw h})}function _(d,h,b){var O="_local/lastSeq";return d.db.get(O).catch(u({_id:O,seq:0})).then(function(C){var B=Pr(h);return Promise.all(B.map(function(D){return l(D,d,h)})).then(function(D){var T=Pa(D);return C.seq=b,T.push(C),d.db.bulkDocs({docs:T})}).then(()=>y(d))})}function P(d){const h=typeof d=="string"?d:d.name;let b=La[h];return b||(b=La[h]=new jr),b}function I(d,h){return M(this,null,function*(){return qr(P(d),function(){return j(d,h)})()})}function j(d,h){return M(this,null,function*(){let b,O,C;function B(N,K){const Q={id:O._id,key:tt(N)};typeof K!="undefined"&&K!==null&&(Q.value=tt(K)),b.push(Q)}const D=t(d.mapFun,B);let T=d.seq||0;function k(){return d.sourceDB.info().then(function(N){C=d.sourceDB.activeTasks.add({name:"view_indexing",total_items:N.update_seq-T})})}function E(N,K){return function(){return _(d,N,K)}}let q=0;const R={view:d.name,indexed_docs:q};d.sourceDB.emit("indexing",R);const L=new jr;function Z(){return M(this,null,function*(){const N=yield d.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:T,limit:h.changes_batch_size}),K=yield re();return oe(N,K)})}function re(){return d.db.get("_local/purgeSeq").then(function(N){return N.purgeSeq}).catch(function(N){if(N&&N.status!==404)throw N;return-1}).then(function(N){return d.sourceDB.get("_local/purges").then(function(K){const Q=K.purges.filter(function(V,H){return H>N}).map(V=>V.docId),ne=Q.filter(function(V,H){return Q.indexOf(V)===H});return Promise.all(ne.map(function(V){return d.sourceDB.get(V).then(function(H){return{docId:V,doc:H}}).catch(function(H){if(H.status!==404)throw H;return{docId:V}})}))}).catch(function(K){if(K&&K.status!==404)throw K;return[]})})}function oe(N,K){var Q=N.results;if(!Q.length&&!K.length)return;for(let H of K)if(Q.findIndex(function(je){return je.id===H.docId})<0){const je={_id:H.docId,doc:{_id:H.docId,_deleted:1},changes:[]};H.doc&&(je.doc=H.doc,je.changes.push({rev:H.doc._rev})),Q.push(je)}var ne=ye(Q);L.add(E(ne,T)),q=q+Q.length;const V={view:d.name,last_seq:N.last_seq,results_count:Q.length,indexed_docs:q};if(d.sourceDB.emit("indexing",V),d.sourceDB.activeTasks.update(C,{completed_items:q}),!(Q.length<h.changes_batch_size))return Z()}function ye(N){const K=new wt;for(let Q=0,ne=N.length;Q<ne;Q++){const V=N[Q];if(V.doc._id[0]!=="_"){b=[],O=V.doc,O._deleted||i(d.sourceDB,D,O),b.sort(o);const H=be(b);K.set(V.doc._id,[H,V.changes])}T=V.seq}return K}function be(N){const K=new wt;let Q;for(let ne=0,V=N.length;ne<V;ne++){const H=N[ne],st=[H.key,H.id];ne>0&&de(H.key,Q)===0&&st.push(ne),K.set(Pe(st),H),Q=H.key}return K}try{yield k(),yield Z(),yield L.finish(),d.seq=T,d.sourceDB.activeTasks.remove(C)}catch(N){d.sourceDB.activeTasks.remove(C,N)}})}function F(d,h,b){b.group_level===0&&delete b.group_level;const O=b.group||b.group_level,C=n(d.reduceFun),B=[],D=isNaN(b.group_level)?Number.POSITIVE_INFINITY:b.group_level;h.forEach(function(T){const k=B[B.length-1];let E=O?T.key:null;if(O&&Array.isArray(E)&&(E=E.slice(0,D)),k&&de(k.groupKey,E)===0){k.keys.push([T.key,T.id]),k.values.push(T.value);return}B.push({keys:[[T.key,T.id]],values:[T.value],groupKey:E})}),h=[];for(let T=0,k=B.length;T<k;T++){const E=B[T],q=a(d.sourceDB,C,E.keys,E.values,!1);if(q.error&&q.error instanceof Tr)throw q.error;h.push({value:q.error?null:q.output,key:E.groupKey})}return{rows:s(h,b.limit,b.skip)}}function U(d,h){return qr(P(d),function(){return Y(d,h)})()}function Y(d,h){return M(this,null,function*(){let b;const O=d.reduceFun&&h.reduce!==!1,C=h.skip||0;typeof h.keys!="undefined"&&!h.keys.length&&(h.limit=0,delete h.keys);function B(T){return M(this,null,function*(){T.include_docs=!0;const k=yield d.db.allDocs(T);return b=k.total_rows,k.rows.map(function(E){if("value"in E.doc&&typeof E.doc.value=="object"&&E.doc.value!==null){const R=Object.keys(E.doc.value).sort(),L=["id","key","value"];if(!(R<L||R>L))return E.doc.value}const q=Uc(E.doc._id);return{key:q[0],id:q[1],value:"value"in E.doc?E.doc.value:null}})})}function D(T){return M(this,null,function*(){let k;if(O?k=F(d,T,h):typeof h.keys=="undefined"?k={total_rows:b,offset:C,rows:T}:k={total_rows:b,offset:C,rows:s(T,h.limit,h.skip)},h.update_seq&&(k.update_seq=d.seq),h.include_docs){const q=Ia(T.map(c)),R=yield d.sourceDB.allDocs({keys:q,include_docs:!0,conflicts:h.conflicts,attachments:h.attachments,binary:h.binary});var E=new wt;return R.rows.forEach(function(L){E.set(L.id,L.doc)}),T.forEach(function(L){var Z=c(L),re=E.get(Z);re&&(L.doc=re)}),k}else return k})}if(typeof h.keys!="undefined"){const k=h.keys.map(function(R){const L={startkey:Pe([R]),endkey:Pe([R,{}])};return h.update_seq&&(L.update_seq=!0),B(L)}),E=yield Promise.all(k),q=Pa(E);return D(q)}else{const T={descending:h.descending};h.update_seq&&(T.update_seq=!0);let k,E;if("start_key"in h&&(k=h.start_key),"startkey"in h&&(k=h.startkey),"end_key"in h&&(E=h.end_key),"endkey"in h&&(E=h.endkey),typeof k!="undefined"&&(T.startkey=h.descending?Pe([k,{}]):Pe([k])),typeof E!="undefined"){let R=h.inclusive_end!==!1;h.descending&&(R=!R),T.endkey=Pe(R?[E,{}]:[E])}if(typeof h.key!="undefined"){const R=Pe([h.key]),L=Pe([h.key,{}]);T.descending?(T.endkey=R,T.startkey=L):(T.startkey=R,T.endkey=L)}O||(typeof h.limit=="number"&&(T.limit=h.limit),T.skip=C);const q=yield B(T);return D(q)}})}function G(d){return M(this,null,function*(){return(yield d.fetch("_view_cleanup",{headers:new hn({"Content-Type":"application/json"}),method:"POST"})).json()})}function z(d){return M(this,null,function*(){try{const h=yield d.get("_local/"+e),b=new wt;Object.keys(h.views).forEach(function(k){const E=Ir(k),q="_design/"+E[0],R=E[1];let L=b.get(q);L||(L=new Lt,b.set(q,L)),L.add(R)});const O={keys:Pr(b),include_docs:!0},C=yield d.allDocs(O),B={};C.rows.forEach(function(k){const E=k.key.substring(8);b.get(k.key).forEach(function(q){let R=E+"/"+q;h.views[R]||(R=q);const L=Object.keys(h.views[R]),Z=k.doc&&k.doc.views&&k.doc.views[q];L.forEach(function(re){B[re]=B[re]||Z})})});const T=Object.keys(B).filter(function(k){return!B[k]}).map(function(k){return qr(P(k),function(){return new d.constructor(k,d.__opts).destroy()})()});return Promise.all(T).then(function(){return{ok:!0}})}catch(h){if(h.status===404)return{ok:!0};throw h}})}function J(d,h,b){return M(this,null,function*(){if(typeof d._query=="function")return g(d,h,b);if(nt(d))return $(d,h,b);const O={changes_batch_size:d.__opts.view_update_changes_batch_size||rf};if(typeof h!="string")return x(b,h),Da.add(function(){return M(this,null,function*(){const C=yield Ra(d,"temp_view/temp_view",h.map,h.reduce,!0,e);return tf(I(C,O).then(function(){return U(C,b)}),function(){return C.db.destroy()})})}),Da.finish();{const C=h,B=Ir(C),D=B[0],T=B[1],k=yield d.get("_design/"+D);if(h=k.views&&k.views[T],!h)throw new Cr(`ddoc ${k._id} has no view named ${T}`);r(k,T),x(b,h);const E=yield Ra(d,C,h.map,h.reduce,!1,e);return b.stale==="ok"||b.stale==="update_after"?(b.stale==="update_after"&&me(function(){I(E,O)}),U(E,b)):(yield I(E,O),U(E,b))}})}function W(d,h,b){const O=this;typeof h=="function"&&(b=h,h={}),h=h?S(h):{},typeof d=="function"&&(d={map:d});const C=Promise.resolve().then(function(){return J(O,d,h)});return ja(C,b),C}const te=ef(function(){const d=this;return typeof d._viewCleanup=="function"?v(d):nt(d)?G(d):z(d)});return{query:W,viewCleanup:te}}function Nt(e,t){for(var n=e,r=0,i=t.length;r<i;r++){var a=t[r];if(n=n[a],!n)break}return n}function sf(e,t,n){for(var r=0,i=t.length;r<i-1;r++){var a=t[r];e=e[a]=e[a]||{}}e[t[i-1]]=n}function Br(e,t){return e<t?-1:e>t?1:0}function it(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var a=e[r];r>0&&e[r-1]==="\\"&&(a==="$"||a===".")?n=n.substring(0,n.length-1)+a:a==="."?(t.push(n),n=""):n+=a}return t.push(n),t}var uf=["$or","$nor","$not"];function Ma(e){return uf.indexOf(e)>-1}function Se(e){return Object.keys(e)[0]}function Rr(e){return e[Se(e)]}function Mt(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var a=r[i];if(typeof a!="object"&&(a={$eq:a}),Ma(i))if(a instanceof Array){if(n[i]){n[i]=!1,t[i]=a;return}var o=[];t[i].forEach(function(c){Object.keys(a).forEach(function(p){var w=a[p],f=Math.max(Object.keys(c).length,Object.keys(w).length),m=Mt([c,w]);Object.keys(m).length<=f||o.push(m)})}),t[i]=o}else t[i]=Mt([a]);else{var s=t[i]=t[i]||{};Object.keys(a).forEach(function(c){var p=a[c];if(c==="$gt"||c==="$gte")return cf(c,p,s);if(c==="$lt"||c==="$lte")return ff(c,p,s);if(c==="$ne")return lf(p,s);if(c==="$eq")return df(p,s);if(c==="$regex")return hf(p,s);s[c]=p})}})}),t}function cf(e,t,n){typeof n.$eq=="undefined"&&(typeof n.$gte!="undefined"?e==="$gte"?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt!="undefined"?e==="$gte"?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}function ff(e,t,n){typeof n.$eq=="undefined"&&(typeof n.$lte!="undefined"?e==="$lte"?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt!="undefined"?e==="$lte"?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}function lf(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function df(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function hf(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}function Fa(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=Mt(e[n].$and));var r=e[t];typeof r=="object"&&Fa(r)}return e}function Ua(e,t){for(var n in e){n==="$and"&&(t=!0);var r=e[n];typeof r=="object"&&(t=Ua(r,t))}return t}function Lr(e){var t=Ke(e);Ua(t,!1)&&(t=Fa(t),"$and"in t&&(t=Mt(t.$and))),["$or","$nor"].forEach(function(o){o in t&&t[o].forEach(function(s){for(var c=Object.keys(s),p=0;p<c.length;p++){var w=c[p],f=s[w];(typeof f!="object"||f===null)&&(s[w]={$eq:f})}})}),"$not"in t&&(t.$not=Mt([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],a=t[i];(typeof a!="object"||a===null)&&(a={$eq:a}),t[i]=a}return Dr(t),t}function Dr(e){Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&Dr(r)}):t==="$ne"?e.$ne=[n]:t==="$regex"?e.$regex=[n]:n&&typeof n=="object"&&Dr(n)})}function vf(e){function t(n){return e.map(function(r){var i=Se(r),a=it(i),o=Nt(n,a);return o})}return function(n,r){var i=t(n.doc),a=t(r.doc),o=de(i,a);return o!==0?o:Br(n.doc._id,r.doc._id)}}function Ka(e,t,n){if(e=e.filter(function(o){return bt(o.doc,t.selector,n)}),t.sort){var r=vf(t.sort);e=e.sort(r),typeof t.sort[0]!="string"&&Rr(t.sort[0])==="desc"&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,a=("limit"in t?t.limit:e.length)+i;e=e.slice(i,a)}return e}function bt(e,t,n){return n.every(function(r){var i=t[r],a=it(r),o=Nt(e,a);return Ma(r)?yf(r,i,e):gn(i,e,a,o)})}function gn(e,t,n,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var a=e[i];if(i.indexOf("$")===0)return za(i,t,a,n,r);var o=it(i);if(r===void 0&&typeof a!="object"&&o.length>0)return!1;var s=Nt(r,o);return typeof a=="object"?gn(a,t,n,s):za("$eq",t,a,o,s)}):e===r:!0}function yf(e,t,n){return e==="$or"?t.some(function(r){return bt(n,r,Object.keys(r))}):e==="$not"?!bt(n,t,Object.keys(t)):!t.find(function(r){return bt(n,r,Object.keys(r))})}function za(e,t,n,r,i){if(!Ja[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Ja[e](t,n,r,i)}function Ft(e){return typeof e!="undefined"&&e!==null}function at(e){return typeof e!="undefined"}function gf(e,t){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var n=t[0],r=t[1];return e%n===r}function Qa(e,t){return t.some(function(n){return e instanceof Array?e.some(function(r){return de(n,r)===0}):de(n,e)===0})}function pf(e,t){return t.every(function(n){return e.some(function(r){return de(n,r)===0})})}function _f(e,t){return e.length===t}function mf(e,t){var n=new RegExp(t);return n.test(e)}function wf(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var Ja={$elemMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return bt(i,t,Object.keys(t))}):r.some(function(i){return gn(t,e,n,i)})},$allMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return bt(i,t,Object.keys(t))}):r.every(function(i){return gn(t,e,n,i)})},$eq:function(e,t,n,r){return at(r)&&de(r,t)===0},$gte:function(e,t,n,r){return at(r)&&de(r,t)>=0},$gt:function(e,t,n,r){return at(r)&&de(r,t)>0},$lte:function(e,t,n,r){return at(r)&&de(r,t)<=0},$lt:function(e,t,n,r){return at(r)&&de(r,t)<0},$exists:function(e,t,n,r){return t?at(r):!at(r)},$mod:function(e,t,n,r){return Ft(r)&&gf(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return de(r,i)!==0})},$in:function(e,t,n,r){return Ft(r)&&Qa(r,t)},$nin:function(e,t,n,r){return Ft(r)&&!Qa(r,t)},$size:function(e,t,n,r){return Ft(r)&&Array.isArray(r)&&_f(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&pf(r,t)},$regex:function(e,t,n,r){return Ft(r)&&typeof r=="string"&&t.every(function(i){return mf(r,i)})},$type:function(e,t,n,r){return wf(r,t)}};function pn(e,t){if(typeof t!="object")throw new Error("Selector error: expected a JSON object");t=Lr(t);var n={doc:e},r=Ka([n],{selector:t},Object.keys(t));return r&&r.length===1}function Ga(e){return e=Ke(e),e.index||(e.index={}),["type","name","ddoc"].forEach(function(t){e.index[t]&&(e[t]=e.index[t],delete e.index[t])}),e.fields&&(e.index.fields=e.fields,delete e.fields),e.type||(e.type="json"),e}function bf(e,t,n){var r="",i=t,a=!0;if(["$in","$nin","$or","$and","$mod","$nor","$all"].indexOf(e)!==-1&&(Array.isArray(t)||(r="Query operator "+e+" must be an array.")),["$not","$elemMatch","$allMatch"].indexOf(e)!==-1&&(!Array.isArray(t)&&typeof t=="object"&&t!==null||(r="Query operator "+e+" must be an object.")),e==="$mod"&&Array.isArray(t))if(t.length!==2)r="Query operator $mod must be in the format [divisor, remainder], where divisor and remainder are both integers.";else{var o=t[0],s=t[1];o===0&&(r="Query operator $mod's divisor cannot be 0, cannot divide by zero.",a=!1),(typeof o!="number"||parseInt(o,10)!==o)&&(r="Query operator $mod's divisor is not an integer.",i=o),parseInt(s,10)!==s&&(r="Query operator $mod's remainder is not an integer.",i=s)}if(e==="$exists"&&typeof t!="boolean"&&(r="Query operator $exists must be a boolean."),e==="$type"){var c=["null","boolean","number","string","array","object"],p='"'+c.slice(0,c.length-1).join('", "')+'", or "'+c[c.length-1]+'"';(typeof t!="string"||c.indexOf(t)==-1)&&(r="Query operator $type must be a string. Supported values: "+p+".")}if(e==="$size"&&parseInt(t,10)!==t&&(r="Query operator $size must be a integer."),e==="$regex"&&typeof t!="string"&&(n?r="Query operator $regex must be a string.":t instanceof RegExp||(r="Query operator $regex must be a string or an instance of a javascript regular expression.")),r){if(a){var w=i===null?" ":Array.isArray(i)?" array":" "+typeof i,f=typeof i=="object"&&i!==null?JSON.stringify(i,null,"	"):i;r+=" Received"+w+": "+f}throw new Error(r)}}var $f=["$all","$allMatch","$and","$elemMatch","$exists","$in","$mod","$nin","$nor","$not","$or","$regex","$size","$type"],Of=["$in","$nin","$mod","$all"],Sf=["$eq","$gt","$gte","$lt","$lte"];function _n(e,t){if(Array.isArray(e))for(var n of e)typeof n=="object"&&o!==null&&_n(n,t);else for(var r=Object.keys(e),i=0;i<r.length;i++){var a=r[i],o=e[a];$f.indexOf(a)!==-1&&bf(a,o,t),Sf.indexOf(a)===-1&&Of.indexOf(a)===-1&&typeof o=="object"&&o!==null&&_n(o,t)}}function Ut(e,t,n,r){var i,a;n.headers=new hn({"Content-type":"application/json"}),e.fetch(t,n).then(function(o){return i=o.status,a=o.ok,o.json()}).then(function(o){if(a)r(null,o);else{o.status=i;var s=$r(o);r(s)}}).catch(r)}function kf(e,t,n){t=Ga(t),Ut(e,"_index",{method:"POST",body:JSON.stringify(t)},n)}function Af(e,t,n){_n(t.selector,!0),Ut(e,"_find",{method:"POST",body:JSON.stringify(t)},n)}function Ef(e,t,n){Ut(e,"_explain",{method:"POST",body:JSON.stringify(t)},n)}function xf(e,t){Ut(e,"_index",{method:"GET"},t)}function Cf(e,t,n){var r=t.ddoc,i=t.type||"json",a=t.name;if(!r)return n(new Error("you must provide an index's ddoc"));if(!a)return n(new Error("you must provide an index's name"));var o="_index/"+[r,i,a].map(encodeURIComponent).join("/");Ut(e,o,{method:"DELETE"},n)}function Kt(e){return function(...t){var n=t.pop(),r=e.apply(this,t);return Tf(r,n),r}}function Tf(e,t){return e.then(function(n){me(function(){t(null,n)})},function(n){me(function(){t(n)})}),e}var Nr=function(...e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];Array.isArray(i)?t=t.concat(Nr.apply(null,i)):t.push(i)}return t};function Mr(e){for(var t={},n=0,r=e.length;n<r;n++)t=xr(t,e[n]);return t}function qf(e,t){for(var n={},r=0,i=t.length;r<i;r++){var a=it(t[r]),o=Nt(e,a);typeof o!="undefined"&&sf(n,a,o)}return n}function Wa(e,t){for(var n=0,r=Math.min(e.length,t.length);n<r;n++)if(e[n]!==t[n])return!1;return!0}function Pf(e,t){return e.length>t.length?!1:Wa(e,t)}function jf(e,t){e=e.slice();for(var n=0,r=t.length;n<r;n++){var i=t[n];if(!e.length)break;var a=e.indexOf(i);if(a===-1)return!1;e.splice(a,1)}return!0}function If(e){for(var t={},n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t}function Bf(e,t){for(var n=null,r=-1,i=0,a=e.length;i<a;i++){var o=e[i],s=t(o);s>r&&(r=s,n=o)}return n}function Ha(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Rf(e){for(var t={},n=0;n<e.length;n++)t["$"+e[n]]=!0;return Object.keys(t).map(function(r){return r.substring(1)})}function Lf(e,t,n){return function(r){if(!(n&&!pn(r,n))){for(var i=[],a=0,o=e.length;a<o;a++){for(var s=it(e[a]),c=r,p=0,w=s.length;p<w;p++){var f=s[p];if(c=c[f],typeof c=="undefined")return}i.push(c)}t(i)}}}function Df(e,t,n){var r=it(e);return function(i){if(!(n&&!pn(i,n))){for(var a=i,o=0,s=r.length;o<s;o++){var c=r[o];if(a=a[c],typeof a=="undefined")return}t(a)}}}function Nf(e,t,n){return function(r){n&&!pn(r,n)||t(r[e])}}function Mf(e,t,n){return function(r){if(!(n&&!pn(r,n))){for(var i=[],a=0,o=e.length;a<o;a++)i.push(r[e[a]]);t(i)}}}function Ff(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r.indexOf(".")!==-1)return!1}return!0}function Uf(e,t,n){var r=Ff(e),i=e.length===1;return r?i?Nf(e[0],t,n):Mf(e,t,n):i?Df(e[0],t,n):Lf(e,t,n)}function Kf(e,t){const n=Object.keys(e.fields),r=e.partial_filter_selector;return Uf(n,t,r)}function zf(){throw new Error("reduce not supported")}function Qf(e,t){var n=e.views[t];if(!n.map||!n.map.fields)throw new Error("ddoc "+e._id+" with view "+t+" doesn't have map.fields defined. maybe it wasn't created by this plugin?")}var Fr=of("indexes",Kf,zf,Qf);function Ur(e){return e._customFindAbstractMapper?{query:function(n,r){var i=Fr.query.bind(this);return e._customFindAbstractMapper.query.call(this,n,r,i)},viewCleanup:function(){var n=Fr.viewCleanup.bind(this);return e._customFindAbstractMapper.viewCleanup.call(this,n)}}:Fr}function Jf(e){if(!Array.isArray(e))throw new Error("invalid sort json - should be an array");return e.map(function(t){if(typeof t=="string"){var n={};return n[t]="asc",n}else return t})}function Gf(e){var t=[];return typeof e=="string"?t.push(e):t=e,t.map(function(n){return n.replace("_design/","")})}function Xa(e){return e.fields=e.fields.map(function(t){if(typeof t=="string"){var n={};return n[t]="asc",n}return t}),e.partial_filter_selector&&(e.partial_filter_selector=Lr(e.partial_filter_selector)),e}function Wf(e,t){for(var n=[],r=0;r<t.def.fields.length;r++){var i=Se(t.def.fields[r]);n.push(Nt(e,it(i)))}return n}function Hf(e,t,n){for(var r=n.def.fields,i=0,a=e.length;i<a;i++){var o=e[i],s=Wf(o.doc,n);if(r.length===1)s=s[0];else for(;s.length>t.length;)s.pop();if(Math.abs(de(s,t))>0)break}return i>0?e.slice(i):e}function Xf(e){var t=Ke(e);return delete t.startkey,delete t.endkey,delete t.inclusive_start,delete t.inclusive_end,"endkey"in e&&(t.startkey=e.endkey),"startkey"in e&&(t.endkey=e.startkey),"inclusive_start"in e&&(t.inclusive_end=e.inclusive_start),"inclusive_end"in e&&(t.inclusive_start=e.inclusive_end),t}function Yf(e){var t=e.fields.filter(function(n){return Rr(n)==="asc"});if(t.length!==0&&t.length!==e.fields.length)throw new Error("unsupported mixed sorting")}function Zf(e,t){if(t.defaultUsed&&e.sort){var n=e.sort.filter(function(r){return Object.keys(r)[0]!=="_id"}).map(function(r){return Object.keys(r)[0]});if(n.length>0)throw new Error('Cannot sort on field(s) "'+n.join(",")+'" when using the default index')}t.defaultUsed}function Vf(e){if(typeof e.selector!="object")throw new Error("you must provide a selector when you find()")}function el(e,t){var n=Object.keys(e),r=t?t.map(Se):[],i;return n.length>=r.length?i=n:i=r,r.length===0?{fields:i}:(i=i.sort(function(a,o){var s=r.indexOf(a);s===-1&&(s=Number.MAX_VALUE);var c=r.indexOf(o);return c===-1&&(c=Number.MAX_VALUE),s<c?-1:s>c?1:0}),{fields:i,sortOrder:t.map(Se)})}function tl(e,t){t=Ga(t);var n=Ke(t.index);t.index=Xa(t.index),Yf(t.index);var r;function i(){return r||(r=Ca(JSON.stringify(t)))}var a=t.name||"idx-"+i(),o=t.ddoc||"idx-"+i(),s="_design/"+o,c=!1,p=!1;function w(f){return f._rev&&f.language!=="query"&&(c=!0),f.language="query",f.views=f.views||{},p=!!f.views[a],p?!1:(f.views[a]={map:{fields:Mr(t.index.fields),partial_filter_selector:t.index.partial_filter_selector},reduce:"_count",options:{def:n}},f)}return e.constructor.emit("debug",["find","creating index",s]),yn(e,s,w).then(function(){if(c)throw new Error('invalid language for ddoc with id "'+s+'" (should be "query")')}).then(function(){var f=o+"/"+a;return Ur(e).query.call(e,f,{limit:0,reduce:!1}).then(function(){return{id:s,name:a,result:p?"exists":"created"}})})}function Ya(e){return e.allDocs({startkey:"_design/",endkey:"_design/￿",include_docs:!0}).then(function(t){var n={indexes:[{ddoc:null,name:"_all_docs",type:"special",def:{fields:[{_id:"asc"}]}}]};return n.indexes=Nr(n.indexes,t.rows.filter(function(r){return r.doc.language==="query"}).map(function(r){var i=r.doc.views!==void 0?Object.keys(r.doc.views):[];return i.map(function(a){var o=r.doc.views[a];return{ddoc:r.id,name:a,type:"json",def:Xa(o.options.def)}})})),n.indexes.sort(function(r,i){return Br(r.name,i.name)}),n.total_rows=n.indexes.length,n})}var mn=null,Kr={"￿":{}};const nl={queryOpts:{limit:0,startkey:Kr,endkey:mn},inMemoryFields:[]};function rl(e,t){for(var n=e.def.fields.map(Se),r=0,i=n.length;r<i;r++){var a=n[r];if(t===a)return!0}return!1}function il(e,t){var n=e[t],r=Se(n);return r!=="$eq"}function Za(e,t){var n=t.def.fields.map(Se);return e.slice().sort(function(r,i){var a=n.indexOf(r),o=n.indexOf(i);return a===-1&&(a=Number.MAX_VALUE),o===-1&&(o=Number.MAX_VALUE),Br(a,o)})}function al(e,t,n){n=Za(n,e);for(var r=!1,i=0,a=n.length;i<a;i++){var o=n[i];if(r||!rl(e,o))return n.slice(i);i<a-1&&il(t,o)&&(r=!0)}return[]}function ol(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n];Object.keys(r).forEach(function(i){i==="$ne"&&t.push(n)})}),t}function sl(e,t,n,r){var i=Nr(e,al(t,n,r),ol(n));return Za(Rf(i),t)}function ul(e,t,n){if(t){var r=Pf(t,e),i=Wa(n,e);return r&&i}return jf(n,e)}var cl=["$eq","$gt","$gte","$lt","$lte"];function Va(e){return cl.indexOf(e)===-1}function fl(e,t){var n=e[0],r=t[n];if(typeof r=="undefined")return!0;var i=Object.keys(r).length===1&&Se(r)==="$ne";return!i}function ll(e,t,n,r){var i=e.def.fields.map(Se),a=ul(i,t,n);return a?fl(i,r):!1}function dl(e,t,n,r){return r.filter(function(i){return ll(i,n,t,e)})}function hl(e,t,n,r,i){var a=dl(e,t,n,r);if(a.length===0){if(i)throw{error:"no_usable_index",message:"There is no index available for this selector."};var o=r[0];return o.defaultUsed=!0,o}if(a.length===1&&!i)return a[0];var s=If(t);function c(m){for(var S=m.def.fields.map(Se),A=0,x=0,$=S.length;x<$;x++){var g=S[x];s[g]&&A++}return A}if(i){var p="_design/"+i[0],w=i.length===2?i[1]:!1,f=a.find(function(m){return!!(w&&m.ddoc===p&&w===m.name||m.ddoc===p)});if(!f)throw{error:"unknown_error",message:"Could not find that index or could not use that index for the query"};return f}return Bf(a,c)}function vl(e,t){switch(e){case"$eq":return{key:t};case"$lte":return{endkey:t};case"$gte":return{startkey:t};case"$lt":return{endkey:t,inclusive_end:!1};case"$gt":return{startkey:t,inclusive_start:!1}}return{startkey:mn}}function yl(e,t){var n=Se(t.def.fields[0]),r=e[n]||{},i=[],a=Object.keys(r),o;return a.forEach(function(s){Va(s)&&i.push(n);var c=r[s],p=vl(s,c);o?o=Mr([o,p]):o=p}),{queryOpts:o,inMemoryFields:i}}function gl(e,t){switch(e){case"$eq":return{startkey:t,endkey:t};case"$lte":return{endkey:t};case"$gte":return{startkey:t};case"$lt":return{endkey:t,inclusive_end:!1};case"$gt":return{startkey:t,inclusive_start:!1}}}function pl(e,t){var n=t.def.fields.map(Se),r=[],i=[],a=[],o,s;function c(j){o!==!1&&i.push(mn),s!==!1&&a.push(Kr),r=n.slice(j)}for(var p=0,w=n.length;p<w;p++){var f=n[p],m=e[f];if(!m||!Object.keys(m).length){c(p);break}else if(Object.keys(m).some(Va)){c(p);break}else if(p>0){var S="$gt"in m||"$gte"in m||"$lt"in m||"$lte"in m,A=Object.keys(e[n[p-1]]),x=Ha(A,["$eq"]),$=Ha(A,Object.keys(m)),g=S&&!x&&!$;if(g){c(p);break}}for(var v=Object.keys(m),u=null,l=0;l<v.length;l++){var y=v[l],_=m[y],P=gl(y,_);u?u=Mr([u,P]):u=P}i.push("startkey"in u?u.startkey:mn),a.push("endkey"in u?u.endkey:Kr),"inclusive_start"in u&&(o=u.inclusive_start),"inclusive_end"in u&&(s=u.inclusive_end)}var I={startkey:i,endkey:a};return typeof o!="undefined"&&(I.inclusive_start=o),typeof s!="undefined"&&(I.inclusive_end=s),{queryOpts:I,inMemoryFields:r}}function _l(e){return Object.keys(e).map(function(n){return e[n]}).some(function(n){return typeof n=="object"&&Object.keys(n).length===0})}function ml(e){return{queryOpts:{startkey:null},inMemoryFields:[Object.keys(e)]}}function wl(e,t){return t.defaultUsed?ml(e):t.def.fields.length===1?yl(e,t):pl(e,t)}function bl(e,t){var n=e.selector,r=e.sort;if(_l(n))return xr({},nl,{index:t[0]});var i=el(n,r),a=i.fields,o=i.sortOrder,s=hl(n,a,o,t,e.use_index),c=wl(n,s),p=c.queryOpts,w=c.inMemoryFields,f=sl(w,s,n,a),m={queryOpts:p,index:s,inMemoryFields:f};return m}function $l(e){return e.ddoc.substring(8)+"/"+e.name}function Ol(e,t){var n=Ke(t);return n.descending?("endkey"in n&&typeof n.endkey!="string"&&(n.endkey=""),"startkey"in n&&typeof n.startkey!="string"&&(n.limit=0)):("startkey"in n&&typeof n.startkey!="string"&&(n.startkey=""),"endkey"in n&&typeof n.endkey!="string"&&(n.limit=0)),"key"in n&&typeof n.key!="string"&&(n.limit=0),n.limit>0&&n.indexes_count&&(n.original_limit=n.limit,n.limit+=n.indexes_count),e.allDocs(n).then(function(r){return r.rows=r.rows.filter(function(i){return!/^_design\//.test(i.id)}),n.original_limit&&(n.limit=n.original_limit),r.rows=r.rows.slice(0,n.limit),r})}function eo(e,t,n){return t.selector&&(_n(t.selector,!1),t.selector=Lr(t.selector)),t.sort&&(t.sort=Jf(t.sort)),t.use_index&&(t.use_index=Gf(t.use_index)),Vf(t),Ya(e).then(function(r){e.constructor.emit("debug",["find","planning query",t]);var i=bl(t,r.indexes);e.constructor.emit("debug",["find","query plan",i]);var a=i.index;Zf(t,a);var o=xr({include_docs:!0,reduce:!1,indexes_count:r.total_rows},i.queryOpts);if("startkey"in o&&"endkey"in o&&de(o.startkey,o.endkey)>0)return{docs:[]};var s=t.sort&&typeof t.sort[0]!="string"&&Rr(t.sort[0])==="desc";return s&&(o.descending=!0,o=Xf(o)),i.inMemoryFields.length||("limit"in t&&(o.limit=t.limit),"skip"in t&&(o.skip=t.skip)),n?Promise.resolve(i,o):Promise.resolve().then(function(){if(a.name==="_all_docs")return Ol(e,o);var c=$l(a);return Ur(e).query.call(e,c,o)}).then(function(c){o.inclusive_start===!1&&(c.rows=Hf(c.rows,o.startkey,a)),i.inMemoryFields.length&&(c.rows=Ka(c.rows,t,i.inMemoryFields));var p={docs:c.rows.map(function(w){var f=w.doc;return t.fields?qf(f,t.fields):f})};return a.defaultUsed&&(p.warning="No matching index found, create an index to optimize query time."),p})})}function Sl(e,t){return eo(e,t,!0).then(function(n){return{dbname:e.name,index:n.index,selector:t.selector,range:{start_key:n.queryOpts.startkey,end_key:n.queryOpts.endkey},opts:{use_index:t.use_index||[],bookmark:"nil",limit:t.limit,skip:t.skip,sort:t.sort||{},fields:t.fields,conflicts:!1,r:[49]},limit:t.limit,skip:t.skip||0,fields:t.fields}})}function kl(e,t){if(!t.ddoc)throw new Error("you must supply an index.ddoc when deleting");if(!t.name)throw new Error("you must supply an index.name when deleting");var n=t.ddoc,r=t.name;function i(a){return Object.keys(a.views).length===1&&a.views[r]?{_id:n,_deleted:!0}:(delete a.views[r],a)}return yn(e,n,i).then(function(){return Ur(e).viewCleanup.apply(e)}).then(function(){return{ok:!0}})}var Al=Kt(tl),El=Kt(eo),xl=Kt(Sl),Cl=Kt(Ya),Tl=Kt(kl),$t={};$t.createIndex=Dt(function(e,t){if(typeof e!="object")return t(new Error("you must provide an index to create"));var n=nt(this)?kf:Al;n(this,e,t)}),$t.find=Dt(function(e,t){if(typeof t=="undefined"&&(t=e,e=void 0),typeof e!="object")return t(new Error("you must provide search parameters to find()"));var n=nt(this)?Af:El;n(this,e,t)}),$t.explain=Dt(function(e,t){if(typeof t=="undefined"&&(t=e,e=void 0),typeof e!="object")return t(new Error("you must provide search parameters to explain()"));var n=nt(this)?Ef:xl;n(this,e,t)}),$t.getIndexes=Dt(function(e){var t=nt(this)?xf:Cl;t(this,e)}),$t.deleteIndex=Dt(function(e,t){if(typeof e!="object")return t(new Error("you must provide an index to delete"));var n=nt(this)?Cf:Tl;n(this,e,t)});var to={},no=window.MutationObserver||window.WebKitMutationObserver,zt;if(no){var ro=0,ql=new no(wn),io=window.document.createTextNode("");ql.observe(io,{characterData:!0}),zt=function(){io.data=ro=++ro%2}}else if(!window.setImmediate&&typeof window.MessageChannel!="undefined"){var ao=new window.MessageChannel;ao.port1.onmessage=wn,zt=function(){ao.port2.postMessage(0)}}else"document"in window&&"onreadystatechange"in window.document.createElement("script")?zt=function(){var e=window.document.createElement("script");e.onreadystatechange=function(){wn(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},window.document.documentElement.appendChild(e)}:zt=function(){setTimeout(wn,0)};var zr,Qt=[];function wn(){zr=!0;for(var e,t,n=Qt.length;n;){for(t=Qt,Qt=[],e=-1;++e<n;)t[e]();n=Qt.length}zr=!1}var Pl=jl;function jl(e){Qt.push(e)===1&&!zr&&zt()}var Il=Pl;function Ot(){}var _e={},oo=["REJECTED"],Qr=["FULFILLED"],so=["PENDING"],Bl=ot;function ot(e){if(typeof e!="function")throw new TypeError("resolver must be a function");this.state=so,this.queue=[],this.outcome=void 0,e!==Ot&&uo(this,e)}ot.prototype.catch=function(e){return this.then(null,e)},ot.prototype.then=function(e,t){if(typeof e!="function"&&this.state===Qr||typeof t!="function"&&this.state===oo)return this;var n=new this.constructor(Ot);if(this.state!==so){var r=this.state===Qr?e:t;Jr(n,r,this.outcome)}else this.queue.push(new Jt(n,e,t));return n};function Jt(e,t,n){this.promise=e,typeof t=="function"&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),typeof n=="function"&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}Jt.prototype.callFulfilled=function(e){_e.resolve(this.promise,e)},Jt.prototype.otherCallFulfilled=function(e){Jr(this.promise,this.onFulfilled,e)},Jt.prototype.callRejected=function(e){_e.reject(this.promise,e)},Jt.prototype.otherCallRejected=function(e){Jr(this.promise,this.onRejected,e)};function Jr(e,t,n){Il(function(){var r;try{r=t(n)}catch(i){return _e.reject(e,i)}r===e?_e.reject(e,new TypeError("Cannot resolve promise with itself")):_e.resolve(e,r)})}_e.resolve=function(e,t){var n=co(Rl,t);if(n.status==="error")return _e.reject(e,n.value);var r=n.value;if(r)uo(e,r);else{e.state=Qr,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},_e.reject=function(e,t){e.state=oo,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e};function Rl(e){var t=e&&e.then;if(e&&(typeof e=="object"||typeof e=="function")&&typeof t=="function")return function(){t.apply(e,arguments)}}function uo(e,t){var n=!1;function r(s){n||(n=!0,_e.reject(e,s))}function i(s){n||(n=!0,_e.resolve(e,s))}function a(){t(i,r)}var o=co(a);o.status==="error"&&r(o.value)}function co(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}ot.resolve=Ll;function Ll(e){return e instanceof this?e:_e.resolve(new this(Ot),e)}ot.reject=Dl;function Dl(e){var t=new this(Ot);return _e.reject(t,e)}ot.all=Nl;function Nl(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),a=0,o=-1,s=new this(Ot);++o<n;)c(e[o],o);return s;function c(p,w){t.resolve(p).then(f,function(m){r||(r=!0,_e.reject(s,m))});function f(m){i[w]=m,++a===n&&!r&&(r=!0,_e.resolve(s,i))}}}ot.race=Ml;function Ml(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=-1,a=new this(Ot);++i<n;)o(e[i]);return a;function o(s){t.resolve(s).then(function(c){r||(r=!0,_e.resolve(a,c))},function(c){r||(r=!0,_e.reject(a,c))})}}var Fl=typeof Promise=="function"?Promise:Bl;const Ul=Yr(Object.freeze(Object.defineProperty({__proto__:null,default:Fl},Symbol.toStringTag,{value:"Module"})));(function(e){var t=Ul;function n(i,a,o){return typeof a!="string"?t.reject(new Error("doc id is required")):i.get(a).catch(function(s){if(s.status!==404)throw s;return{}}).then(function(s){var c=s._rev,p=o(s);return p?(p._id=a,p._rev=c,r(i,p,o)):{updated:!1,rev:c,id:a}})}function r(i,a,o){return i.put(a).then(function(s){return{updated:!0,rev:s.rev,id:a._id}},function(s){if(s.status!==409)throw s;return n(i,a._id,o)})}e.upsert=function(a,o,s){var c=this,p=n(c,a,o);if(typeof s!="function")return p;p.then(function(w){s(null,w)},s)},e.putIfNotExists=function(a,o,s){var c=this;typeof a!="string"&&(s=o,o=a,a=o._id);var p=function(f){return f._rev?!1:o},w=n(c,a,p);if(typeof s!="function")return w;w.then(function(f){s(null,f)},s)},typeof window!="undefined"&&window.PouchDB&&window.PouchDB.plugin(e)})(to);function St(...e){return[].concat(...e).filter(t=>!zl(t)&&!Ql(t)&&!Gl(t)).flat()}function Kl(e=null){const t=new Date;return typeof e=="number"&&t.setSeconds(t.getSeconds()+e),t}function Gt(e,t){if(e instanceof Map)return Array.from(e).map(([r,i])=>Gt(i,t));if(Array.isArray(e))return e.map(r=>Gt(r,t));if(t=St(t),!t.length)return e;const n=t.map(r=>Jl(e)?e[r]:e);if(n.length)return n.length===1?n.shift():n}function fo(...e){return[].concat(...e).shift()}function zl(e){return e===!1}function Ql(e){return e===null}function Jl(e){return Object.prototype.toString.call(e)==="[object Object]"}function lo(e){return typeof e=="string"}function Gl(e){return e===void 0}function Gr(e,t,n=[]){if(e instanceof Map)return e;if(t===void 0)throw new Error("You must specify an attribute for the map's key.");const r=new Map(St(n).map(i=>[i,void 0]));return St(e).reduce((i,a)=>{const o=typeof t=="function"?t(a):a[t];return i.set(o,a)},Object.assign(r,{first(...i){return Gt(this.toArray().shift(),[...i])},last(){return this.toArray().pop()},toArray(){return Array.from(r.values())},toJson(){return Object.fromEntries(r)}}))}function ho(e,...t){return e instanceof Promise?e:typeof e=="function"?Promise.resolve(e(...t)):Promise.resolve(e)}function Wr(e,t=n=>n){if(e.size)return e.size===1?t(e.first()):Object.fromEntries(Array.from(e).map(([n,r])=>[n,t(r)]))}function Hr(e,t){return M(this,null,function*(){const n=Object.entries(t);for(const[r,i]of n)t[r]=i&&(yield e.remove(i));return Wr(Gr(t,"id"))})}function vo(e){e&&console.warn(e)}const Wl={cache(...e){return M(this,null,function*(){const[t,n,r]=e;yield this.clearExpiredCache(t);const i=yield this.findCache(t);if(e.length<=1||i.length){const p=Gr(i,"_id",t);return Wr(p,w=>Gt(w,"$value"))}if(!lo(t))throw new Error("The key must be a string when cache() is being used a setter.");const a=r instanceof Date?r:typeof r=="number"?Kl(r):null;let o=yield ho(n);o!==void 0&&(o=JSON.parse(JSON.stringify(o)));const{_rev:s}=fo(i)||{},c=Object.assign({_id:t,_rev:s,$value:o,$expiredAt:a});return yield this.upsert(t,p=>{if(Object.keys(ke(c,p)).length>0)return c}),o})},cacheSelector(e=[],t=null,n=!1){return{selector:this.mergeCacheExpirationSelector({_id:{[e.length?"$in":"$nin"]:e},$expiredAt:{$exists:!0},$value:{$exists:!0}},t,n)}},clearExpiredCache(e){return M(this,null,function*(){const t=yield this.findCache(St(e),new Date,!0);return yield Promise.all(Object.entries(t).map(([n,r])=>r&&this.remove(r._id,r._rev)))})},createCacheIndex(){return M(this,null,function*(){return yield this.createIndex({index:{fields:["$expiredAt","$value"]}})})},findCache(e=void 0,t=void 0,n=!1){return M(this,null,function*(){t===void 0&&(t=new Date);const{docs:r,warning:i}=yield this.find(this.cacheSelector(St(e),t,n));return vo(i),r})},findExpiredCache(e,t=null){return M(this,null,function*(){return yield this.findCache(e,!0,t||new Date)})},mergeCacheExpirationSelector(e,t=null,n=!1){return t instanceof Date?Object.assign(e,{[n?"$and":"$or"]:[{$expiredAt:{[n?"$lte":"$gt"]:t}},{$expiredAt:{[n?"$ne":"$eq"]:null}}]}):e},purge(e){return M(this,null,function*(){return yield Hr(this,yield this.findCache(e))})},removeCache(e){return M(this,null,function*(){return yield Hr(this,yield this.findCache(e))})}},Hl={config(...e){return M(this,null,function*(){const[t,n]=e,r=yield this.findConfig(t);if(e.length<=1){const s=Gr(r,"_id",t);return Wr(s,c=>Gt(c,"$value"))}if(!lo(t))throw new Error("The key must be a string when config() is being used a setter.");let i=yield ho(n);i!==void 0&&(i=JSON.parse(JSON.stringify(i)));const{_rev:a}=fo(r)||{},o=Object.assign({_id:t,_rev:a,$value:i,$config:!0});return yield this.upsert(t,s=>{if(Object.keys(ke(o,s)).length>0)return o}),i})},configSelector(e=[]){return{selector:{_id:{[e.length?"$in":"$nin"]:e},$config:{$exists:!0}}}},createConfigIndex(){return M(this,null,function*(){return yield this.createIndex({index:{fields:["$config"]}})})},findConfig(e){return M(this,null,function*(){const{docs:t,warning:n}=yield this.find(this.configSelector(St(e)));return vo(n),t})},removeConfig(e){return M(this,null,function*(){return yield Hr(this,yield this.findConfig(e))})}};X.plugin($t),X.plugin(to),X.plugin(Wl),X.plugin(Hl),ie.db=void 0;function ze(){if(!ie.db)throw new Error("You must initialize with init() before accessing the database.");return!0}function Xl(e,t){return ie.db||(ie.db=new X(e,t))}function Yl(){return M(this,null,function*(){return ze()&&{cache:yield ie.db.createCacheIndex(),config:yield ie.db.createConfigIndex()}})}function Zl(){return M(this,null,function*(){return ze()&&(yield ie.db.createCacheIndex())})}function Vl(){return M(this,null,function*(){return ze()&&(yield ie.db.createConfigIndex())})}function ed(...e){return M(this,null,function*(){return ze()&&(yield ie.db.cache(...e))})}function td(...e){return M(this,null,function*(){return ze()&&(yield ie.db.config(...e))})}function nd(...e){return M(this,null,function*(){return ze()&&(yield ie.db.purge(...e))})}function rd(...e){return M(this,null,function*(){return ze()&&(yield ie.db.removeCache(...e))})}function id(...e){return M(this,null,function*(){return ze()&&(yield ie.db.removeConfig(...e))})}ie.cache=ed,ie.config=td,ie.createCacheIndex=Zl,ie.createConfigIndex=Vl,ie.createIndex=Yl,ie.createPouchApp=go,ie.createPouchLoader=Xr,ie.init=Xl,ie.load=ct,ie.purge=nd,ie.removeCache=rd,ie.removeConfig=id,ie.usePouchPlugin=yo,Object.defineProperty(ie,Symbol.toStringTag,{value:"Module"})});
